<html>
<head>
<title>app.py</title>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8">
<style type="text/css">
.s0 { color: #cc7832;}
.s1 { color: #a9b7c6;}
.s2 { color: #808080;}
.s3 { color: #6a8759;}
.s4 { color: #6897bb;}
.s5 { color: #629755; font-style: italic;}
.ln { color: #606366; font-weight: normal; font-style: normal; }
</style>
</head>
<body bgcolor="#2b2b2b">
<table CELLSPACING=0 CELLPADDING=5 COLS=1 WIDTH="100%" BGCOLOR="#606060" >
<tr><td><center>
<font face="Arial, Helvetica" color="#000000">
app.py</font>
</center></td></tr></table>
<pre><a name="l1"><span class="ln">1    </span></a><span class="s0">import </span><span class="s1">functools</span>
<a name="l2"><span class="ln">2    </span></a><span class="s0">import </span><span class="s1">inspect</span>
<a name="l3"><span class="ln">3    </span></a><span class="s0">import </span><span class="s1">json</span>
<a name="l4"><span class="ln">4    </span></a><span class="s0">import </span><span class="s1">logging</span>
<a name="l5"><span class="ln">5    </span></a><span class="s0">import </span><span class="s1">os</span>
<a name="l6"><span class="ln">6    </span></a><span class="s0">import </span><span class="s1">sys</span>
<a name="l7"><span class="ln">7    </span></a><span class="s0">import </span><span class="s1">typing </span><span class="s0">as </span><span class="s1">t</span>
<a name="l8"><span class="ln">8    </span></a><span class="s0">import </span><span class="s1">weakref</span>
<a name="l9"><span class="ln">9    </span></a><span class="s0">from </span><span class="s1">collections.abc </span><span class="s0">import </span><span class="s1">Iterator </span><span class="s0">as </span><span class="s1">_abc_Iterator</span>
<a name="l10"><span class="ln">10   </span></a><span class="s0">from </span><span class="s1">datetime </span><span class="s0">import </span><span class="s1">timedelta</span>
<a name="l11"><span class="ln">11   </span></a><span class="s0">from </span><span class="s1">itertools </span><span class="s0">import </span><span class="s1">chain</span>
<a name="l12"><span class="ln">12   </span></a><span class="s0">from </span><span class="s1">threading </span><span class="s0">import </span><span class="s1">Lock</span>
<a name="l13"><span class="ln">13   </span></a><span class="s0">from </span><span class="s1">types </span><span class="s0">import </span><span class="s1">TracebackType</span>
<a name="l14"><span class="ln">14   </span></a>
<a name="l15"><span class="ln">15   </span></a><span class="s0">import </span><span class="s1">click</span>
<a name="l16"><span class="ln">16   </span></a><span class="s0">from </span><span class="s1">werkzeug.datastructures </span><span class="s0">import </span><span class="s1">Headers</span>
<a name="l17"><span class="ln">17   </span></a><span class="s0">from </span><span class="s1">werkzeug.datastructures </span><span class="s0">import </span><span class="s1">ImmutableDict</span>
<a name="l18"><span class="ln">18   </span></a><span class="s0">from </span><span class="s1">werkzeug.exceptions </span><span class="s0">import </span><span class="s1">Aborter</span>
<a name="l19"><span class="ln">19   </span></a><span class="s0">from </span><span class="s1">werkzeug.exceptions </span><span class="s0">import </span><span class="s1">BadRequest</span>
<a name="l20"><span class="ln">20   </span></a><span class="s0">from </span><span class="s1">werkzeug.exceptions </span><span class="s0">import </span><span class="s1">BadRequestKeyError</span>
<a name="l21"><span class="ln">21   </span></a><span class="s0">from </span><span class="s1">werkzeug.exceptions </span><span class="s0">import </span><span class="s1">HTTPException</span>
<a name="l22"><span class="ln">22   </span></a><span class="s0">from </span><span class="s1">werkzeug.exceptions </span><span class="s0">import </span><span class="s1">InternalServerError</span>
<a name="l23"><span class="ln">23   </span></a><span class="s0">from </span><span class="s1">werkzeug.routing </span><span class="s0">import </span><span class="s1">BuildError</span>
<a name="l24"><span class="ln">24   </span></a><span class="s0">from </span><span class="s1">werkzeug.routing </span><span class="s0">import </span><span class="s1">Map</span>
<a name="l25"><span class="ln">25   </span></a><span class="s0">from </span><span class="s1">werkzeug.routing </span><span class="s0">import </span><span class="s1">MapAdapter</span>
<a name="l26"><span class="ln">26   </span></a><span class="s0">from </span><span class="s1">werkzeug.routing </span><span class="s0">import </span><span class="s1">RequestRedirect</span>
<a name="l27"><span class="ln">27   </span></a><span class="s0">from </span><span class="s1">werkzeug.routing </span><span class="s0">import </span><span class="s1">RoutingException</span>
<a name="l28"><span class="ln">28   </span></a><span class="s0">from </span><span class="s1">werkzeug.routing </span><span class="s0">import </span><span class="s1">Rule</span>
<a name="l29"><span class="ln">29   </span></a><span class="s0">from </span><span class="s1">werkzeug.serving </span><span class="s0">import </span><span class="s1">is_running_from_reloader</span>
<a name="l30"><span class="ln">30   </span></a><span class="s0">from </span><span class="s1">werkzeug.urls </span><span class="s0">import </span><span class="s1">url_quote</span>
<a name="l31"><span class="ln">31   </span></a><span class="s0">from </span><span class="s1">werkzeug.utils </span><span class="s0">import </span><span class="s1">redirect </span><span class="s0">as </span><span class="s1">_wz_redirect</span>
<a name="l32"><span class="ln">32   </span></a><span class="s0">from </span><span class="s1">werkzeug.wrappers </span><span class="s0">import </span><span class="s1">Response </span><span class="s0">as </span><span class="s1">BaseResponse</span>
<a name="l33"><span class="ln">33   </span></a>
<a name="l34"><span class="ln">34   </span></a><span class="s0">from </span><span class="s1">. </span><span class="s0">import </span><span class="s1">cli</span>
<a name="l35"><span class="ln">35   </span></a><span class="s0">from </span><span class="s1">. </span><span class="s0">import </span><span class="s1">typing </span><span class="s0">as </span><span class="s1">ft</span>
<a name="l36"><span class="ln">36   </span></a><span class="s0">from </span><span class="s1">.config </span><span class="s0">import </span><span class="s1">Config</span>
<a name="l37"><span class="ln">37   </span></a><span class="s0">from </span><span class="s1">.config </span><span class="s0">import </span><span class="s1">ConfigAttribute</span>
<a name="l38"><span class="ln">38   </span></a><span class="s0">from </span><span class="s1">.ctx </span><span class="s0">import </span><span class="s1">_AppCtxGlobals</span>
<a name="l39"><span class="ln">39   </span></a><span class="s0">from </span><span class="s1">.ctx </span><span class="s0">import </span><span class="s1">AppContext</span>
<a name="l40"><span class="ln">40   </span></a><span class="s0">from </span><span class="s1">.ctx </span><span class="s0">import </span><span class="s1">RequestContext</span>
<a name="l41"><span class="ln">41   </span></a><span class="s0">from </span><span class="s1">.globals </span><span class="s0">import </span><span class="s1">_cv_app</span>
<a name="l42"><span class="ln">42   </span></a><span class="s0">from </span><span class="s1">.globals </span><span class="s0">import </span><span class="s1">_cv_request</span>
<a name="l43"><span class="ln">43   </span></a><span class="s0">from </span><span class="s1">.globals </span><span class="s0">import </span><span class="s1">g</span>
<a name="l44"><span class="ln">44   </span></a><span class="s0">from </span><span class="s1">.globals </span><span class="s0">import </span><span class="s1">request</span>
<a name="l45"><span class="ln">45   </span></a><span class="s0">from </span><span class="s1">.globals </span><span class="s0">import </span><span class="s1">request_ctx</span>
<a name="l46"><span class="ln">46   </span></a><span class="s0">from </span><span class="s1">.globals </span><span class="s0">import </span><span class="s1">session</span>
<a name="l47"><span class="ln">47   </span></a><span class="s0">from </span><span class="s1">.helpers </span><span class="s0">import </span><span class="s1">_split_blueprint_path</span>
<a name="l48"><span class="ln">48   </span></a><span class="s0">from </span><span class="s1">.helpers </span><span class="s0">import </span><span class="s1">get_debug_flag</span>
<a name="l49"><span class="ln">49   </span></a><span class="s0">from </span><span class="s1">.helpers </span><span class="s0">import </span><span class="s1">get_flashed_messages</span>
<a name="l50"><span class="ln">50   </span></a><span class="s0">from </span><span class="s1">.helpers </span><span class="s0">import </span><span class="s1">get_load_dotenv</span>
<a name="l51"><span class="ln">51   </span></a><span class="s0">from </span><span class="s1">.helpers </span><span class="s0">import </span><span class="s1">locked_cached_property</span>
<a name="l52"><span class="ln">52   </span></a><span class="s0">from </span><span class="s1">.json.provider </span><span class="s0">import </span><span class="s1">DefaultJSONProvider</span>
<a name="l53"><span class="ln">53   </span></a><span class="s0">from </span><span class="s1">.json.provider </span><span class="s0">import </span><span class="s1">JSONProvider</span>
<a name="l54"><span class="ln">54   </span></a><span class="s0">from </span><span class="s1">.logging </span><span class="s0">import </span><span class="s1">create_logger</span>
<a name="l55"><span class="ln">55   </span></a><span class="s0">from </span><span class="s1">.scaffold </span><span class="s0">import </span><span class="s1">_endpoint_from_view_func</span>
<a name="l56"><span class="ln">56   </span></a><span class="s0">from </span><span class="s1">.scaffold </span><span class="s0">import </span><span class="s1">_sentinel</span>
<a name="l57"><span class="ln">57   </span></a><span class="s0">from </span><span class="s1">.scaffold </span><span class="s0">import </span><span class="s1">find_package</span>
<a name="l58"><span class="ln">58   </span></a><span class="s0">from </span><span class="s1">.scaffold </span><span class="s0">import </span><span class="s1">Scaffold</span>
<a name="l59"><span class="ln">59   </span></a><span class="s0">from </span><span class="s1">.scaffold </span><span class="s0">import </span><span class="s1">setupmethod</span>
<a name="l60"><span class="ln">60   </span></a><span class="s0">from </span><span class="s1">.sessions </span><span class="s0">import </span><span class="s1">SecureCookieSessionInterface</span>
<a name="l61"><span class="ln">61   </span></a><span class="s0">from </span><span class="s1">.sessions </span><span class="s0">import </span><span class="s1">SessionInterface</span>
<a name="l62"><span class="ln">62   </span></a><span class="s0">from </span><span class="s1">.signals </span><span class="s0">import </span><span class="s1">appcontext_tearing_down</span>
<a name="l63"><span class="ln">63   </span></a><span class="s0">from </span><span class="s1">.signals </span><span class="s0">import </span><span class="s1">got_request_exception</span>
<a name="l64"><span class="ln">64   </span></a><span class="s0">from </span><span class="s1">.signals </span><span class="s0">import </span><span class="s1">request_finished</span>
<a name="l65"><span class="ln">65   </span></a><span class="s0">from </span><span class="s1">.signals </span><span class="s0">import </span><span class="s1">request_started</span>
<a name="l66"><span class="ln">66   </span></a><span class="s0">from </span><span class="s1">.signals </span><span class="s0">import </span><span class="s1">request_tearing_down</span>
<a name="l67"><span class="ln">67   </span></a><span class="s0">from </span><span class="s1">.templating </span><span class="s0">import </span><span class="s1">DispatchingJinjaLoader</span>
<a name="l68"><span class="ln">68   </span></a><span class="s0">from </span><span class="s1">.templating </span><span class="s0">import </span><span class="s1">Environment</span>
<a name="l69"><span class="ln">69   </span></a><span class="s0">from </span><span class="s1">.wrappers </span><span class="s0">import </span><span class="s1">Request</span>
<a name="l70"><span class="ln">70   </span></a><span class="s0">from </span><span class="s1">.wrappers </span><span class="s0">import </span><span class="s1">Response</span>
<a name="l71"><span class="ln">71   </span></a>
<a name="l72"><span class="ln">72   </span></a><span class="s0">if </span><span class="s1">t.TYPE_CHECKING:  </span><span class="s2"># pragma: no cover</span>
<a name="l73"><span class="ln">73   </span></a>    <span class="s0">import </span><span class="s1">typing_extensions </span><span class="s0">as </span><span class="s1">te</span>
<a name="l74"><span class="ln">74   </span></a>    <span class="s0">from </span><span class="s1">.blueprints </span><span class="s0">import </span><span class="s1">Blueprint</span>
<a name="l75"><span class="ln">75   </span></a>    <span class="s0">from </span><span class="s1">.testing </span><span class="s0">import </span><span class="s1">FlaskClient</span>
<a name="l76"><span class="ln">76   </span></a>    <span class="s0">from </span><span class="s1">.testing </span><span class="s0">import </span><span class="s1">FlaskCliRunner</span>
<a name="l77"><span class="ln">77   </span></a>
<a name="l78"><span class="ln">78   </span></a><span class="s1">T_before_first_request = t.TypeVar(</span>
<a name="l79"><span class="ln">79   </span></a>    <span class="s3">&quot;T_before_first_request&quot;</span><span class="s0">, </span><span class="s1">bound=ft.BeforeFirstRequestCallable</span>
<a name="l80"><span class="ln">80   </span></a><span class="s1">)</span>
<a name="l81"><span class="ln">81   </span></a><span class="s1">T_shell_context_processor = t.TypeVar(</span>
<a name="l82"><span class="ln">82   </span></a>    <span class="s3">&quot;T_shell_context_processor&quot;</span><span class="s0">, </span><span class="s1">bound=ft.ShellContextProcessorCallable</span>
<a name="l83"><span class="ln">83   </span></a><span class="s1">)</span>
<a name="l84"><span class="ln">84   </span></a><span class="s1">T_teardown = t.TypeVar(</span><span class="s3">&quot;T_teardown&quot;</span><span class="s0">, </span><span class="s1">bound=ft.TeardownCallable)</span>
<a name="l85"><span class="ln">85   </span></a><span class="s1">T_template_filter = t.TypeVar(</span><span class="s3">&quot;T_template_filter&quot;</span><span class="s0">, </span><span class="s1">bound=ft.TemplateFilterCallable)</span>
<a name="l86"><span class="ln">86   </span></a><span class="s1">T_template_global = t.TypeVar(</span><span class="s3">&quot;T_template_global&quot;</span><span class="s0">, </span><span class="s1">bound=ft.TemplateGlobalCallable)</span>
<a name="l87"><span class="ln">87   </span></a><span class="s1">T_template_test = t.TypeVar(</span><span class="s3">&quot;T_template_test&quot;</span><span class="s0">, </span><span class="s1">bound=ft.TemplateTestCallable)</span>
<a name="l88"><span class="ln">88   </span></a>
<a name="l89"><span class="ln">89   </span></a><span class="s0">if </span><span class="s1">sys.version_info &gt;= (</span><span class="s4">3</span><span class="s0">, </span><span class="s4">8</span><span class="s1">):</span>
<a name="l90"><span class="ln">90   </span></a>    <span class="s1">iscoroutinefunction = inspect.iscoroutinefunction</span>
<a name="l91"><span class="ln">91   </span></a><span class="s0">else</span><span class="s1">:</span>
<a name="l92"><span class="ln">92   </span></a>
<a name="l93"><span class="ln">93   </span></a>    <span class="s0">def </span><span class="s1">iscoroutinefunction(func: t.Any) -&gt; bool:</span>
<a name="l94"><span class="ln">94   </span></a>        <span class="s0">while </span><span class="s1">inspect.ismethod(func):</span>
<a name="l95"><span class="ln">95   </span></a>            <span class="s1">func = func.__func__</span>
<a name="l96"><span class="ln">96   </span></a>
<a name="l97"><span class="ln">97   </span></a>        <span class="s0">while </span><span class="s1">isinstance(func</span><span class="s0">, </span><span class="s1">functools.partial):</span>
<a name="l98"><span class="ln">98   </span></a>            <span class="s1">func = func.func</span>
<a name="l99"><span class="ln">99   </span></a>
<a name="l100"><span class="ln">100  </span></a>        <span class="s0">return </span><span class="s1">inspect.iscoroutinefunction(func)</span>
<a name="l101"><span class="ln">101  </span></a>
<a name="l102"><span class="ln">102  </span></a>
<a name="l103"><span class="ln">103  </span></a><span class="s0">def </span><span class="s1">_make_timedelta(value: t.Union[timedelta</span><span class="s0">, </span><span class="s1">int</span><span class="s0">, None</span><span class="s1">]) -&gt; t.Optional[timedelta]:</span>
<a name="l104"><span class="ln">104  </span></a>    <span class="s0">if </span><span class="s1">value </span><span class="s0">is None or </span><span class="s1">isinstance(value</span><span class="s0">, </span><span class="s1">timedelta):</span>
<a name="l105"><span class="ln">105  </span></a>        <span class="s0">return </span><span class="s1">value</span>
<a name="l106"><span class="ln">106  </span></a>
<a name="l107"><span class="ln">107  </span></a>    <span class="s0">return </span><span class="s1">timedelta(seconds=value)</span>
<a name="l108"><span class="ln">108  </span></a>
<a name="l109"><span class="ln">109  </span></a>
<a name="l110"><span class="ln">110  </span></a><span class="s0">class </span><span class="s1">Flask(Scaffold):</span>
<a name="l111"><span class="ln">111  </span></a>    <span class="s5">&quot;&quot;&quot;The flask object implements a WSGI application and acts as the central 
<a name="l112"><span class="ln">112  </span></a>    object.  It is passed the name of the module or package of the 
<a name="l113"><span class="ln">113  </span></a>    application.  Once it is created it will act as a central registry for 
<a name="l114"><span class="ln">114  </span></a>    the view functions, the URL rules, template configuration and much more. 
<a name="l115"><span class="ln">115  </span></a> 
<a name="l116"><span class="ln">116  </span></a>    The name of the package is used to resolve resources from inside the 
<a name="l117"><span class="ln">117  </span></a>    package or the folder the module is contained in depending on if the 
<a name="l118"><span class="ln">118  </span></a>    package parameter resolves to an actual python package (a folder with 
<a name="l119"><span class="ln">119  </span></a>    an :file:`__init__.py` file inside) or a standard module (just a ``.py`` file). 
<a name="l120"><span class="ln">120  </span></a> 
<a name="l121"><span class="ln">121  </span></a>    For more information about resource loading, see :func:`open_resource`. 
<a name="l122"><span class="ln">122  </span></a> 
<a name="l123"><span class="ln">123  </span></a>    Usually you create a :class:`Flask` instance in your main module or 
<a name="l124"><span class="ln">124  </span></a>    in the :file:`__init__.py` file of your package like this:: 
<a name="l125"><span class="ln">125  </span></a> 
<a name="l126"><span class="ln">126  </span></a>        from flask import Flask 
<a name="l127"><span class="ln">127  </span></a>        app = Flask(__name__) 
<a name="l128"><span class="ln">128  </span></a> 
<a name="l129"><span class="ln">129  </span></a>    .. admonition:: About the First Parameter 
<a name="l130"><span class="ln">130  </span></a> 
<a name="l131"><span class="ln">131  </span></a>        The idea of the first parameter is to give Flask an idea of what 
<a name="l132"><span class="ln">132  </span></a>        belongs to your application.  This name is used to find resources 
<a name="l133"><span class="ln">133  </span></a>        on the filesystem, can be used by extensions to improve debugging 
<a name="l134"><span class="ln">134  </span></a>        information and a lot more. 
<a name="l135"><span class="ln">135  </span></a> 
<a name="l136"><span class="ln">136  </span></a>        So it's important what you provide there.  If you are using a single 
<a name="l137"><span class="ln">137  </span></a>        module, `__name__` is always the correct value.  If you however are 
<a name="l138"><span class="ln">138  </span></a>        using a package, it's usually recommended to hardcode the name of 
<a name="l139"><span class="ln">139  </span></a>        your package there. 
<a name="l140"><span class="ln">140  </span></a> 
<a name="l141"><span class="ln">141  </span></a>        For example if your application is defined in :file:`yourapplication/app.py` 
<a name="l142"><span class="ln">142  </span></a>        you should create it with one of the two versions below:: 
<a name="l143"><span class="ln">143  </span></a> 
<a name="l144"><span class="ln">144  </span></a>            app = Flask('yourapplication') 
<a name="l145"><span class="ln">145  </span></a>            app = Flask(__name__.split('.')[0]) 
<a name="l146"><span class="ln">146  </span></a> 
<a name="l147"><span class="ln">147  </span></a>        Why is that?  The application will work even with `__name__`, thanks 
<a name="l148"><span class="ln">148  </span></a>        to how resources are looked up.  However it will make debugging more 
<a name="l149"><span class="ln">149  </span></a>        painful.  Certain extensions can make assumptions based on the 
<a name="l150"><span class="ln">150  </span></a>        import name of your application.  For example the Flask-SQLAlchemy 
<a name="l151"><span class="ln">151  </span></a>        extension will look for the code in your application that triggered 
<a name="l152"><span class="ln">152  </span></a>        an SQL query in debug mode.  If the import name is not properly set 
<a name="l153"><span class="ln">153  </span></a>        up, that debugging information is lost.  (For example it would only 
<a name="l154"><span class="ln">154  </span></a>        pick up SQL queries in `yourapplication.app` and not 
<a name="l155"><span class="ln">155  </span></a>        `yourapplication.views.frontend`) 
<a name="l156"><span class="ln">156  </span></a> 
<a name="l157"><span class="ln">157  </span></a>    .. versionadded:: 0.7 
<a name="l158"><span class="ln">158  </span></a>       The `static_url_path`, `static_folder`, and `template_folder` 
<a name="l159"><span class="ln">159  </span></a>       parameters were added. 
<a name="l160"><span class="ln">160  </span></a> 
<a name="l161"><span class="ln">161  </span></a>    .. versionadded:: 0.8 
<a name="l162"><span class="ln">162  </span></a>       The `instance_path` and `instance_relative_config` parameters were 
<a name="l163"><span class="ln">163  </span></a>       added. 
<a name="l164"><span class="ln">164  </span></a> 
<a name="l165"><span class="ln">165  </span></a>    .. versionadded:: 0.11 
<a name="l166"><span class="ln">166  </span></a>       The `root_path` parameter was added. 
<a name="l167"><span class="ln">167  </span></a> 
<a name="l168"><span class="ln">168  </span></a>    .. versionadded:: 1.0 
<a name="l169"><span class="ln">169  </span></a>       The ``host_matching`` and ``static_host`` parameters were added. 
<a name="l170"><span class="ln">170  </span></a> 
<a name="l171"><span class="ln">171  </span></a>    .. versionadded:: 1.0 
<a name="l172"><span class="ln">172  </span></a>       The ``subdomain_matching`` parameter was added. Subdomain 
<a name="l173"><span class="ln">173  </span></a>       matching needs to be enabled manually now. Setting 
<a name="l174"><span class="ln">174  </span></a>       :data:`SERVER_NAME` does not implicitly enable it. 
<a name="l175"><span class="ln">175  </span></a> 
<a name="l176"><span class="ln">176  </span></a>    :param import_name: the name of the application package 
<a name="l177"><span class="ln">177  </span></a>    :param static_url_path: can be used to specify a different path for the 
<a name="l178"><span class="ln">178  </span></a>                            static files on the web.  Defaults to the name 
<a name="l179"><span class="ln">179  </span></a>                            of the `static_folder` folder. 
<a name="l180"><span class="ln">180  </span></a>    :param static_folder: The folder with static files that is served at 
<a name="l181"><span class="ln">181  </span></a>        ``static_url_path``. Relative to the application ``root_path`` 
<a name="l182"><span class="ln">182  </span></a>        or an absolute path. Defaults to ``'static'``. 
<a name="l183"><span class="ln">183  </span></a>    :param static_host: the host to use when adding the static route. 
<a name="l184"><span class="ln">184  </span></a>        Defaults to None. Required when using ``host_matching=True`` 
<a name="l185"><span class="ln">185  </span></a>        with a ``static_folder`` configured. 
<a name="l186"><span class="ln">186  </span></a>    :param host_matching: set ``url_map.host_matching`` attribute. 
<a name="l187"><span class="ln">187  </span></a>        Defaults to False. 
<a name="l188"><span class="ln">188  </span></a>    :param subdomain_matching: consider the subdomain relative to 
<a name="l189"><span class="ln">189  </span></a>        :data:`SERVER_NAME` when matching routes. Defaults to False. 
<a name="l190"><span class="ln">190  </span></a>    :param template_folder: the folder that contains the templates that should 
<a name="l191"><span class="ln">191  </span></a>                            be used by the application.  Defaults to 
<a name="l192"><span class="ln">192  </span></a>                            ``'templates'`` folder in the root path of the 
<a name="l193"><span class="ln">193  </span></a>                            application. 
<a name="l194"><span class="ln">194  </span></a>    :param instance_path: An alternative instance path for the application. 
<a name="l195"><span class="ln">195  </span></a>                          By default the folder ``'instance'`` next to the 
<a name="l196"><span class="ln">196  </span></a>                          package or module is assumed to be the instance 
<a name="l197"><span class="ln">197  </span></a>                          path. 
<a name="l198"><span class="ln">198  </span></a>    :param instance_relative_config: if set to ``True`` relative filenames 
<a name="l199"><span class="ln">199  </span></a>                                     for loading the config are assumed to 
<a name="l200"><span class="ln">200  </span></a>                                     be relative to the instance path instead 
<a name="l201"><span class="ln">201  </span></a>                                     of the application root. 
<a name="l202"><span class="ln">202  </span></a>    :param root_path: The path to the root of the application files. 
<a name="l203"><span class="ln">203  </span></a>        This should only be set manually when it can't be detected 
<a name="l204"><span class="ln">204  </span></a>        automatically, such as for namespace packages. 
<a name="l205"><span class="ln">205  </span></a>    &quot;&quot;&quot;</span>
<a name="l206"><span class="ln">206  </span></a>
<a name="l207"><span class="ln">207  </span></a>    <span class="s2">#: The class that is used for request objects.  See :class:`~flask.Request`</span>
<a name="l208"><span class="ln">208  </span></a>    <span class="s2">#: for more information.</span>
<a name="l209"><span class="ln">209  </span></a>    <span class="s1">request_class = Request</span>
<a name="l210"><span class="ln">210  </span></a>
<a name="l211"><span class="ln">211  </span></a>    <span class="s2">#: The class that is used for response objects.  See</span>
<a name="l212"><span class="ln">212  </span></a>    <span class="s2">#: :class:`~flask.Response` for more information.</span>
<a name="l213"><span class="ln">213  </span></a>    <span class="s1">response_class = Response</span>
<a name="l214"><span class="ln">214  </span></a>
<a name="l215"><span class="ln">215  </span></a>    <span class="s2">#: The class of the object assigned to :attr:`aborter`, created by</span>
<a name="l216"><span class="ln">216  </span></a>    <span class="s2">#: :meth:`create_aborter`. That object is called by</span>
<a name="l217"><span class="ln">217  </span></a>    <span class="s2">#: :func:`flask.abort` to raise HTTP errors, and can be</span>
<a name="l218"><span class="ln">218  </span></a>    <span class="s2">#: called directly as well.</span>
<a name="l219"><span class="ln">219  </span></a>    <span class="s2">#:</span>
<a name="l220"><span class="ln">220  </span></a>    <span class="s2">#: Defaults to :class:`werkzeug.exceptions.Aborter`.</span>
<a name="l221"><span class="ln">221  </span></a>    <span class="s2">#:</span>
<a name="l222"><span class="ln">222  </span></a>    <span class="s2">#: .. versionadded:: 2.2</span>
<a name="l223"><span class="ln">223  </span></a>    <span class="s1">aborter_class = Aborter</span>
<a name="l224"><span class="ln">224  </span></a>
<a name="l225"><span class="ln">225  </span></a>    <span class="s2">#: The class that is used for the Jinja environment.</span>
<a name="l226"><span class="ln">226  </span></a>    <span class="s2">#:</span>
<a name="l227"><span class="ln">227  </span></a>    <span class="s2">#: .. versionadded:: 0.11</span>
<a name="l228"><span class="ln">228  </span></a>    <span class="s1">jinja_environment = Environment</span>
<a name="l229"><span class="ln">229  </span></a>
<a name="l230"><span class="ln">230  </span></a>    <span class="s2">#: The class that is used for the :data:`~flask.g` instance.</span>
<a name="l231"><span class="ln">231  </span></a>    <span class="s2">#:</span>
<a name="l232"><span class="ln">232  </span></a>    <span class="s2">#: Example use cases for a custom class:</span>
<a name="l233"><span class="ln">233  </span></a>    <span class="s2">#:</span>
<a name="l234"><span class="ln">234  </span></a>    <span class="s2">#: 1. Store arbitrary attributes on flask.g.</span>
<a name="l235"><span class="ln">235  </span></a>    <span class="s2">#: 2. Add a property for lazy per-request database connectors.</span>
<a name="l236"><span class="ln">236  </span></a>    <span class="s2">#: 3. Return None instead of AttributeError on unexpected attributes.</span>
<a name="l237"><span class="ln">237  </span></a>    <span class="s2">#: 4. Raise exception if an unexpected attr is set, a &quot;controlled&quot; flask.g.</span>
<a name="l238"><span class="ln">238  </span></a>    <span class="s2">#:</span>
<a name="l239"><span class="ln">239  </span></a>    <span class="s2">#: In Flask 0.9 this property was called `request_globals_class` but it</span>
<a name="l240"><span class="ln">240  </span></a>    <span class="s2">#: was changed in 0.10 to :attr:`app_ctx_globals_class` because the</span>
<a name="l241"><span class="ln">241  </span></a>    <span class="s2">#: flask.g object is now application context scoped.</span>
<a name="l242"><span class="ln">242  </span></a>    <span class="s2">#:</span>
<a name="l243"><span class="ln">243  </span></a>    <span class="s2">#: .. versionadded:: 0.10</span>
<a name="l244"><span class="ln">244  </span></a>    <span class="s1">app_ctx_globals_class = _AppCtxGlobals</span>
<a name="l245"><span class="ln">245  </span></a>
<a name="l246"><span class="ln">246  </span></a>    <span class="s2">#: The class that is used for the ``config`` attribute of this app.</span>
<a name="l247"><span class="ln">247  </span></a>    <span class="s2">#: Defaults to :class:`~flask.Config`.</span>
<a name="l248"><span class="ln">248  </span></a>    <span class="s2">#:</span>
<a name="l249"><span class="ln">249  </span></a>    <span class="s2">#: Example use cases for a custom class:</span>
<a name="l250"><span class="ln">250  </span></a>    <span class="s2">#:</span>
<a name="l251"><span class="ln">251  </span></a>    <span class="s2">#: 1. Default values for certain config options.</span>
<a name="l252"><span class="ln">252  </span></a>    <span class="s2">#: 2. Access to config values through attributes in addition to keys.</span>
<a name="l253"><span class="ln">253  </span></a>    <span class="s2">#:</span>
<a name="l254"><span class="ln">254  </span></a>    <span class="s2">#: .. versionadded:: 0.11</span>
<a name="l255"><span class="ln">255  </span></a>    <span class="s1">config_class = Config</span>
<a name="l256"><span class="ln">256  </span></a>
<a name="l257"><span class="ln">257  </span></a>    <span class="s2">#: The testing flag.  Set this to ``True`` to enable the test mode of</span>
<a name="l258"><span class="ln">258  </span></a>    <span class="s2">#: Flask extensions (and in the future probably also Flask itself).</span>
<a name="l259"><span class="ln">259  </span></a>    <span class="s2">#: For example this might activate test helpers that have an</span>
<a name="l260"><span class="ln">260  </span></a>    <span class="s2">#: additional runtime cost which should not be enabled by default.</span>
<a name="l261"><span class="ln">261  </span></a>    <span class="s2">#:</span>
<a name="l262"><span class="ln">262  </span></a>    <span class="s2">#: If this is enabled and PROPAGATE_EXCEPTIONS is not changed from the</span>
<a name="l263"><span class="ln">263  </span></a>    <span class="s2">#: default it's implicitly enabled.</span>
<a name="l264"><span class="ln">264  </span></a>    <span class="s2">#:</span>
<a name="l265"><span class="ln">265  </span></a>    <span class="s2">#: This attribute can also be configured from the config with the</span>
<a name="l266"><span class="ln">266  </span></a>    <span class="s2">#: ``TESTING`` configuration key.  Defaults to ``False``.</span>
<a name="l267"><span class="ln">267  </span></a>    <span class="s1">testing = ConfigAttribute(</span><span class="s3">&quot;TESTING&quot;</span><span class="s1">)</span>
<a name="l268"><span class="ln">268  </span></a>
<a name="l269"><span class="ln">269  </span></a>    <span class="s2">#: If a secret key is set, cryptographic components can use this to</span>
<a name="l270"><span class="ln">270  </span></a>    <span class="s2">#: sign cookies and other things. Set this to a complex random value</span>
<a name="l271"><span class="ln">271  </span></a>    <span class="s2">#: when you want to use the secure cookie for instance.</span>
<a name="l272"><span class="ln">272  </span></a>    <span class="s2">#:</span>
<a name="l273"><span class="ln">273  </span></a>    <span class="s2">#: This attribute can also be configured from the config with the</span>
<a name="l274"><span class="ln">274  </span></a>    <span class="s2">#: :data:`SECRET_KEY` configuration key. Defaults to ``None``.</span>
<a name="l275"><span class="ln">275  </span></a>    <span class="s1">secret_key = ConfigAttribute(</span><span class="s3">&quot;SECRET_KEY&quot;</span><span class="s1">)</span>
<a name="l276"><span class="ln">276  </span></a>
<a name="l277"><span class="ln">277  </span></a>    <span class="s1">@property</span>
<a name="l278"><span class="ln">278  </span></a>    <span class="s0">def </span><span class="s1">session_cookie_name(self) -&gt; str:</span>
<a name="l279"><span class="ln">279  </span></a>        <span class="s5">&quot;&quot;&quot;The name of the cookie set by the session interface. 
<a name="l280"><span class="ln">280  </span></a> 
<a name="l281"><span class="ln">281  </span></a>        .. deprecated:: 2.2 
<a name="l282"><span class="ln">282  </span></a>            Will be removed in Flask 2.3. Use ``app.config[&quot;SESSION_COOKIE_NAME&quot;]`` 
<a name="l283"><span class="ln">283  </span></a>            instead. 
<a name="l284"><span class="ln">284  </span></a>        &quot;&quot;&quot;</span>
<a name="l285"><span class="ln">285  </span></a>        <span class="s0">import </span><span class="s1">warnings</span>
<a name="l286"><span class="ln">286  </span></a>
<a name="l287"><span class="ln">287  </span></a>        <span class="s1">warnings.warn(</span>
<a name="l288"><span class="ln">288  </span></a>            <span class="s3">&quot;'session_cookie_name' is deprecated and will be removed in Flask 2.3. Use&quot;</span>
<a name="l289"><span class="ln">289  </span></a>            <span class="s3">&quot; 'SESSION_COOKIE_NAME' in 'app.config' instead.&quot;</span><span class="s0">,</span>
<a name="l290"><span class="ln">290  </span></a>            <span class="s1">DeprecationWarning</span><span class="s0">,</span>
<a name="l291"><span class="ln">291  </span></a>            <span class="s1">stacklevel=</span><span class="s4">2</span><span class="s0">,</span>
<a name="l292"><span class="ln">292  </span></a>        <span class="s1">)</span>
<a name="l293"><span class="ln">293  </span></a>        <span class="s0">return </span><span class="s1">self.config[</span><span class="s3">&quot;SESSION_COOKIE_NAME&quot;</span><span class="s1">]</span>
<a name="l294"><span class="ln">294  </span></a>
<a name="l295"><span class="ln">295  </span></a>    <span class="s1">@session_cookie_name.setter</span>
<a name="l296"><span class="ln">296  </span></a>    <span class="s0">def </span><span class="s1">session_cookie_name(self</span><span class="s0">, </span><span class="s1">value: str) -&gt; </span><span class="s0">None</span><span class="s1">:</span>
<a name="l297"><span class="ln">297  </span></a>        <span class="s0">import </span><span class="s1">warnings</span>
<a name="l298"><span class="ln">298  </span></a>
<a name="l299"><span class="ln">299  </span></a>        <span class="s1">warnings.warn(</span>
<a name="l300"><span class="ln">300  </span></a>            <span class="s3">&quot;'session_cookie_name' is deprecated and will be removed in Flask 2.3. Use&quot;</span>
<a name="l301"><span class="ln">301  </span></a>            <span class="s3">&quot; 'SESSION_COOKIE_NAME' in 'app.config' instead.&quot;</span><span class="s0">,</span>
<a name="l302"><span class="ln">302  </span></a>            <span class="s1">DeprecationWarning</span><span class="s0">,</span>
<a name="l303"><span class="ln">303  </span></a>            <span class="s1">stacklevel=</span><span class="s4">2</span><span class="s0">,</span>
<a name="l304"><span class="ln">304  </span></a>        <span class="s1">)</span>
<a name="l305"><span class="ln">305  </span></a>        <span class="s1">self.config[</span><span class="s3">&quot;SESSION_COOKIE_NAME&quot;</span><span class="s1">] = value</span>
<a name="l306"><span class="ln">306  </span></a>
<a name="l307"><span class="ln">307  </span></a>    <span class="s2">#: A :class:`~datetime.timedelta` which is used to set the expiration</span>
<a name="l308"><span class="ln">308  </span></a>    <span class="s2">#: date of a permanent session.  The default is 31 days which makes a</span>
<a name="l309"><span class="ln">309  </span></a>    <span class="s2">#: permanent session survive for roughly one month.</span>
<a name="l310"><span class="ln">310  </span></a>    <span class="s2">#:</span>
<a name="l311"><span class="ln">311  </span></a>    <span class="s2">#: This attribute can also be configured from the config with the</span>
<a name="l312"><span class="ln">312  </span></a>    <span class="s2">#: ``PERMANENT_SESSION_LIFETIME`` configuration key.  Defaults to</span>
<a name="l313"><span class="ln">313  </span></a>    <span class="s2">#: ``timedelta(days=31)``</span>
<a name="l314"><span class="ln">314  </span></a>    <span class="s1">permanent_session_lifetime = ConfigAttribute(</span>
<a name="l315"><span class="ln">315  </span></a>        <span class="s3">&quot;PERMANENT_SESSION_LIFETIME&quot;</span><span class="s0">, </span><span class="s1">get_converter=_make_timedelta</span>
<a name="l316"><span class="ln">316  </span></a>    <span class="s1">)</span>
<a name="l317"><span class="ln">317  </span></a>
<a name="l318"><span class="ln">318  </span></a>    <span class="s1">@property</span>
<a name="l319"><span class="ln">319  </span></a>    <span class="s0">def </span><span class="s1">send_file_max_age_default(self) -&gt; t.Optional[timedelta]:</span>
<a name="l320"><span class="ln">320  </span></a>        <span class="s5">&quot;&quot;&quot;The default value for ``max_age`` for :func:`~flask.send_file`. The default 
<a name="l321"><span class="ln">321  </span></a>        is ``None``, which tells the browser to use conditional requests instead of a 
<a name="l322"><span class="ln">322  </span></a>        timed cache. 
<a name="l323"><span class="ln">323  </span></a> 
<a name="l324"><span class="ln">324  </span></a>        .. deprecated:: 2.2 
<a name="l325"><span class="ln">325  </span></a>            Will be removed in Flask 2.3. Use 
<a name="l326"><span class="ln">326  </span></a>            ``app.config[&quot;SEND_FILE_MAX_AGE_DEFAULT&quot;]`` instead. 
<a name="l327"><span class="ln">327  </span></a> 
<a name="l328"><span class="ln">328  </span></a>        .. versionchanged:: 2.0 
<a name="l329"><span class="ln">329  </span></a>            Defaults to ``None`` instead of 12 hours. 
<a name="l330"><span class="ln">330  </span></a>        &quot;&quot;&quot;</span>
<a name="l331"><span class="ln">331  </span></a>        <span class="s0">import </span><span class="s1">warnings</span>
<a name="l332"><span class="ln">332  </span></a>
<a name="l333"><span class="ln">333  </span></a>        <span class="s1">warnings.warn(</span>
<a name="l334"><span class="ln">334  </span></a>            <span class="s3">&quot;'send_file_max_age_default' is deprecated and will be removed in Flask&quot;</span>
<a name="l335"><span class="ln">335  </span></a>            <span class="s3">&quot; 2.3. Use 'SEND_FILE_MAX_AGE_DEFAULT' in 'app.config' instead.&quot;</span><span class="s0">,</span>
<a name="l336"><span class="ln">336  </span></a>            <span class="s1">DeprecationWarning</span><span class="s0">,</span>
<a name="l337"><span class="ln">337  </span></a>            <span class="s1">stacklevel=</span><span class="s4">2</span><span class="s0">,</span>
<a name="l338"><span class="ln">338  </span></a>        <span class="s1">)</span>
<a name="l339"><span class="ln">339  </span></a>        <span class="s0">return </span><span class="s1">_make_timedelta(self.config[</span><span class="s3">&quot;SEND_FILE_MAX_AGE_DEFAULT&quot;</span><span class="s1">])</span>
<a name="l340"><span class="ln">340  </span></a>
<a name="l341"><span class="ln">341  </span></a>    <span class="s1">@send_file_max_age_default.setter</span>
<a name="l342"><span class="ln">342  </span></a>    <span class="s0">def </span><span class="s1">send_file_max_age_default(self</span><span class="s0">, </span><span class="s1">value: t.Union[int</span><span class="s0">, </span><span class="s1">timedelta</span><span class="s0">, None</span><span class="s1">]) -&gt; </span><span class="s0">None</span><span class="s1">:</span>
<a name="l343"><span class="ln">343  </span></a>        <span class="s0">import </span><span class="s1">warnings</span>
<a name="l344"><span class="ln">344  </span></a>
<a name="l345"><span class="ln">345  </span></a>        <span class="s1">warnings.warn(</span>
<a name="l346"><span class="ln">346  </span></a>            <span class="s3">&quot;'send_file_max_age_default' is deprecated and will be removed in Flask&quot;</span>
<a name="l347"><span class="ln">347  </span></a>            <span class="s3">&quot; 2.3. Use 'SEND_FILE_MAX_AGE_DEFAULT' in 'app.config' instead.&quot;</span><span class="s0">,</span>
<a name="l348"><span class="ln">348  </span></a>            <span class="s1">DeprecationWarning</span><span class="s0">,</span>
<a name="l349"><span class="ln">349  </span></a>            <span class="s1">stacklevel=</span><span class="s4">2</span><span class="s0">,</span>
<a name="l350"><span class="ln">350  </span></a>        <span class="s1">)</span>
<a name="l351"><span class="ln">351  </span></a>        <span class="s1">self.config[</span><span class="s3">&quot;SEND_FILE_MAX_AGE_DEFAULT&quot;</span><span class="s1">] = _make_timedelta(value)</span>
<a name="l352"><span class="ln">352  </span></a>
<a name="l353"><span class="ln">353  </span></a>    <span class="s1">@property</span>
<a name="l354"><span class="ln">354  </span></a>    <span class="s0">def </span><span class="s1">use_x_sendfile(self) -&gt; bool:</span>
<a name="l355"><span class="ln">355  </span></a>        <span class="s5">&quot;&quot;&quot;Enable this to use the ``X-Sendfile`` feature, assuming the server supports 
<a name="l356"><span class="ln">356  </span></a>        it, from :func:`~flask.send_file`. 
<a name="l357"><span class="ln">357  </span></a> 
<a name="l358"><span class="ln">358  </span></a>        .. deprecated:: 2.2 
<a name="l359"><span class="ln">359  </span></a>            Will be removed in Flask 2.3. Use ``app.config[&quot;USE_X_SENDFILE&quot;]`` instead. 
<a name="l360"><span class="ln">360  </span></a>        &quot;&quot;&quot;</span>
<a name="l361"><span class="ln">361  </span></a>        <span class="s0">import </span><span class="s1">warnings</span>
<a name="l362"><span class="ln">362  </span></a>
<a name="l363"><span class="ln">363  </span></a>        <span class="s1">warnings.warn(</span>
<a name="l364"><span class="ln">364  </span></a>            <span class="s3">&quot;'use_x_sendfile' is deprecated and will be removed in Flask 2.3. Use&quot;</span>
<a name="l365"><span class="ln">365  </span></a>            <span class="s3">&quot; 'USE_X_SENDFILE' in 'app.config' instead.&quot;</span><span class="s0">,</span>
<a name="l366"><span class="ln">366  </span></a>            <span class="s1">DeprecationWarning</span><span class="s0">,</span>
<a name="l367"><span class="ln">367  </span></a>            <span class="s1">stacklevel=</span><span class="s4">2</span><span class="s0">,</span>
<a name="l368"><span class="ln">368  </span></a>        <span class="s1">)</span>
<a name="l369"><span class="ln">369  </span></a>        <span class="s0">return </span><span class="s1">self.config[</span><span class="s3">&quot;USE_X_SENDFILE&quot;</span><span class="s1">]</span>
<a name="l370"><span class="ln">370  </span></a>
<a name="l371"><span class="ln">371  </span></a>    <span class="s1">@use_x_sendfile.setter</span>
<a name="l372"><span class="ln">372  </span></a>    <span class="s0">def </span><span class="s1">use_x_sendfile(self</span><span class="s0">, </span><span class="s1">value: bool) -&gt; </span><span class="s0">None</span><span class="s1">:</span>
<a name="l373"><span class="ln">373  </span></a>        <span class="s0">import </span><span class="s1">warnings</span>
<a name="l374"><span class="ln">374  </span></a>
<a name="l375"><span class="ln">375  </span></a>        <span class="s1">warnings.warn(</span>
<a name="l376"><span class="ln">376  </span></a>            <span class="s3">&quot;'use_x_sendfile' is deprecated and will be removed in Flask 2.3. Use&quot;</span>
<a name="l377"><span class="ln">377  </span></a>            <span class="s3">&quot; 'USE_X_SENDFILE' in 'app.config' instead.&quot;</span><span class="s0">,</span>
<a name="l378"><span class="ln">378  </span></a>            <span class="s1">DeprecationWarning</span><span class="s0">,</span>
<a name="l379"><span class="ln">379  </span></a>            <span class="s1">stacklevel=</span><span class="s4">2</span><span class="s0">,</span>
<a name="l380"><span class="ln">380  </span></a>        <span class="s1">)</span>
<a name="l381"><span class="ln">381  </span></a>        <span class="s1">self.config[</span><span class="s3">&quot;USE_X_SENDFILE&quot;</span><span class="s1">] = value</span>
<a name="l382"><span class="ln">382  </span></a>
<a name="l383"><span class="ln">383  </span></a>    <span class="s1">_json_encoder: t.Union[t.Type[json.JSONEncoder]</span><span class="s0">, None</span><span class="s1">] = </span><span class="s0">None</span>
<a name="l384"><span class="ln">384  </span></a>    <span class="s1">_json_decoder: t.Union[t.Type[json.JSONDecoder]</span><span class="s0">, None</span><span class="s1">] = </span><span class="s0">None</span>
<a name="l385"><span class="ln">385  </span></a>
<a name="l386"><span class="ln">386  </span></a>    <span class="s1">@property  </span><span class="s2"># type: ignore[override]</span>
<a name="l387"><span class="ln">387  </span></a>    <span class="s0">def </span><span class="s1">json_encoder(self) -&gt; t.Type[json.JSONEncoder]:  </span><span class="s2"># type: ignore[override]</span>
<a name="l388"><span class="ln">388  </span></a>        <span class="s5">&quot;&quot;&quot;The JSON encoder class to use. Defaults to 
<a name="l389"><span class="ln">389  </span></a>        :class:`~flask.json.JSONEncoder`. 
<a name="l390"><span class="ln">390  </span></a> 
<a name="l391"><span class="ln">391  </span></a>        .. deprecated:: 2.2 
<a name="l392"><span class="ln">392  </span></a>             Will be removed in Flask 2.3. Customize 
<a name="l393"><span class="ln">393  </span></a>             :attr:`json_provider_class` instead. 
<a name="l394"><span class="ln">394  </span></a> 
<a name="l395"><span class="ln">395  </span></a>        .. versionadded:: 0.10 
<a name="l396"><span class="ln">396  </span></a>        &quot;&quot;&quot;</span>
<a name="l397"><span class="ln">397  </span></a>        <span class="s0">import </span><span class="s1">warnings</span>
<a name="l398"><span class="ln">398  </span></a>
<a name="l399"><span class="ln">399  </span></a>        <span class="s1">warnings.warn(</span>
<a name="l400"><span class="ln">400  </span></a>            <span class="s3">&quot;'app.json_encoder' is deprecated and will be removed in Flask 2.3.&quot;</span>
<a name="l401"><span class="ln">401  </span></a>            <span class="s3">&quot; Customize 'app.json_provider_class' or 'app.json' instead.&quot;</span><span class="s0">,</span>
<a name="l402"><span class="ln">402  </span></a>            <span class="s1">DeprecationWarning</span><span class="s0">,</span>
<a name="l403"><span class="ln">403  </span></a>            <span class="s1">stacklevel=</span><span class="s4">2</span><span class="s0">,</span>
<a name="l404"><span class="ln">404  </span></a>        <span class="s1">)</span>
<a name="l405"><span class="ln">405  </span></a>
<a name="l406"><span class="ln">406  </span></a>        <span class="s0">if </span><span class="s1">self._json_encoder </span><span class="s0">is None</span><span class="s1">:</span>
<a name="l407"><span class="ln">407  </span></a>            <span class="s0">from </span><span class="s1">. </span><span class="s0">import </span><span class="s1">json</span>
<a name="l408"><span class="ln">408  </span></a>
<a name="l409"><span class="ln">409  </span></a>            <span class="s0">return </span><span class="s1">json.JSONEncoder</span>
<a name="l410"><span class="ln">410  </span></a>
<a name="l411"><span class="ln">411  </span></a>        <span class="s0">return </span><span class="s1">self._json_encoder</span>
<a name="l412"><span class="ln">412  </span></a>
<a name="l413"><span class="ln">413  </span></a>    <span class="s1">@json_encoder.setter</span>
<a name="l414"><span class="ln">414  </span></a>    <span class="s0">def </span><span class="s1">json_encoder(self</span><span class="s0">, </span><span class="s1">value: t.Type[json.JSONEncoder]) -&gt; </span><span class="s0">None</span><span class="s1">:</span>
<a name="l415"><span class="ln">415  </span></a>        <span class="s0">import </span><span class="s1">warnings</span>
<a name="l416"><span class="ln">416  </span></a>
<a name="l417"><span class="ln">417  </span></a>        <span class="s1">warnings.warn(</span>
<a name="l418"><span class="ln">418  </span></a>            <span class="s3">&quot;'app.json_encoder' is deprecated and will be removed in Flask 2.3.&quot;</span>
<a name="l419"><span class="ln">419  </span></a>            <span class="s3">&quot; Customize 'app.json_provider_class' or 'app.json' instead.&quot;</span><span class="s0">,</span>
<a name="l420"><span class="ln">420  </span></a>            <span class="s1">DeprecationWarning</span><span class="s0">,</span>
<a name="l421"><span class="ln">421  </span></a>            <span class="s1">stacklevel=</span><span class="s4">2</span><span class="s0">,</span>
<a name="l422"><span class="ln">422  </span></a>        <span class="s1">)</span>
<a name="l423"><span class="ln">423  </span></a>        <span class="s1">self._json_encoder = value</span>
<a name="l424"><span class="ln">424  </span></a>
<a name="l425"><span class="ln">425  </span></a>    <span class="s1">@property  </span><span class="s2"># type: ignore[override]</span>
<a name="l426"><span class="ln">426  </span></a>    <span class="s0">def </span><span class="s1">json_decoder(self) -&gt; t.Type[json.JSONDecoder]:  </span><span class="s2"># type: ignore[override]</span>
<a name="l427"><span class="ln">427  </span></a>        <span class="s5">&quot;&quot;&quot;The JSON decoder class to use. Defaults to 
<a name="l428"><span class="ln">428  </span></a>        :class:`~flask.json.JSONDecoder`. 
<a name="l429"><span class="ln">429  </span></a> 
<a name="l430"><span class="ln">430  </span></a>        .. deprecated:: 2.2 
<a name="l431"><span class="ln">431  </span></a>             Will be removed in Flask 2.3. Customize 
<a name="l432"><span class="ln">432  </span></a>             :attr:`json_provider_class` instead. 
<a name="l433"><span class="ln">433  </span></a> 
<a name="l434"><span class="ln">434  </span></a>        .. versionadded:: 0.10 
<a name="l435"><span class="ln">435  </span></a>        &quot;&quot;&quot;</span>
<a name="l436"><span class="ln">436  </span></a>        <span class="s0">import </span><span class="s1">warnings</span>
<a name="l437"><span class="ln">437  </span></a>
<a name="l438"><span class="ln">438  </span></a>        <span class="s1">warnings.warn(</span>
<a name="l439"><span class="ln">439  </span></a>            <span class="s3">&quot;'app.json_decoder' is deprecated and will be removed in Flask 2.3.&quot;</span>
<a name="l440"><span class="ln">440  </span></a>            <span class="s3">&quot; Customize 'app.json_provider_class' or 'app.json' instead.&quot;</span><span class="s0">,</span>
<a name="l441"><span class="ln">441  </span></a>            <span class="s1">DeprecationWarning</span><span class="s0">,</span>
<a name="l442"><span class="ln">442  </span></a>            <span class="s1">stacklevel=</span><span class="s4">2</span><span class="s0">,</span>
<a name="l443"><span class="ln">443  </span></a>        <span class="s1">)</span>
<a name="l444"><span class="ln">444  </span></a>
<a name="l445"><span class="ln">445  </span></a>        <span class="s0">if </span><span class="s1">self._json_decoder </span><span class="s0">is None</span><span class="s1">:</span>
<a name="l446"><span class="ln">446  </span></a>            <span class="s0">from </span><span class="s1">. </span><span class="s0">import </span><span class="s1">json</span>
<a name="l447"><span class="ln">447  </span></a>
<a name="l448"><span class="ln">448  </span></a>            <span class="s0">return </span><span class="s1">json.JSONDecoder</span>
<a name="l449"><span class="ln">449  </span></a>
<a name="l450"><span class="ln">450  </span></a>        <span class="s0">return </span><span class="s1">self._json_decoder</span>
<a name="l451"><span class="ln">451  </span></a>
<a name="l452"><span class="ln">452  </span></a>    <span class="s1">@json_decoder.setter</span>
<a name="l453"><span class="ln">453  </span></a>    <span class="s0">def </span><span class="s1">json_decoder(self</span><span class="s0">, </span><span class="s1">value: t.Type[json.JSONDecoder]) -&gt; </span><span class="s0">None</span><span class="s1">:</span>
<a name="l454"><span class="ln">454  </span></a>        <span class="s0">import </span><span class="s1">warnings</span>
<a name="l455"><span class="ln">455  </span></a>
<a name="l456"><span class="ln">456  </span></a>        <span class="s1">warnings.warn(</span>
<a name="l457"><span class="ln">457  </span></a>            <span class="s3">&quot;'app.json_decoder' is deprecated and will be removed in Flask 2.3.&quot;</span>
<a name="l458"><span class="ln">458  </span></a>            <span class="s3">&quot; Customize 'app.json_provider_class' or 'app.json' instead.&quot;</span><span class="s0">,</span>
<a name="l459"><span class="ln">459  </span></a>            <span class="s1">DeprecationWarning</span><span class="s0">,</span>
<a name="l460"><span class="ln">460  </span></a>            <span class="s1">stacklevel=</span><span class="s4">2</span><span class="s0">,</span>
<a name="l461"><span class="ln">461  </span></a>        <span class="s1">)</span>
<a name="l462"><span class="ln">462  </span></a>        <span class="s1">self._json_decoder = value</span>
<a name="l463"><span class="ln">463  </span></a>
<a name="l464"><span class="ln">464  </span></a>    <span class="s1">json_provider_class: t.Type[JSONProvider] = DefaultJSONProvider</span>
<a name="l465"><span class="ln">465  </span></a>    <span class="s3">&quot;&quot;&quot;A subclass of :class:`~flask.json.provider.JSONProvider`. An 
<a name="l466"><span class="ln">466  </span></a>    instance is created and assigned to :attr:`app.json` when creating 
<a name="l467"><span class="ln">467  </span></a>    the app. 
<a name="l468"><span class="ln">468  </span></a> 
<a name="l469"><span class="ln">469  </span></a>    The default, :class:`~flask.json.provider.DefaultJSONProvider`, uses 
<a name="l470"><span class="ln">470  </span></a>    Python's built-in :mod:`json` library. A different provider can use 
<a name="l471"><span class="ln">471  </span></a>    a different JSON library. 
<a name="l472"><span class="ln">472  </span></a> 
<a name="l473"><span class="ln">473  </span></a>    .. versionadded:: 2.2 
<a name="l474"><span class="ln">474  </span></a>    &quot;&quot;&quot;</span>
<a name="l475"><span class="ln">475  </span></a>
<a name="l476"><span class="ln">476  </span></a>    <span class="s2">#: Options that are passed to the Jinja environment in</span>
<a name="l477"><span class="ln">477  </span></a>    <span class="s2">#: :meth:`create_jinja_environment`. Changing these options after</span>
<a name="l478"><span class="ln">478  </span></a>    <span class="s2">#: the environment is created (accessing :attr:`jinja_env`) will</span>
<a name="l479"><span class="ln">479  </span></a>    <span class="s2">#: have no effect.</span>
<a name="l480"><span class="ln">480  </span></a>    <span class="s2">#:</span>
<a name="l481"><span class="ln">481  </span></a>    <span class="s2">#: .. versionchanged:: 1.1.0</span>
<a name="l482"><span class="ln">482  </span></a>    <span class="s2">#:     This is a ``dict`` instead of an ``ImmutableDict`` to allow</span>
<a name="l483"><span class="ln">483  </span></a>    <span class="s2">#:     easier configuration.</span>
<a name="l484"><span class="ln">484  </span></a>    <span class="s2">#:</span>
<a name="l485"><span class="ln">485  </span></a>    <span class="s1">jinja_options: dict = {}</span>
<a name="l486"><span class="ln">486  </span></a>
<a name="l487"><span class="ln">487  </span></a>    <span class="s2">#: Default configuration parameters.</span>
<a name="l488"><span class="ln">488  </span></a>    <span class="s1">default_config = ImmutableDict(</span>
<a name="l489"><span class="ln">489  </span></a>        <span class="s1">{</span>
<a name="l490"><span class="ln">490  </span></a>            <span class="s3">&quot;ENV&quot;</span><span class="s1">: </span><span class="s0">None,</span>
<a name="l491"><span class="ln">491  </span></a>            <span class="s3">&quot;DEBUG&quot;</span><span class="s1">: </span><span class="s0">None,</span>
<a name="l492"><span class="ln">492  </span></a>            <span class="s3">&quot;TESTING&quot;</span><span class="s1">: </span><span class="s0">False,</span>
<a name="l493"><span class="ln">493  </span></a>            <span class="s3">&quot;PROPAGATE_EXCEPTIONS&quot;</span><span class="s1">: </span><span class="s0">None,</span>
<a name="l494"><span class="ln">494  </span></a>            <span class="s3">&quot;SECRET_KEY&quot;</span><span class="s1">: </span><span class="s0">None,</span>
<a name="l495"><span class="ln">495  </span></a>            <span class="s3">&quot;PERMANENT_SESSION_LIFETIME&quot;</span><span class="s1">: timedelta(days=</span><span class="s4">31</span><span class="s1">)</span><span class="s0">,</span>
<a name="l496"><span class="ln">496  </span></a>            <span class="s3">&quot;USE_X_SENDFILE&quot;</span><span class="s1">: </span><span class="s0">False,</span>
<a name="l497"><span class="ln">497  </span></a>            <span class="s3">&quot;SERVER_NAME&quot;</span><span class="s1">: </span><span class="s0">None,</span>
<a name="l498"><span class="ln">498  </span></a>            <span class="s3">&quot;APPLICATION_ROOT&quot;</span><span class="s1">: </span><span class="s3">&quot;/&quot;</span><span class="s0">,</span>
<a name="l499"><span class="ln">499  </span></a>            <span class="s3">&quot;SESSION_COOKIE_NAME&quot;</span><span class="s1">: </span><span class="s3">&quot;session&quot;</span><span class="s0">,</span>
<a name="l500"><span class="ln">500  </span></a>            <span class="s3">&quot;SESSION_COOKIE_DOMAIN&quot;</span><span class="s1">: </span><span class="s0">None,</span>
<a name="l501"><span class="ln">501  </span></a>            <span class="s3">&quot;SESSION_COOKIE_PATH&quot;</span><span class="s1">: </span><span class="s0">None,</span>
<a name="l502"><span class="ln">502  </span></a>            <span class="s3">&quot;SESSION_COOKIE_HTTPONLY&quot;</span><span class="s1">: </span><span class="s0">True,</span>
<a name="l503"><span class="ln">503  </span></a>            <span class="s3">&quot;SESSION_COOKIE_SECURE&quot;</span><span class="s1">: </span><span class="s0">False,</span>
<a name="l504"><span class="ln">504  </span></a>            <span class="s3">&quot;SESSION_COOKIE_SAMESITE&quot;</span><span class="s1">: </span><span class="s0">None,</span>
<a name="l505"><span class="ln">505  </span></a>            <span class="s3">&quot;SESSION_REFRESH_EACH_REQUEST&quot;</span><span class="s1">: </span><span class="s0">True,</span>
<a name="l506"><span class="ln">506  </span></a>            <span class="s3">&quot;MAX_CONTENT_LENGTH&quot;</span><span class="s1">: </span><span class="s0">None,</span>
<a name="l507"><span class="ln">507  </span></a>            <span class="s3">&quot;SEND_FILE_MAX_AGE_DEFAULT&quot;</span><span class="s1">: </span><span class="s0">None,</span>
<a name="l508"><span class="ln">508  </span></a>            <span class="s3">&quot;TRAP_BAD_REQUEST_ERRORS&quot;</span><span class="s1">: </span><span class="s0">None,</span>
<a name="l509"><span class="ln">509  </span></a>            <span class="s3">&quot;TRAP_HTTP_EXCEPTIONS&quot;</span><span class="s1">: </span><span class="s0">False,</span>
<a name="l510"><span class="ln">510  </span></a>            <span class="s3">&quot;EXPLAIN_TEMPLATE_LOADING&quot;</span><span class="s1">: </span><span class="s0">False,</span>
<a name="l511"><span class="ln">511  </span></a>            <span class="s3">&quot;PREFERRED_URL_SCHEME&quot;</span><span class="s1">: </span><span class="s3">&quot;http&quot;</span><span class="s0">,</span>
<a name="l512"><span class="ln">512  </span></a>            <span class="s3">&quot;JSON_AS_ASCII&quot;</span><span class="s1">: </span><span class="s0">None,</span>
<a name="l513"><span class="ln">513  </span></a>            <span class="s3">&quot;JSON_SORT_KEYS&quot;</span><span class="s1">: </span><span class="s0">None,</span>
<a name="l514"><span class="ln">514  </span></a>            <span class="s3">&quot;JSONIFY_PRETTYPRINT_REGULAR&quot;</span><span class="s1">: </span><span class="s0">None,</span>
<a name="l515"><span class="ln">515  </span></a>            <span class="s3">&quot;JSONIFY_MIMETYPE&quot;</span><span class="s1">: </span><span class="s0">None,</span>
<a name="l516"><span class="ln">516  </span></a>            <span class="s3">&quot;TEMPLATES_AUTO_RELOAD&quot;</span><span class="s1">: </span><span class="s0">None,</span>
<a name="l517"><span class="ln">517  </span></a>            <span class="s3">&quot;MAX_COOKIE_SIZE&quot;</span><span class="s1">: </span><span class="s4">4093</span><span class="s0">,</span>
<a name="l518"><span class="ln">518  </span></a>        <span class="s1">}</span>
<a name="l519"><span class="ln">519  </span></a>    <span class="s1">)</span>
<a name="l520"><span class="ln">520  </span></a>
<a name="l521"><span class="ln">521  </span></a>    <span class="s2">#: The rule object to use for URL rules created.  This is used by</span>
<a name="l522"><span class="ln">522  </span></a>    <span class="s2">#: :meth:`add_url_rule`.  Defaults to :class:`werkzeug.routing.Rule`.</span>
<a name="l523"><span class="ln">523  </span></a>    <span class="s2">#:</span>
<a name="l524"><span class="ln">524  </span></a>    <span class="s2">#: .. versionadded:: 0.7</span>
<a name="l525"><span class="ln">525  </span></a>    <span class="s1">url_rule_class = Rule</span>
<a name="l526"><span class="ln">526  </span></a>
<a name="l527"><span class="ln">527  </span></a>    <span class="s2">#: The map object to use for storing the URL rules and routing</span>
<a name="l528"><span class="ln">528  </span></a>    <span class="s2">#: configuration parameters. Defaults to :class:`werkzeug.routing.Map`.</span>
<a name="l529"><span class="ln">529  </span></a>    <span class="s2">#:</span>
<a name="l530"><span class="ln">530  </span></a>    <span class="s2">#: .. versionadded:: 1.1.0</span>
<a name="l531"><span class="ln">531  </span></a>    <span class="s1">url_map_class = Map</span>
<a name="l532"><span class="ln">532  </span></a>
<a name="l533"><span class="ln">533  </span></a>    <span class="s2">#: The :meth:`test_client` method creates an instance of this test</span>
<a name="l534"><span class="ln">534  </span></a>    <span class="s2">#: client class. Defaults to :class:`~flask.testing.FlaskClient`.</span>
<a name="l535"><span class="ln">535  </span></a>    <span class="s2">#:</span>
<a name="l536"><span class="ln">536  </span></a>    <span class="s2">#: .. versionadded:: 0.7</span>
<a name="l537"><span class="ln">537  </span></a>    <span class="s1">test_client_class: t.Optional[t.Type[</span><span class="s3">&quot;FlaskClient&quot;</span><span class="s1">]] = </span><span class="s0">None</span>
<a name="l538"><span class="ln">538  </span></a>
<a name="l539"><span class="ln">539  </span></a>    <span class="s2">#: The :class:`~click.testing.CliRunner` subclass, by default</span>
<a name="l540"><span class="ln">540  </span></a>    <span class="s2">#: :class:`~flask.testing.FlaskCliRunner` that is used by</span>
<a name="l541"><span class="ln">541  </span></a>    <span class="s2">#: :meth:`test_cli_runner`. Its ``__init__`` method should take a</span>
<a name="l542"><span class="ln">542  </span></a>    <span class="s2">#: Flask app object as the first argument.</span>
<a name="l543"><span class="ln">543  </span></a>    <span class="s2">#:</span>
<a name="l544"><span class="ln">544  </span></a>    <span class="s2">#: .. versionadded:: 1.0</span>
<a name="l545"><span class="ln">545  </span></a>    <span class="s1">test_cli_runner_class: t.Optional[t.Type[</span><span class="s3">&quot;FlaskCliRunner&quot;</span><span class="s1">]] = </span><span class="s0">None</span>
<a name="l546"><span class="ln">546  </span></a>
<a name="l547"><span class="ln">547  </span></a>    <span class="s2">#: the session interface to use.  By default an instance of</span>
<a name="l548"><span class="ln">548  </span></a>    <span class="s2">#: :class:`~flask.sessions.SecureCookieSessionInterface` is used here.</span>
<a name="l549"><span class="ln">549  </span></a>    <span class="s2">#:</span>
<a name="l550"><span class="ln">550  </span></a>    <span class="s2">#: .. versionadded:: 0.8</span>
<a name="l551"><span class="ln">551  </span></a>    <span class="s1">session_interface: SessionInterface = SecureCookieSessionInterface()</span>
<a name="l552"><span class="ln">552  </span></a>
<a name="l553"><span class="ln">553  </span></a>    <span class="s0">def </span><span class="s1">__init__(</span>
<a name="l554"><span class="ln">554  </span></a>        <span class="s1">self</span><span class="s0">,</span>
<a name="l555"><span class="ln">555  </span></a>        <span class="s1">import_name: str</span><span class="s0">,</span>
<a name="l556"><span class="ln">556  </span></a>        <span class="s1">static_url_path: t.Optional[str] = </span><span class="s0">None,</span>
<a name="l557"><span class="ln">557  </span></a>        <span class="s1">static_folder: t.Optional[t.Union[str</span><span class="s0">, </span><span class="s1">os.PathLike]] = </span><span class="s3">&quot;static&quot;</span><span class="s0">,</span>
<a name="l558"><span class="ln">558  </span></a>        <span class="s1">static_host: t.Optional[str] = </span><span class="s0">None,</span>
<a name="l559"><span class="ln">559  </span></a>        <span class="s1">host_matching: bool = </span><span class="s0">False,</span>
<a name="l560"><span class="ln">560  </span></a>        <span class="s1">subdomain_matching: bool = </span><span class="s0">False,</span>
<a name="l561"><span class="ln">561  </span></a>        <span class="s1">template_folder: t.Optional[str] = </span><span class="s3">&quot;templates&quot;</span><span class="s0">,</span>
<a name="l562"><span class="ln">562  </span></a>        <span class="s1">instance_path: t.Optional[str] = </span><span class="s0">None,</span>
<a name="l563"><span class="ln">563  </span></a>        <span class="s1">instance_relative_config: bool = </span><span class="s0">False,</span>
<a name="l564"><span class="ln">564  </span></a>        <span class="s1">root_path: t.Optional[str] = </span><span class="s0">None,</span>
<a name="l565"><span class="ln">565  </span></a>    <span class="s1">):</span>
<a name="l566"><span class="ln">566  </span></a>        <span class="s1">super().__init__(</span>
<a name="l567"><span class="ln">567  </span></a>            <span class="s1">import_name=import_name</span><span class="s0">,</span>
<a name="l568"><span class="ln">568  </span></a>            <span class="s1">static_folder=static_folder</span><span class="s0">,</span>
<a name="l569"><span class="ln">569  </span></a>            <span class="s1">static_url_path=static_url_path</span><span class="s0">,</span>
<a name="l570"><span class="ln">570  </span></a>            <span class="s1">template_folder=template_folder</span><span class="s0">,</span>
<a name="l571"><span class="ln">571  </span></a>            <span class="s1">root_path=root_path</span><span class="s0">,</span>
<a name="l572"><span class="ln">572  </span></a>        <span class="s1">)</span>
<a name="l573"><span class="ln">573  </span></a>
<a name="l574"><span class="ln">574  </span></a>        <span class="s0">if </span><span class="s1">instance_path </span><span class="s0">is None</span><span class="s1">:</span>
<a name="l575"><span class="ln">575  </span></a>            <span class="s1">instance_path = self.auto_find_instance_path()</span>
<a name="l576"><span class="ln">576  </span></a>        <span class="s0">elif not </span><span class="s1">os.path.isabs(instance_path):</span>
<a name="l577"><span class="ln">577  </span></a>            <span class="s0">raise </span><span class="s1">ValueError(</span>
<a name="l578"><span class="ln">578  </span></a>                <span class="s3">&quot;If an instance path is provided it must be absolute.&quot;</span>
<a name="l579"><span class="ln">579  </span></a>                <span class="s3">&quot; A relative path was given instead.&quot;</span>
<a name="l580"><span class="ln">580  </span></a>            <span class="s1">)</span>
<a name="l581"><span class="ln">581  </span></a>
<a name="l582"><span class="ln">582  </span></a>        <span class="s2">#: Holds the path to the instance folder.</span>
<a name="l583"><span class="ln">583  </span></a>        <span class="s2">#:</span>
<a name="l584"><span class="ln">584  </span></a>        <span class="s2">#: .. versionadded:: 0.8</span>
<a name="l585"><span class="ln">585  </span></a>        <span class="s1">self.instance_path = instance_path</span>
<a name="l586"><span class="ln">586  </span></a>
<a name="l587"><span class="ln">587  </span></a>        <span class="s2">#: The configuration dictionary as :class:`Config`.  This behaves</span>
<a name="l588"><span class="ln">588  </span></a>        <span class="s2">#: exactly like a regular dictionary but supports additional methods</span>
<a name="l589"><span class="ln">589  </span></a>        <span class="s2">#: to load a config from files.</span>
<a name="l590"><span class="ln">590  </span></a>        <span class="s1">self.config = self.make_config(instance_relative_config)</span>
<a name="l591"><span class="ln">591  </span></a>
<a name="l592"><span class="ln">592  </span></a>        <span class="s2">#: An instance of :attr:`aborter_class` created by</span>
<a name="l593"><span class="ln">593  </span></a>        <span class="s2">#: :meth:`make_aborter`. This is called by :func:`flask.abort`</span>
<a name="l594"><span class="ln">594  </span></a>        <span class="s2">#: to raise HTTP errors, and can be called directly as well.</span>
<a name="l595"><span class="ln">595  </span></a>        <span class="s2">#:</span>
<a name="l596"><span class="ln">596  </span></a>        <span class="s2">#: .. versionadded:: 2.2</span>
<a name="l597"><span class="ln">597  </span></a>        <span class="s2">#:     Moved from ``flask.abort``, which calls this object.</span>
<a name="l598"><span class="ln">598  </span></a>        <span class="s1">self.aborter = self.make_aborter()</span>
<a name="l599"><span class="ln">599  </span></a>
<a name="l600"><span class="ln">600  </span></a>        <span class="s1">self.json: JSONProvider = self.json_provider_class(self)</span>
<a name="l601"><span class="ln">601  </span></a>        <span class="s3">&quot;&quot;&quot;Provides access to JSON methods. Functions in ``flask.json`` 
<a name="l602"><span class="ln">602  </span></a>        will call methods on this provider when the application context 
<a name="l603"><span class="ln">603  </span></a>        is active. Used for handling JSON requests and responses. 
<a name="l604"><span class="ln">604  </span></a> 
<a name="l605"><span class="ln">605  </span></a>        An instance of :attr:`json_provider_class`. Can be customized by 
<a name="l606"><span class="ln">606  </span></a>        changing that attribute on a subclass, or by assigning to this 
<a name="l607"><span class="ln">607  </span></a>        attribute afterwards. 
<a name="l608"><span class="ln">608  </span></a> 
<a name="l609"><span class="ln">609  </span></a>        The default, :class:`~flask.json.provider.DefaultJSONProvider`, 
<a name="l610"><span class="ln">610  </span></a>        uses Python's built-in :mod:`json` library. A different provider 
<a name="l611"><span class="ln">611  </span></a>        can use a different JSON library. 
<a name="l612"><span class="ln">612  </span></a> 
<a name="l613"><span class="ln">613  </span></a>        .. versionadded:: 2.2 
<a name="l614"><span class="ln">614  </span></a>        &quot;&quot;&quot;</span>
<a name="l615"><span class="ln">615  </span></a>
<a name="l616"><span class="ln">616  </span></a>        <span class="s2">#: A list of functions that are called by</span>
<a name="l617"><span class="ln">617  </span></a>        <span class="s2">#: :meth:`handle_url_build_error` when :meth:`.url_for` raises a</span>
<a name="l618"><span class="ln">618  </span></a>        <span class="s2">#: :exc:`~werkzeug.routing.BuildError`. Each function is called</span>
<a name="l619"><span class="ln">619  </span></a>        <span class="s2">#: with ``error``, ``endpoint`` and ``values``. If a function</span>
<a name="l620"><span class="ln">620  </span></a>        <span class="s2">#: returns ``None`` or raises a ``BuildError``, it is skipped.</span>
<a name="l621"><span class="ln">621  </span></a>        <span class="s2">#: Otherwise, its return value is returned by ``url_for``.</span>
<a name="l622"><span class="ln">622  </span></a>        <span class="s2">#:</span>
<a name="l623"><span class="ln">623  </span></a>        <span class="s2">#: .. versionadded:: 0.9</span>
<a name="l624"><span class="ln">624  </span></a>        <span class="s1">self.url_build_error_handlers: t.List[</span>
<a name="l625"><span class="ln">625  </span></a>            <span class="s1">t.Callable[[Exception</span><span class="s0">, </span><span class="s1">str</span><span class="s0">, </span><span class="s1">t.Dict[str</span><span class="s0">, </span><span class="s1">t.Any]]</span><span class="s0">, </span><span class="s1">str]</span>
<a name="l626"><span class="ln">626  </span></a>        <span class="s1">] = []</span>
<a name="l627"><span class="ln">627  </span></a>
<a name="l628"><span class="ln">628  </span></a>        <span class="s2">#: A list of functions that will be called at the beginning of the</span>
<a name="l629"><span class="ln">629  </span></a>        <span class="s2">#: first request to this instance. To register a function, use the</span>
<a name="l630"><span class="ln">630  </span></a>        <span class="s2">#: :meth:`before_first_request` decorator.</span>
<a name="l631"><span class="ln">631  </span></a>        <span class="s2">#:</span>
<a name="l632"><span class="ln">632  </span></a>        <span class="s2">#: .. deprecated:: 2.2</span>
<a name="l633"><span class="ln">633  </span></a>        <span class="s2">#:     Will be removed in Flask 2.3. Run setup code when</span>
<a name="l634"><span class="ln">634  </span></a>        <span class="s2">#:     creating the application instead.</span>
<a name="l635"><span class="ln">635  </span></a>        <span class="s2">#:</span>
<a name="l636"><span class="ln">636  </span></a>        <span class="s2">#: .. versionadded:: 0.8</span>
<a name="l637"><span class="ln">637  </span></a>        <span class="s1">self.before_first_request_funcs: t.List[ft.BeforeFirstRequestCallable] = []</span>
<a name="l638"><span class="ln">638  </span></a>
<a name="l639"><span class="ln">639  </span></a>        <span class="s2">#: A list of functions that are called when the application context</span>
<a name="l640"><span class="ln">640  </span></a>        <span class="s2">#: is destroyed.  Since the application context is also torn down</span>
<a name="l641"><span class="ln">641  </span></a>        <span class="s2">#: if the request ends this is the place to store code that disconnects</span>
<a name="l642"><span class="ln">642  </span></a>        <span class="s2">#: from databases.</span>
<a name="l643"><span class="ln">643  </span></a>        <span class="s2">#:</span>
<a name="l644"><span class="ln">644  </span></a>        <span class="s2">#: .. versionadded:: 0.9</span>
<a name="l645"><span class="ln">645  </span></a>        <span class="s1">self.teardown_appcontext_funcs: t.List[ft.TeardownCallable] = []</span>
<a name="l646"><span class="ln">646  </span></a>
<a name="l647"><span class="ln">647  </span></a>        <span class="s2">#: A list of shell context processor functions that should be run</span>
<a name="l648"><span class="ln">648  </span></a>        <span class="s2">#: when a shell context is created.</span>
<a name="l649"><span class="ln">649  </span></a>        <span class="s2">#:</span>
<a name="l650"><span class="ln">650  </span></a>        <span class="s2">#: .. versionadded:: 0.11</span>
<a name="l651"><span class="ln">651  </span></a>        <span class="s1">self.shell_context_processors: t.List[ft.ShellContextProcessorCallable] = []</span>
<a name="l652"><span class="ln">652  </span></a>
<a name="l653"><span class="ln">653  </span></a>        <span class="s2">#: Maps registered blueprint names to blueprint objects. The</span>
<a name="l654"><span class="ln">654  </span></a>        <span class="s2">#: dict retains the order the blueprints were registered in.</span>
<a name="l655"><span class="ln">655  </span></a>        <span class="s2">#: Blueprints can be registered multiple times, this dict does</span>
<a name="l656"><span class="ln">656  </span></a>        <span class="s2">#: not track how often they were attached.</span>
<a name="l657"><span class="ln">657  </span></a>        <span class="s2">#:</span>
<a name="l658"><span class="ln">658  </span></a>        <span class="s2">#: .. versionadded:: 0.7</span>
<a name="l659"><span class="ln">659  </span></a>        <span class="s1">self.blueprints: t.Dict[str</span><span class="s0">, </span><span class="s3">&quot;Blueprint&quot;</span><span class="s1">] = {}</span>
<a name="l660"><span class="ln">660  </span></a>
<a name="l661"><span class="ln">661  </span></a>        <span class="s2">#: a place where extensions can store application specific state.  For</span>
<a name="l662"><span class="ln">662  </span></a>        <span class="s2">#: example this is where an extension could store database engines and</span>
<a name="l663"><span class="ln">663  </span></a>        <span class="s2">#: similar things.</span>
<a name="l664"><span class="ln">664  </span></a>        <span class="s2">#:</span>
<a name="l665"><span class="ln">665  </span></a>        <span class="s2">#: The key must match the name of the extension module. For example in</span>
<a name="l666"><span class="ln">666  </span></a>        <span class="s2">#: case of a &quot;Flask-Foo&quot; extension in `flask_foo`, the key would be</span>
<a name="l667"><span class="ln">667  </span></a>        <span class="s2">#: ``'foo'``.</span>
<a name="l668"><span class="ln">668  </span></a>        <span class="s2">#:</span>
<a name="l669"><span class="ln">669  </span></a>        <span class="s2">#: .. versionadded:: 0.7</span>
<a name="l670"><span class="ln">670  </span></a>        <span class="s1">self.extensions: dict = {}</span>
<a name="l671"><span class="ln">671  </span></a>
<a name="l672"><span class="ln">672  </span></a>        <span class="s2">#: The :class:`~werkzeug.routing.Map` for this instance.  You can use</span>
<a name="l673"><span class="ln">673  </span></a>        <span class="s2">#: this to change the routing converters after the class was created</span>
<a name="l674"><span class="ln">674  </span></a>        <span class="s2">#: but before any routes are connected.  Example::</span>
<a name="l675"><span class="ln">675  </span></a>        <span class="s2">#:</span>
<a name="l676"><span class="ln">676  </span></a>        <span class="s2">#:    from werkzeug.routing import BaseConverter</span>
<a name="l677"><span class="ln">677  </span></a>        <span class="s2">#:</span>
<a name="l678"><span class="ln">678  </span></a>        <span class="s2">#:    class ListConverter(BaseConverter):</span>
<a name="l679"><span class="ln">679  </span></a>        <span class="s2">#:        def to_python(self, value):</span>
<a name="l680"><span class="ln">680  </span></a>        <span class="s2">#:            return value.split(',')</span>
<a name="l681"><span class="ln">681  </span></a>        <span class="s2">#:        def to_url(self, values):</span>
<a name="l682"><span class="ln">682  </span></a>        <span class="s2">#:            return ','.join(super(ListConverter, self).to_url(value)</span>
<a name="l683"><span class="ln">683  </span></a>        <span class="s2">#:                            for value in values)</span>
<a name="l684"><span class="ln">684  </span></a>        <span class="s2">#:</span>
<a name="l685"><span class="ln">685  </span></a>        <span class="s2">#:    app = Flask(__name__)</span>
<a name="l686"><span class="ln">686  </span></a>        <span class="s2">#:    app.url_map.converters['list'] = ListConverter</span>
<a name="l687"><span class="ln">687  </span></a>        <span class="s1">self.url_map = self.url_map_class()</span>
<a name="l688"><span class="ln">688  </span></a>
<a name="l689"><span class="ln">689  </span></a>        <span class="s1">self.url_map.host_matching = host_matching</span>
<a name="l690"><span class="ln">690  </span></a>        <span class="s1">self.subdomain_matching = subdomain_matching</span>
<a name="l691"><span class="ln">691  </span></a>
<a name="l692"><span class="ln">692  </span></a>        <span class="s2"># tracks internally if the application already handled at least one</span>
<a name="l693"><span class="ln">693  </span></a>        <span class="s2"># request.</span>
<a name="l694"><span class="ln">694  </span></a>        <span class="s1">self._got_first_request = </span><span class="s0">False</span>
<a name="l695"><span class="ln">695  </span></a>        <span class="s1">self._before_request_lock = Lock()</span>
<a name="l696"><span class="ln">696  </span></a>
<a name="l697"><span class="ln">697  </span></a>        <span class="s2"># Add a static route using the provided static_url_path, static_host,</span>
<a name="l698"><span class="ln">698  </span></a>        <span class="s2"># and static_folder if there is a configured static_folder.</span>
<a name="l699"><span class="ln">699  </span></a>        <span class="s2"># Note we do this without checking if static_folder exists.</span>
<a name="l700"><span class="ln">700  </span></a>        <span class="s2"># For one, it might be created while the server is running (e.g. during</span>
<a name="l701"><span class="ln">701  </span></a>        <span class="s2"># development). Also, Google App Engine stores static files somewhere</span>
<a name="l702"><span class="ln">702  </span></a>        <span class="s0">if </span><span class="s1">self.has_static_folder:</span>
<a name="l703"><span class="ln">703  </span></a>            <span class="s0">assert </span><span class="s1">(</span>
<a name="l704"><span class="ln">704  </span></a>                <span class="s1">bool(static_host) == host_matching</span>
<a name="l705"><span class="ln">705  </span></a>            <span class="s1">)</span><span class="s0">, </span><span class="s3">&quot;Invalid static_host/host_matching combination&quot;</span>
<a name="l706"><span class="ln">706  </span></a>            <span class="s2"># Use a weakref to avoid creating a reference cycle between the app</span>
<a name="l707"><span class="ln">707  </span></a>            <span class="s2"># and the view function (see #3761).</span>
<a name="l708"><span class="ln">708  </span></a>            <span class="s1">self_ref = weakref.ref(self)</span>
<a name="l709"><span class="ln">709  </span></a>            <span class="s1">self.add_url_rule(</span>
<a name="l710"><span class="ln">710  </span></a>                <span class="s3">f&quot;</span><span class="s0">{</span><span class="s1">self.static_url_path</span><span class="s0">}</span><span class="s3">/&lt;path:filename&gt;&quot;</span><span class="s0">,</span>
<a name="l711"><span class="ln">711  </span></a>                <span class="s1">endpoint=</span><span class="s3">&quot;static&quot;</span><span class="s0">,</span>
<a name="l712"><span class="ln">712  </span></a>                <span class="s1">host=static_host</span><span class="s0">,</span>
<a name="l713"><span class="ln">713  </span></a>                <span class="s1">view_func=</span><span class="s0">lambda </span><span class="s1">**kw: self_ref().send_static_file(**kw)</span><span class="s0">,  </span><span class="s2"># type: ignore # noqa: B950</span>
<a name="l714"><span class="ln">714  </span></a>            <span class="s1">)</span>
<a name="l715"><span class="ln">715  </span></a>
<a name="l716"><span class="ln">716  </span></a>        <span class="s2"># Set the name of the Click group in case someone wants to add</span>
<a name="l717"><span class="ln">717  </span></a>        <span class="s2"># the app's commands to another CLI tool.</span>
<a name="l718"><span class="ln">718  </span></a>        <span class="s1">self.cli.name = self.name</span>
<a name="l719"><span class="ln">719  </span></a>
<a name="l720"><span class="ln">720  </span></a>    <span class="s0">def </span><span class="s1">_check_setup_finished(self</span><span class="s0">, </span><span class="s1">f_name: str) -&gt; </span><span class="s0">None</span><span class="s1">:</span>
<a name="l721"><span class="ln">721  </span></a>        <span class="s0">if </span><span class="s1">self._got_first_request:</span>
<a name="l722"><span class="ln">722  </span></a>            <span class="s0">raise </span><span class="s1">AssertionError(</span>
<a name="l723"><span class="ln">723  </span></a>                <span class="s3">f&quot;The setup method '</span><span class="s0">{</span><span class="s1">f_name</span><span class="s0">}</span><span class="s3">' can no longer be called&quot;</span>
<a name="l724"><span class="ln">724  </span></a>                <span class="s3">&quot; on the application. It has already handled its first&quot;</span>
<a name="l725"><span class="ln">725  </span></a>                <span class="s3">&quot; request, any changes will not be applied&quot;</span>
<a name="l726"><span class="ln">726  </span></a>                <span class="s3">&quot; consistently.</span><span class="s0">\n</span><span class="s3">&quot;</span>
<a name="l727"><span class="ln">727  </span></a>                <span class="s3">&quot;Make sure all imports, decorators, functions, etc.&quot;</span>
<a name="l728"><span class="ln">728  </span></a>                <span class="s3">&quot; needed to set up the application are done before&quot;</span>
<a name="l729"><span class="ln">729  </span></a>                <span class="s3">&quot; running it.&quot;</span>
<a name="l730"><span class="ln">730  </span></a>            <span class="s1">)</span>
<a name="l731"><span class="ln">731  </span></a>
<a name="l732"><span class="ln">732  </span></a>    <span class="s1">@locked_cached_property</span>
<a name="l733"><span class="ln">733  </span></a>    <span class="s0">def </span><span class="s1">name(self) -&gt; str:  </span><span class="s2"># type: ignore</span>
<a name="l734"><span class="ln">734  </span></a>        <span class="s5">&quot;&quot;&quot;The name of the application.  This is usually the import name 
<a name="l735"><span class="ln">735  </span></a>        with the difference that it's guessed from the run file if the 
<a name="l736"><span class="ln">736  </span></a>        import name is main.  This name is used as a display name when 
<a name="l737"><span class="ln">737  </span></a>        Flask needs the name of the application.  It can be set and overridden 
<a name="l738"><span class="ln">738  </span></a>        to change the value. 
<a name="l739"><span class="ln">739  </span></a> 
<a name="l740"><span class="ln">740  </span></a>        .. versionadded:: 0.8 
<a name="l741"><span class="ln">741  </span></a>        &quot;&quot;&quot;</span>
<a name="l742"><span class="ln">742  </span></a>        <span class="s0">if </span><span class="s1">self.import_name == </span><span class="s3">&quot;__main__&quot;</span><span class="s1">:</span>
<a name="l743"><span class="ln">743  </span></a>            <span class="s1">fn = getattr(sys.modules[</span><span class="s3">&quot;__main__&quot;</span><span class="s1">]</span><span class="s0">, </span><span class="s3">&quot;__file__&quot;</span><span class="s0">, None</span><span class="s1">)</span>
<a name="l744"><span class="ln">744  </span></a>            <span class="s0">if </span><span class="s1">fn </span><span class="s0">is None</span><span class="s1">:</span>
<a name="l745"><span class="ln">745  </span></a>                <span class="s0">return </span><span class="s3">&quot;__main__&quot;</span>
<a name="l746"><span class="ln">746  </span></a>            <span class="s0">return </span><span class="s1">os.path.splitext(os.path.basename(fn))[</span><span class="s4">0</span><span class="s1">]</span>
<a name="l747"><span class="ln">747  </span></a>        <span class="s0">return </span><span class="s1">self.import_name</span>
<a name="l748"><span class="ln">748  </span></a>
<a name="l749"><span class="ln">749  </span></a>    <span class="s1">@property</span>
<a name="l750"><span class="ln">750  </span></a>    <span class="s0">def </span><span class="s1">propagate_exceptions(self) -&gt; bool:</span>
<a name="l751"><span class="ln">751  </span></a>        <span class="s5">&quot;&quot;&quot;Returns the value of the ``PROPAGATE_EXCEPTIONS`` configuration 
<a name="l752"><span class="ln">752  </span></a>        value in case it's set, otherwise a sensible default is returned. 
<a name="l753"><span class="ln">753  </span></a> 
<a name="l754"><span class="ln">754  </span></a>        .. deprecated:: 2.2 
<a name="l755"><span class="ln">755  </span></a>            Will be removed in Flask 2.3. 
<a name="l756"><span class="ln">756  </span></a> 
<a name="l757"><span class="ln">757  </span></a>        .. versionadded:: 0.7 
<a name="l758"><span class="ln">758  </span></a>        &quot;&quot;&quot;</span>
<a name="l759"><span class="ln">759  </span></a>        <span class="s0">import </span><span class="s1">warnings</span>
<a name="l760"><span class="ln">760  </span></a>
<a name="l761"><span class="ln">761  </span></a>        <span class="s1">warnings.warn(</span>
<a name="l762"><span class="ln">762  </span></a>            <span class="s3">&quot;'propagate_exceptions' is deprecated and will be removed in Flask 2.3.&quot;</span><span class="s0">,</span>
<a name="l763"><span class="ln">763  </span></a>            <span class="s1">DeprecationWarning</span><span class="s0">,</span>
<a name="l764"><span class="ln">764  </span></a>            <span class="s1">stacklevel=</span><span class="s4">2</span><span class="s0">,</span>
<a name="l765"><span class="ln">765  </span></a>        <span class="s1">)</span>
<a name="l766"><span class="ln">766  </span></a>        <span class="s1">rv = self.config[</span><span class="s3">&quot;PROPAGATE_EXCEPTIONS&quot;</span><span class="s1">]</span>
<a name="l767"><span class="ln">767  </span></a>        <span class="s0">if </span><span class="s1">rv </span><span class="s0">is not None</span><span class="s1">:</span>
<a name="l768"><span class="ln">768  </span></a>            <span class="s0">return </span><span class="s1">rv</span>
<a name="l769"><span class="ln">769  </span></a>        <span class="s0">return </span><span class="s1">self.testing </span><span class="s0">or </span><span class="s1">self.debug</span>
<a name="l770"><span class="ln">770  </span></a>
<a name="l771"><span class="ln">771  </span></a>    <span class="s1">@locked_cached_property</span>
<a name="l772"><span class="ln">772  </span></a>    <span class="s0">def </span><span class="s1">logger(self) -&gt; logging.Logger:</span>
<a name="l773"><span class="ln">773  </span></a>        <span class="s5">&quot;&quot;&quot;A standard Python :class:`~logging.Logger` for the app, with 
<a name="l774"><span class="ln">774  </span></a>        the same name as :attr:`name`. 
<a name="l775"><span class="ln">775  </span></a> 
<a name="l776"><span class="ln">776  </span></a>        In debug mode, the logger's :attr:`~logging.Logger.level` will 
<a name="l777"><span class="ln">777  </span></a>        be set to :data:`~logging.DEBUG`. 
<a name="l778"><span class="ln">778  </span></a> 
<a name="l779"><span class="ln">779  </span></a>        If there are no handlers configured, a default handler will be 
<a name="l780"><span class="ln">780  </span></a>        added. See :doc:`/logging` for more information. 
<a name="l781"><span class="ln">781  </span></a> 
<a name="l782"><span class="ln">782  </span></a>        .. versionchanged:: 1.1.0 
<a name="l783"><span class="ln">783  </span></a>            The logger takes the same name as :attr:`name` rather than 
<a name="l784"><span class="ln">784  </span></a>            hard-coding ``&quot;flask.app&quot;``. 
<a name="l785"><span class="ln">785  </span></a> 
<a name="l786"><span class="ln">786  </span></a>        .. versionchanged:: 1.0.0 
<a name="l787"><span class="ln">787  </span></a>            Behavior was simplified. The logger is always named 
<a name="l788"><span class="ln">788  </span></a>            ``&quot;flask.app&quot;``. The level is only set during configuration, 
<a name="l789"><span class="ln">789  </span></a>            it doesn't check ``app.debug`` each time. Only one format is 
<a name="l790"><span class="ln">790  </span></a>            used, not different ones depending on ``app.debug``. No 
<a name="l791"><span class="ln">791  </span></a>            handlers are removed, and a handler is only added if no 
<a name="l792"><span class="ln">792  </span></a>            handlers are already configured. 
<a name="l793"><span class="ln">793  </span></a> 
<a name="l794"><span class="ln">794  </span></a>        .. versionadded:: 0.3 
<a name="l795"><span class="ln">795  </span></a>        &quot;&quot;&quot;</span>
<a name="l796"><span class="ln">796  </span></a>        <span class="s0">return </span><span class="s1">create_logger(self)</span>
<a name="l797"><span class="ln">797  </span></a>
<a name="l798"><span class="ln">798  </span></a>    <span class="s1">@locked_cached_property</span>
<a name="l799"><span class="ln">799  </span></a>    <span class="s0">def </span><span class="s1">jinja_env(self) -&gt; Environment:</span>
<a name="l800"><span class="ln">800  </span></a>        <span class="s5">&quot;&quot;&quot;The Jinja environment used to load templates. 
<a name="l801"><span class="ln">801  </span></a> 
<a name="l802"><span class="ln">802  </span></a>        The environment is created the first time this property is 
<a name="l803"><span class="ln">803  </span></a>        accessed. Changing :attr:`jinja_options` after that will have no 
<a name="l804"><span class="ln">804  </span></a>        effect. 
<a name="l805"><span class="ln">805  </span></a>        &quot;&quot;&quot;</span>
<a name="l806"><span class="ln">806  </span></a>        <span class="s0">return </span><span class="s1">self.create_jinja_environment()</span>
<a name="l807"><span class="ln">807  </span></a>
<a name="l808"><span class="ln">808  </span></a>    <span class="s1">@property</span>
<a name="l809"><span class="ln">809  </span></a>    <span class="s0">def </span><span class="s1">got_first_request(self) -&gt; bool:</span>
<a name="l810"><span class="ln">810  </span></a>        <span class="s5">&quot;&quot;&quot;This attribute is set to ``True`` if the application started 
<a name="l811"><span class="ln">811  </span></a>        handling the first request. 
<a name="l812"><span class="ln">812  </span></a> 
<a name="l813"><span class="ln">813  </span></a>        .. versionadded:: 0.8 
<a name="l814"><span class="ln">814  </span></a>        &quot;&quot;&quot;</span>
<a name="l815"><span class="ln">815  </span></a>        <span class="s0">return </span><span class="s1">self._got_first_request</span>
<a name="l816"><span class="ln">816  </span></a>
<a name="l817"><span class="ln">817  </span></a>    <span class="s0">def </span><span class="s1">make_config(self</span><span class="s0">, </span><span class="s1">instance_relative: bool = </span><span class="s0">False</span><span class="s1">) -&gt; Config:</span>
<a name="l818"><span class="ln">818  </span></a>        <span class="s5">&quot;&quot;&quot;Used to create the config attribute by the Flask constructor. 
<a name="l819"><span class="ln">819  </span></a>        The `instance_relative` parameter is passed in from the constructor 
<a name="l820"><span class="ln">820  </span></a>        of Flask (there named `instance_relative_config`) and indicates if 
<a name="l821"><span class="ln">821  </span></a>        the config should be relative to the instance path or the root path 
<a name="l822"><span class="ln">822  </span></a>        of the application. 
<a name="l823"><span class="ln">823  </span></a> 
<a name="l824"><span class="ln">824  </span></a>        .. versionadded:: 0.8 
<a name="l825"><span class="ln">825  </span></a>        &quot;&quot;&quot;</span>
<a name="l826"><span class="ln">826  </span></a>        <span class="s1">root_path = self.root_path</span>
<a name="l827"><span class="ln">827  </span></a>        <span class="s0">if </span><span class="s1">instance_relative:</span>
<a name="l828"><span class="ln">828  </span></a>            <span class="s1">root_path = self.instance_path</span>
<a name="l829"><span class="ln">829  </span></a>        <span class="s1">defaults = dict(self.default_config)</span>
<a name="l830"><span class="ln">830  </span></a>        <span class="s1">defaults[</span><span class="s3">&quot;ENV&quot;</span><span class="s1">] = os.environ.get(</span><span class="s3">&quot;FLASK_ENV&quot;</span><span class="s1">) </span><span class="s0">or </span><span class="s3">&quot;production&quot;</span>
<a name="l831"><span class="ln">831  </span></a>        <span class="s1">defaults[</span><span class="s3">&quot;DEBUG&quot;</span><span class="s1">] = get_debug_flag()</span>
<a name="l832"><span class="ln">832  </span></a>        <span class="s0">return </span><span class="s1">self.config_class(root_path</span><span class="s0">, </span><span class="s1">defaults)</span>
<a name="l833"><span class="ln">833  </span></a>
<a name="l834"><span class="ln">834  </span></a>    <span class="s0">def </span><span class="s1">make_aborter(self) -&gt; Aborter:</span>
<a name="l835"><span class="ln">835  </span></a>        <span class="s5">&quot;&quot;&quot;Create the object to assign to :attr:`aborter`. That object 
<a name="l836"><span class="ln">836  </span></a>        is called by :func:`flask.abort` to raise HTTP errors, and can 
<a name="l837"><span class="ln">837  </span></a>        be called directly as well. 
<a name="l838"><span class="ln">838  </span></a> 
<a name="l839"><span class="ln">839  </span></a>        By default, this creates an instance of :attr:`aborter_class`, 
<a name="l840"><span class="ln">840  </span></a>        which defaults to :class:`werkzeug.exceptions.Aborter`. 
<a name="l841"><span class="ln">841  </span></a> 
<a name="l842"><span class="ln">842  </span></a>        .. versionadded:: 2.2 
<a name="l843"><span class="ln">843  </span></a>        &quot;&quot;&quot;</span>
<a name="l844"><span class="ln">844  </span></a>        <span class="s0">return </span><span class="s1">self.aborter_class()</span>
<a name="l845"><span class="ln">845  </span></a>
<a name="l846"><span class="ln">846  </span></a>    <span class="s0">def </span><span class="s1">auto_find_instance_path(self) -&gt; str:</span>
<a name="l847"><span class="ln">847  </span></a>        <span class="s5">&quot;&quot;&quot;Tries to locate the instance path if it was not provided to the 
<a name="l848"><span class="ln">848  </span></a>        constructor of the application class.  It will basically calculate 
<a name="l849"><span class="ln">849  </span></a>        the path to a folder named ``instance`` next to your main file or 
<a name="l850"><span class="ln">850  </span></a>        the package. 
<a name="l851"><span class="ln">851  </span></a> 
<a name="l852"><span class="ln">852  </span></a>        .. versionadded:: 0.8 
<a name="l853"><span class="ln">853  </span></a>        &quot;&quot;&quot;</span>
<a name="l854"><span class="ln">854  </span></a>        <span class="s1">prefix</span><span class="s0">, </span><span class="s1">package_path = find_package(self.import_name)</span>
<a name="l855"><span class="ln">855  </span></a>        <span class="s0">if </span><span class="s1">prefix </span><span class="s0">is None</span><span class="s1">:</span>
<a name="l856"><span class="ln">856  </span></a>            <span class="s0">return </span><span class="s1">os.path.join(package_path</span><span class="s0">, </span><span class="s3">&quot;instance&quot;</span><span class="s1">)</span>
<a name="l857"><span class="ln">857  </span></a>        <span class="s0">return </span><span class="s1">os.path.join(prefix</span><span class="s0">, </span><span class="s3">&quot;var&quot;</span><span class="s0">, </span><span class="s3">f&quot;</span><span class="s0">{</span><span class="s1">self.name</span><span class="s0">}</span><span class="s3">-instance&quot;</span><span class="s1">)</span>
<a name="l858"><span class="ln">858  </span></a>
<a name="l859"><span class="ln">859  </span></a>    <span class="s0">def </span><span class="s1">open_instance_resource(self</span><span class="s0">, </span><span class="s1">resource: str</span><span class="s0">, </span><span class="s1">mode: str = </span><span class="s3">&quot;rb&quot;</span><span class="s1">) -&gt; t.IO[t.AnyStr]:</span>
<a name="l860"><span class="ln">860  </span></a>        <span class="s5">&quot;&quot;&quot;Opens a resource from the application's instance folder 
<a name="l861"><span class="ln">861  </span></a>        (:attr:`instance_path`).  Otherwise works like 
<a name="l862"><span class="ln">862  </span></a>        :meth:`open_resource`.  Instance resources can also be opened for 
<a name="l863"><span class="ln">863  </span></a>        writing. 
<a name="l864"><span class="ln">864  </span></a> 
<a name="l865"><span class="ln">865  </span></a>        :param resource: the name of the resource.  To access resources within 
<a name="l866"><span class="ln">866  </span></a>                         subfolders use forward slashes as separator. 
<a name="l867"><span class="ln">867  </span></a>        :param mode: resource file opening mode, default is 'rb'. 
<a name="l868"><span class="ln">868  </span></a>        &quot;&quot;&quot;</span>
<a name="l869"><span class="ln">869  </span></a>        <span class="s0">return </span><span class="s1">open(os.path.join(self.instance_path</span><span class="s0">, </span><span class="s1">resource)</span><span class="s0">, </span><span class="s1">mode)</span>
<a name="l870"><span class="ln">870  </span></a>
<a name="l871"><span class="ln">871  </span></a>    <span class="s1">@property</span>
<a name="l872"><span class="ln">872  </span></a>    <span class="s0">def </span><span class="s1">templates_auto_reload(self) -&gt; bool:</span>
<a name="l873"><span class="ln">873  </span></a>        <span class="s5">&quot;&quot;&quot;Reload templates when they are changed. Used by 
<a name="l874"><span class="ln">874  </span></a>        :meth:`create_jinja_environment`. It is enabled by default in debug mode. 
<a name="l875"><span class="ln">875  </span></a> 
<a name="l876"><span class="ln">876  </span></a>        .. deprecated:: 2.2 
<a name="l877"><span class="ln">877  </span></a>            Will be removed in Flask 2.3. Use ``app.config[&quot;TEMPLATES_AUTO_RELOAD&quot;]`` 
<a name="l878"><span class="ln">878  </span></a>            instead. 
<a name="l879"><span class="ln">879  </span></a> 
<a name="l880"><span class="ln">880  </span></a>        .. versionadded:: 1.0 
<a name="l881"><span class="ln">881  </span></a>            This property was added but the underlying config and behavior 
<a name="l882"><span class="ln">882  </span></a>            already existed. 
<a name="l883"><span class="ln">883  </span></a>        &quot;&quot;&quot;</span>
<a name="l884"><span class="ln">884  </span></a>        <span class="s0">import </span><span class="s1">warnings</span>
<a name="l885"><span class="ln">885  </span></a>
<a name="l886"><span class="ln">886  </span></a>        <span class="s1">warnings.warn(</span>
<a name="l887"><span class="ln">887  </span></a>            <span class="s3">&quot;'templates_auto_reload' is deprecated and will be removed in Flask 2.3.&quot;</span>
<a name="l888"><span class="ln">888  </span></a>            <span class="s3">&quot; Use 'TEMPLATES_AUTO_RELOAD' in 'app.config' instead.&quot;</span><span class="s0">,</span>
<a name="l889"><span class="ln">889  </span></a>            <span class="s1">DeprecationWarning</span><span class="s0">,</span>
<a name="l890"><span class="ln">890  </span></a>            <span class="s1">stacklevel=</span><span class="s4">2</span><span class="s0">,</span>
<a name="l891"><span class="ln">891  </span></a>        <span class="s1">)</span>
<a name="l892"><span class="ln">892  </span></a>        <span class="s1">rv = self.config[</span><span class="s3">&quot;TEMPLATES_AUTO_RELOAD&quot;</span><span class="s1">]</span>
<a name="l893"><span class="ln">893  </span></a>        <span class="s0">return </span><span class="s1">rv </span><span class="s0">if </span><span class="s1">rv </span><span class="s0">is not None else </span><span class="s1">self.debug</span>
<a name="l894"><span class="ln">894  </span></a>
<a name="l895"><span class="ln">895  </span></a>    <span class="s1">@templates_auto_reload.setter</span>
<a name="l896"><span class="ln">896  </span></a>    <span class="s0">def </span><span class="s1">templates_auto_reload(self</span><span class="s0">, </span><span class="s1">value: bool) -&gt; </span><span class="s0">None</span><span class="s1">:</span>
<a name="l897"><span class="ln">897  </span></a>        <span class="s0">import </span><span class="s1">warnings</span>
<a name="l898"><span class="ln">898  </span></a>
<a name="l899"><span class="ln">899  </span></a>        <span class="s1">warnings.warn(</span>
<a name="l900"><span class="ln">900  </span></a>            <span class="s3">&quot;'templates_auto_reload' is deprecated and will be removed in Flask 2.3.&quot;</span>
<a name="l901"><span class="ln">901  </span></a>            <span class="s3">&quot; Use 'TEMPLATES_AUTO_RELOAD' in 'app.config' instead.&quot;</span><span class="s0">,</span>
<a name="l902"><span class="ln">902  </span></a>            <span class="s1">DeprecationWarning</span><span class="s0">,</span>
<a name="l903"><span class="ln">903  </span></a>            <span class="s1">stacklevel=</span><span class="s4">2</span><span class="s0">,</span>
<a name="l904"><span class="ln">904  </span></a>        <span class="s1">)</span>
<a name="l905"><span class="ln">905  </span></a>        <span class="s1">self.config[</span><span class="s3">&quot;TEMPLATES_AUTO_RELOAD&quot;</span><span class="s1">] = value</span>
<a name="l906"><span class="ln">906  </span></a>
<a name="l907"><span class="ln">907  </span></a>    <span class="s0">def </span><span class="s1">create_jinja_environment(self) -&gt; Environment:</span>
<a name="l908"><span class="ln">908  </span></a>        <span class="s5">&quot;&quot;&quot;Create the Jinja environment based on :attr:`jinja_options` 
<a name="l909"><span class="ln">909  </span></a>        and the various Jinja-related methods of the app. Changing 
<a name="l910"><span class="ln">910  </span></a>        :attr:`jinja_options` after this will have no effect. Also adds 
<a name="l911"><span class="ln">911  </span></a>        Flask-related globals and filters to the environment. 
<a name="l912"><span class="ln">912  </span></a> 
<a name="l913"><span class="ln">913  </span></a>        .. versionchanged:: 0.11 
<a name="l914"><span class="ln">914  </span></a>           ``Environment.auto_reload`` set in accordance with 
<a name="l915"><span class="ln">915  </span></a>           ``TEMPLATES_AUTO_RELOAD`` configuration option. 
<a name="l916"><span class="ln">916  </span></a> 
<a name="l917"><span class="ln">917  </span></a>        .. versionadded:: 0.5 
<a name="l918"><span class="ln">918  </span></a>        &quot;&quot;&quot;</span>
<a name="l919"><span class="ln">919  </span></a>        <span class="s1">options = dict(self.jinja_options)</span>
<a name="l920"><span class="ln">920  </span></a>
<a name="l921"><span class="ln">921  </span></a>        <span class="s0">if </span><span class="s3">&quot;autoescape&quot; </span><span class="s0">not in </span><span class="s1">options:</span>
<a name="l922"><span class="ln">922  </span></a>            <span class="s1">options[</span><span class="s3">&quot;autoescape&quot;</span><span class="s1">] = self.select_jinja_autoescape</span>
<a name="l923"><span class="ln">923  </span></a>
<a name="l924"><span class="ln">924  </span></a>        <span class="s0">if </span><span class="s3">&quot;auto_reload&quot; </span><span class="s0">not in </span><span class="s1">options:</span>
<a name="l925"><span class="ln">925  </span></a>            <span class="s1">auto_reload = self.config[</span><span class="s3">&quot;TEMPLATES_AUTO_RELOAD&quot;</span><span class="s1">]</span>
<a name="l926"><span class="ln">926  </span></a>
<a name="l927"><span class="ln">927  </span></a>            <span class="s0">if </span><span class="s1">auto_reload </span><span class="s0">is None</span><span class="s1">:</span>
<a name="l928"><span class="ln">928  </span></a>                <span class="s1">auto_reload = self.debug</span>
<a name="l929"><span class="ln">929  </span></a>
<a name="l930"><span class="ln">930  </span></a>            <span class="s1">options[</span><span class="s3">&quot;auto_reload&quot;</span><span class="s1">] = auto_reload</span>
<a name="l931"><span class="ln">931  </span></a>
<a name="l932"><span class="ln">932  </span></a>        <span class="s1">rv = self.jinja_environment(self</span><span class="s0">, </span><span class="s1">**options)</span>
<a name="l933"><span class="ln">933  </span></a>        <span class="s1">rv.globals.update(</span>
<a name="l934"><span class="ln">934  </span></a>            <span class="s1">url_for=self.url_for</span><span class="s0">,</span>
<a name="l935"><span class="ln">935  </span></a>            <span class="s1">get_flashed_messages=get_flashed_messages</span><span class="s0">,</span>
<a name="l936"><span class="ln">936  </span></a>            <span class="s1">config=self.config</span><span class="s0">,</span>
<a name="l937"><span class="ln">937  </span></a>            <span class="s2"># request, session and g are normally added with the</span>
<a name="l938"><span class="ln">938  </span></a>            <span class="s2"># context processor for efficiency reasons but for imported</span>
<a name="l939"><span class="ln">939  </span></a>            <span class="s2"># templates we also want the proxies in there.</span>
<a name="l940"><span class="ln">940  </span></a>            <span class="s1">request=request</span><span class="s0">,</span>
<a name="l941"><span class="ln">941  </span></a>            <span class="s1">session=session</span><span class="s0">,</span>
<a name="l942"><span class="ln">942  </span></a>            <span class="s1">g=g</span><span class="s0">,</span>
<a name="l943"><span class="ln">943  </span></a>        <span class="s1">)</span>
<a name="l944"><span class="ln">944  </span></a>        <span class="s1">rv.policies[</span><span class="s3">&quot;json.dumps_function&quot;</span><span class="s1">] = self.json.dumps</span>
<a name="l945"><span class="ln">945  </span></a>        <span class="s0">return </span><span class="s1">rv</span>
<a name="l946"><span class="ln">946  </span></a>
<a name="l947"><span class="ln">947  </span></a>    <span class="s0">def </span><span class="s1">create_global_jinja_loader(self) -&gt; DispatchingJinjaLoader:</span>
<a name="l948"><span class="ln">948  </span></a>        <span class="s5">&quot;&quot;&quot;Creates the loader for the Jinja2 environment.  Can be used to 
<a name="l949"><span class="ln">949  </span></a>        override just the loader and keeping the rest unchanged.  It's 
<a name="l950"><span class="ln">950  </span></a>        discouraged to override this function.  Instead one should override 
<a name="l951"><span class="ln">951  </span></a>        the :meth:`jinja_loader` function instead. 
<a name="l952"><span class="ln">952  </span></a> 
<a name="l953"><span class="ln">953  </span></a>        The global loader dispatches between the loaders of the application 
<a name="l954"><span class="ln">954  </span></a>        and the individual blueprints. 
<a name="l955"><span class="ln">955  </span></a> 
<a name="l956"><span class="ln">956  </span></a>        .. versionadded:: 0.7 
<a name="l957"><span class="ln">957  </span></a>        &quot;&quot;&quot;</span>
<a name="l958"><span class="ln">958  </span></a>        <span class="s0">return </span><span class="s1">DispatchingJinjaLoader(self)</span>
<a name="l959"><span class="ln">959  </span></a>
<a name="l960"><span class="ln">960  </span></a>    <span class="s0">def </span><span class="s1">select_jinja_autoescape(self</span><span class="s0">, </span><span class="s1">filename: str) -&gt; bool:</span>
<a name="l961"><span class="ln">961  </span></a>        <span class="s5">&quot;&quot;&quot;Returns ``True`` if autoescaping should be active for the given 
<a name="l962"><span class="ln">962  </span></a>        template name. If no template name is given, returns `True`. 
<a name="l963"><span class="ln">963  </span></a> 
<a name="l964"><span class="ln">964  </span></a>        .. versionadded:: 0.5 
<a name="l965"><span class="ln">965  </span></a>        &quot;&quot;&quot;</span>
<a name="l966"><span class="ln">966  </span></a>        <span class="s0">if </span><span class="s1">filename </span><span class="s0">is None</span><span class="s1">:</span>
<a name="l967"><span class="ln">967  </span></a>            <span class="s0">return True</span>
<a name="l968"><span class="ln">968  </span></a>        <span class="s0">return </span><span class="s1">filename.endswith((</span><span class="s3">&quot;.html&quot;</span><span class="s0">, </span><span class="s3">&quot;.htm&quot;</span><span class="s0">, </span><span class="s3">&quot;.xml&quot;</span><span class="s0">, </span><span class="s3">&quot;.xhtml&quot;</span><span class="s1">))</span>
<a name="l969"><span class="ln">969  </span></a>
<a name="l970"><span class="ln">970  </span></a>    <span class="s0">def </span><span class="s1">update_template_context(self</span><span class="s0">, </span><span class="s1">context: dict) -&gt; </span><span class="s0">None</span><span class="s1">:</span>
<a name="l971"><span class="ln">971  </span></a>        <span class="s5">&quot;&quot;&quot;Update the template context with some commonly used variables. 
<a name="l972"><span class="ln">972  </span></a>        This injects request, session, config and g into the template 
<a name="l973"><span class="ln">973  </span></a>        context as well as everything template context processors want 
<a name="l974"><span class="ln">974  </span></a>        to inject.  Note that the as of Flask 0.6, the original values 
<a name="l975"><span class="ln">975  </span></a>        in the context will not be overridden if a context processor 
<a name="l976"><span class="ln">976  </span></a>        decides to return a value with the same key. 
<a name="l977"><span class="ln">977  </span></a> 
<a name="l978"><span class="ln">978  </span></a>        :param context: the context as a dictionary that is updated in place 
<a name="l979"><span class="ln">979  </span></a>                        to add extra variables. 
<a name="l980"><span class="ln">980  </span></a>        &quot;&quot;&quot;</span>
<a name="l981"><span class="ln">981  </span></a>        <span class="s1">names: t.Iterable[t.Optional[str]] = (</span><span class="s0">None,</span><span class="s1">)</span>
<a name="l982"><span class="ln">982  </span></a>
<a name="l983"><span class="ln">983  </span></a>        <span class="s2"># A template may be rendered outside a request context.</span>
<a name="l984"><span class="ln">984  </span></a>        <span class="s0">if </span><span class="s1">request:</span>
<a name="l985"><span class="ln">985  </span></a>            <span class="s1">names = chain(names</span><span class="s0">, </span><span class="s1">reversed(request.blueprints))</span>
<a name="l986"><span class="ln">986  </span></a>
<a name="l987"><span class="ln">987  </span></a>        <span class="s2"># The values passed to render_template take precedence. Keep a</span>
<a name="l988"><span class="ln">988  </span></a>        <span class="s2"># copy to re-apply after all context functions.</span>
<a name="l989"><span class="ln">989  </span></a>        <span class="s1">orig_ctx = context.copy()</span>
<a name="l990"><span class="ln">990  </span></a>
<a name="l991"><span class="ln">991  </span></a>        <span class="s0">for </span><span class="s1">name </span><span class="s0">in </span><span class="s1">names:</span>
<a name="l992"><span class="ln">992  </span></a>            <span class="s0">if </span><span class="s1">name </span><span class="s0">in </span><span class="s1">self.template_context_processors:</span>
<a name="l993"><span class="ln">993  </span></a>                <span class="s0">for </span><span class="s1">func </span><span class="s0">in </span><span class="s1">self.template_context_processors[name]:</span>
<a name="l994"><span class="ln">994  </span></a>                    <span class="s1">context.update(func())</span>
<a name="l995"><span class="ln">995  </span></a>
<a name="l996"><span class="ln">996  </span></a>        <span class="s1">context.update(orig_ctx)</span>
<a name="l997"><span class="ln">997  </span></a>
<a name="l998"><span class="ln">998  </span></a>    <span class="s0">def </span><span class="s1">make_shell_context(self) -&gt; dict:</span>
<a name="l999"><span class="ln">999  </span></a>        <span class="s5">&quot;&quot;&quot;Returns the shell context for an interactive shell for this 
<a name="l1000"><span class="ln">1000 </span></a>        application.  This runs all the registered shell context 
<a name="l1001"><span class="ln">1001 </span></a>        processors. 
<a name="l1002"><span class="ln">1002 </span></a> 
<a name="l1003"><span class="ln">1003 </span></a>        .. versionadded:: 0.11 
<a name="l1004"><span class="ln">1004 </span></a>        &quot;&quot;&quot;</span>
<a name="l1005"><span class="ln">1005 </span></a>        <span class="s1">rv = {</span><span class="s3">&quot;app&quot;</span><span class="s1">: self</span><span class="s0">, </span><span class="s3">&quot;g&quot;</span><span class="s1">: g}</span>
<a name="l1006"><span class="ln">1006 </span></a>        <span class="s0">for </span><span class="s1">processor </span><span class="s0">in </span><span class="s1">self.shell_context_processors:</span>
<a name="l1007"><span class="ln">1007 </span></a>            <span class="s1">rv.update(processor())</span>
<a name="l1008"><span class="ln">1008 </span></a>        <span class="s0">return </span><span class="s1">rv</span>
<a name="l1009"><span class="ln">1009 </span></a>
<a name="l1010"><span class="ln">1010 </span></a>    <span class="s1">@property</span>
<a name="l1011"><span class="ln">1011 </span></a>    <span class="s0">def </span><span class="s1">env(self) -&gt; str:</span>
<a name="l1012"><span class="ln">1012 </span></a>        <span class="s5">&quot;&quot;&quot;What environment the app is running in. This maps to the :data:`ENV` config 
<a name="l1013"><span class="ln">1013 </span></a>        key. 
<a name="l1014"><span class="ln">1014 </span></a> 
<a name="l1015"><span class="ln">1015 </span></a>        **Do not enable development when deploying in production.** 
<a name="l1016"><span class="ln">1016 </span></a> 
<a name="l1017"><span class="ln">1017 </span></a>        Default: ``'production'`` 
<a name="l1018"><span class="ln">1018 </span></a> 
<a name="l1019"><span class="ln">1019 </span></a>        .. deprecated:: 2.2 
<a name="l1020"><span class="ln">1020 </span></a>            Will be removed in Flask 2.3. 
<a name="l1021"><span class="ln">1021 </span></a>        &quot;&quot;&quot;</span>
<a name="l1022"><span class="ln">1022 </span></a>        <span class="s0">import </span><span class="s1">warnings</span>
<a name="l1023"><span class="ln">1023 </span></a>
<a name="l1024"><span class="ln">1024 </span></a>        <span class="s1">warnings.warn(</span>
<a name="l1025"><span class="ln">1025 </span></a>            <span class="s3">&quot;'app.env' is deprecated and will be removed in Flask 2.3.&quot;</span>
<a name="l1026"><span class="ln">1026 </span></a>            <span class="s3">&quot; Use 'app.debug' instead.&quot;</span><span class="s0">,</span>
<a name="l1027"><span class="ln">1027 </span></a>            <span class="s1">DeprecationWarning</span><span class="s0">,</span>
<a name="l1028"><span class="ln">1028 </span></a>            <span class="s1">stacklevel=</span><span class="s4">2</span><span class="s0">,</span>
<a name="l1029"><span class="ln">1029 </span></a>        <span class="s1">)</span>
<a name="l1030"><span class="ln">1030 </span></a>        <span class="s0">return </span><span class="s1">self.config[</span><span class="s3">&quot;ENV&quot;</span><span class="s1">]</span>
<a name="l1031"><span class="ln">1031 </span></a>
<a name="l1032"><span class="ln">1032 </span></a>    <span class="s1">@env.setter</span>
<a name="l1033"><span class="ln">1033 </span></a>    <span class="s0">def </span><span class="s1">env(self</span><span class="s0">, </span><span class="s1">value: str) -&gt; </span><span class="s0">None</span><span class="s1">:</span>
<a name="l1034"><span class="ln">1034 </span></a>        <span class="s0">import </span><span class="s1">warnings</span>
<a name="l1035"><span class="ln">1035 </span></a>
<a name="l1036"><span class="ln">1036 </span></a>        <span class="s1">warnings.warn(</span>
<a name="l1037"><span class="ln">1037 </span></a>            <span class="s3">&quot;'app.env' is deprecated and will be removed in Flask 2.3.&quot;</span>
<a name="l1038"><span class="ln">1038 </span></a>            <span class="s3">&quot; Use 'app.debug' instead.&quot;</span><span class="s0">,</span>
<a name="l1039"><span class="ln">1039 </span></a>            <span class="s1">DeprecationWarning</span><span class="s0">,</span>
<a name="l1040"><span class="ln">1040 </span></a>            <span class="s1">stacklevel=</span><span class="s4">2</span><span class="s0">,</span>
<a name="l1041"><span class="ln">1041 </span></a>        <span class="s1">)</span>
<a name="l1042"><span class="ln">1042 </span></a>        <span class="s1">self.config[</span><span class="s3">&quot;ENV&quot;</span><span class="s1">] = value</span>
<a name="l1043"><span class="ln">1043 </span></a>
<a name="l1044"><span class="ln">1044 </span></a>    <span class="s1">@property</span>
<a name="l1045"><span class="ln">1045 </span></a>    <span class="s0">def </span><span class="s1">debug(self) -&gt; bool:</span>
<a name="l1046"><span class="ln">1046 </span></a>        <span class="s5">&quot;&quot;&quot;Whether debug mode is enabled. When using ``flask run`` to start the 
<a name="l1047"><span class="ln">1047 </span></a>        development server, an interactive debugger will be shown for unhandled 
<a name="l1048"><span class="ln">1048 </span></a>        exceptions, and the server will be reloaded when code changes. This maps to the 
<a name="l1049"><span class="ln">1049 </span></a>        :data:`DEBUG` config key. It may not behave as expected if set late. 
<a name="l1050"><span class="ln">1050 </span></a> 
<a name="l1051"><span class="ln">1051 </span></a>        **Do not enable debug mode when deploying in production.** 
<a name="l1052"><span class="ln">1052 </span></a> 
<a name="l1053"><span class="ln">1053 </span></a>        Default: ``False`` 
<a name="l1054"><span class="ln">1054 </span></a>        &quot;&quot;&quot;</span>
<a name="l1055"><span class="ln">1055 </span></a>        <span class="s0">return </span><span class="s1">self.config[</span><span class="s3">&quot;DEBUG&quot;</span><span class="s1">]</span>
<a name="l1056"><span class="ln">1056 </span></a>
<a name="l1057"><span class="ln">1057 </span></a>    <span class="s1">@debug.setter</span>
<a name="l1058"><span class="ln">1058 </span></a>    <span class="s0">def </span><span class="s1">debug(self</span><span class="s0">, </span><span class="s1">value: bool) -&gt; </span><span class="s0">None</span><span class="s1">:</span>
<a name="l1059"><span class="ln">1059 </span></a>        <span class="s1">self.config[</span><span class="s3">&quot;DEBUG&quot;</span><span class="s1">] = value</span>
<a name="l1060"><span class="ln">1060 </span></a>
<a name="l1061"><span class="ln">1061 </span></a>        <span class="s0">if </span><span class="s1">self.config[</span><span class="s3">&quot;TEMPLATES_AUTO_RELOAD&quot;</span><span class="s1">] </span><span class="s0">is None</span><span class="s1">:</span>
<a name="l1062"><span class="ln">1062 </span></a>            <span class="s1">self.jinja_env.auto_reload = value</span>
<a name="l1063"><span class="ln">1063 </span></a>
<a name="l1064"><span class="ln">1064 </span></a>    <span class="s0">def </span><span class="s1">run(</span>
<a name="l1065"><span class="ln">1065 </span></a>        <span class="s1">self</span><span class="s0">,</span>
<a name="l1066"><span class="ln">1066 </span></a>        <span class="s1">host: t.Optional[str] = </span><span class="s0">None,</span>
<a name="l1067"><span class="ln">1067 </span></a>        <span class="s1">port: t.Optional[int] = </span><span class="s0">None,</span>
<a name="l1068"><span class="ln">1068 </span></a>        <span class="s1">debug: t.Optional[bool] = </span><span class="s0">None,</span>
<a name="l1069"><span class="ln">1069 </span></a>        <span class="s1">load_dotenv: bool = </span><span class="s0">True,</span>
<a name="l1070"><span class="ln">1070 </span></a>        <span class="s1">**options: t.Any</span><span class="s0">,</span>
<a name="l1071"><span class="ln">1071 </span></a>    <span class="s1">) -&gt; </span><span class="s0">None</span><span class="s1">:</span>
<a name="l1072"><span class="ln">1072 </span></a>        <span class="s5">&quot;&quot;&quot;Runs the application on a local development server. 
<a name="l1073"><span class="ln">1073 </span></a> 
<a name="l1074"><span class="ln">1074 </span></a>        Do not use ``run()`` in a production setting. It is not intended to 
<a name="l1075"><span class="ln">1075 </span></a>        meet security and performance requirements for a production server. 
<a name="l1076"><span class="ln">1076 </span></a>        Instead, see :doc:`/deploying/index` for WSGI server recommendations. 
<a name="l1077"><span class="ln">1077 </span></a> 
<a name="l1078"><span class="ln">1078 </span></a>        If the :attr:`debug` flag is set the server will automatically reload 
<a name="l1079"><span class="ln">1079 </span></a>        for code changes and show a debugger in case an exception happened. 
<a name="l1080"><span class="ln">1080 </span></a> 
<a name="l1081"><span class="ln">1081 </span></a>        If you want to run the application in debug mode, but disable the 
<a name="l1082"><span class="ln">1082 </span></a>        code execution on the interactive debugger, you can pass 
<a name="l1083"><span class="ln">1083 </span></a>        ``use_evalex=False`` as parameter.  This will keep the debugger's 
<a name="l1084"><span class="ln">1084 </span></a>        traceback screen active, but disable code execution. 
<a name="l1085"><span class="ln">1085 </span></a> 
<a name="l1086"><span class="ln">1086 </span></a>        It is not recommended to use this function for development with 
<a name="l1087"><span class="ln">1087 </span></a>        automatic reloading as this is badly supported.  Instead you should 
<a name="l1088"><span class="ln">1088 </span></a>        be using the :command:`flask` command line script's ``run`` support. 
<a name="l1089"><span class="ln">1089 </span></a> 
<a name="l1090"><span class="ln">1090 </span></a>        .. admonition:: Keep in Mind 
<a name="l1091"><span class="ln">1091 </span></a> 
<a name="l1092"><span class="ln">1092 </span></a>           Flask will suppress any server error with a generic error page 
<a name="l1093"><span class="ln">1093 </span></a>           unless it is in debug mode.  As such to enable just the 
<a name="l1094"><span class="ln">1094 </span></a>           interactive debugger without the code reloading, you have to 
<a name="l1095"><span class="ln">1095 </span></a>           invoke :meth:`run` with ``debug=True`` and ``use_reloader=False``. 
<a name="l1096"><span class="ln">1096 </span></a>           Setting ``use_debugger`` to ``True`` without being in debug mode 
<a name="l1097"><span class="ln">1097 </span></a>           won't catch any exceptions because there won't be any to 
<a name="l1098"><span class="ln">1098 </span></a>           catch. 
<a name="l1099"><span class="ln">1099 </span></a> 
<a name="l1100"><span class="ln">1100 </span></a>        :param host: the hostname to listen on. Set this to ``'0.0.0.0'`` to 
<a name="l1101"><span class="ln">1101 </span></a>            have the server available externally as well. Defaults to 
<a name="l1102"><span class="ln">1102 </span></a>            ``'127.0.0.1'`` or the host in the ``SERVER_NAME`` config variable 
<a name="l1103"><span class="ln">1103 </span></a>            if present. 
<a name="l1104"><span class="ln">1104 </span></a>        :param port: the port of the webserver. Defaults to ``5000`` or the 
<a name="l1105"><span class="ln">1105 </span></a>            port defined in the ``SERVER_NAME`` config variable if present. 
<a name="l1106"><span class="ln">1106 </span></a>        :param debug: if given, enable or disable debug mode. See 
<a name="l1107"><span class="ln">1107 </span></a>            :attr:`debug`. 
<a name="l1108"><span class="ln">1108 </span></a>        :param load_dotenv: Load the nearest :file:`.env` and :file:`.flaskenv` 
<a name="l1109"><span class="ln">1109 </span></a>            files to set environment variables. Will also change the working 
<a name="l1110"><span class="ln">1110 </span></a>            directory to the directory containing the first file found. 
<a name="l1111"><span class="ln">1111 </span></a>        :param options: the options to be forwarded to the underlying Werkzeug 
<a name="l1112"><span class="ln">1112 </span></a>            server. See :func:`werkzeug.serving.run_simple` for more 
<a name="l1113"><span class="ln">1113 </span></a>            information. 
<a name="l1114"><span class="ln">1114 </span></a> 
<a name="l1115"><span class="ln">1115 </span></a>        .. versionchanged:: 1.0 
<a name="l1116"><span class="ln">1116 </span></a>            If installed, python-dotenv will be used to load environment 
<a name="l1117"><span class="ln">1117 </span></a>            variables from :file:`.env` and :file:`.flaskenv` files. 
<a name="l1118"><span class="ln">1118 </span></a> 
<a name="l1119"><span class="ln">1119 </span></a>            The :envvar:`FLASK_DEBUG` environment variable will override :attr:`debug`. 
<a name="l1120"><span class="ln">1120 </span></a> 
<a name="l1121"><span class="ln">1121 </span></a>            Threaded mode is enabled by default. 
<a name="l1122"><span class="ln">1122 </span></a> 
<a name="l1123"><span class="ln">1123 </span></a>        .. versionchanged:: 0.10 
<a name="l1124"><span class="ln">1124 </span></a>            The default port is now picked from the ``SERVER_NAME`` 
<a name="l1125"><span class="ln">1125 </span></a>            variable. 
<a name="l1126"><span class="ln">1126 </span></a>        &quot;&quot;&quot;</span>
<a name="l1127"><span class="ln">1127 </span></a>        <span class="s2"># Ignore this call so that it doesn't start another server if</span>
<a name="l1128"><span class="ln">1128 </span></a>        <span class="s2"># the 'flask run' command is used.</span>
<a name="l1129"><span class="ln">1129 </span></a>        <span class="s0">if </span><span class="s1">os.environ.get(</span><span class="s3">&quot;FLASK_RUN_FROM_CLI&quot;</span><span class="s1">) == </span><span class="s3">&quot;true&quot;</span><span class="s1">:</span>
<a name="l1130"><span class="ln">1130 </span></a>            <span class="s0">if not </span><span class="s1">is_running_from_reloader():</span>
<a name="l1131"><span class="ln">1131 </span></a>                <span class="s1">click.secho(</span>
<a name="l1132"><span class="ln">1132 </span></a>                    <span class="s3">&quot; * Ignoring a call to 'app.run()' that would block&quot;</span>
<a name="l1133"><span class="ln">1133 </span></a>                    <span class="s3">&quot; the current 'flask' CLI command.</span><span class="s0">\n</span><span class="s3">&quot;</span>
<a name="l1134"><span class="ln">1134 </span></a>                    <span class="s3">&quot;   Only call 'app.run()' in an 'if __name__ ==&quot;</span>
<a name="l1135"><span class="ln">1135 </span></a>                    <span class="s3">' &quot;__main__&quot;</span><span class="s0">\' </span><span class="s3">guard.'</span><span class="s0">,</span>
<a name="l1136"><span class="ln">1136 </span></a>                    <span class="s1">fg=</span><span class="s3">&quot;red&quot;</span><span class="s0">,</span>
<a name="l1137"><span class="ln">1137 </span></a>                <span class="s1">)</span>
<a name="l1138"><span class="ln">1138 </span></a>
<a name="l1139"><span class="ln">1139 </span></a>            <span class="s0">return</span>
<a name="l1140"><span class="ln">1140 </span></a>
<a name="l1141"><span class="ln">1141 </span></a>        <span class="s0">if </span><span class="s1">get_load_dotenv(load_dotenv):</span>
<a name="l1142"><span class="ln">1142 </span></a>            <span class="s1">cli.load_dotenv()</span>
<a name="l1143"><span class="ln">1143 </span></a>
<a name="l1144"><span class="ln">1144 </span></a>            <span class="s2"># if set, let env vars override previous values</span>
<a name="l1145"><span class="ln">1145 </span></a>            <span class="s0">if </span><span class="s3">&quot;FLASK_ENV&quot; </span><span class="s0">in </span><span class="s1">os.environ:</span>
<a name="l1146"><span class="ln">1146 </span></a>                <span class="s1">print(</span>
<a name="l1147"><span class="ln">1147 </span></a>                    <span class="s3">&quot;'FLASK_ENV' is deprecated and will not be used in&quot;</span>
<a name="l1148"><span class="ln">1148 </span></a>                    <span class="s3">&quot; Flask 2.3. Use 'FLASK_DEBUG' instead.&quot;</span><span class="s0">,</span>
<a name="l1149"><span class="ln">1149 </span></a>                    <span class="s1">file=sys.stderr</span><span class="s0">,</span>
<a name="l1150"><span class="ln">1150 </span></a>                <span class="s1">)</span>
<a name="l1151"><span class="ln">1151 </span></a>                <span class="s1">self.config[</span><span class="s3">&quot;ENV&quot;</span><span class="s1">] = os.environ.get(</span><span class="s3">&quot;FLASK_ENV&quot;</span><span class="s1">) </span><span class="s0">or </span><span class="s3">&quot;production&quot;</span>
<a name="l1152"><span class="ln">1152 </span></a>                <span class="s1">self.debug = get_debug_flag()</span>
<a name="l1153"><span class="ln">1153 </span></a>            <span class="s0">elif </span><span class="s3">&quot;FLASK_DEBUG&quot; </span><span class="s0">in </span><span class="s1">os.environ:</span>
<a name="l1154"><span class="ln">1154 </span></a>                <span class="s1">self.debug = get_debug_flag()</span>
<a name="l1155"><span class="ln">1155 </span></a>
<a name="l1156"><span class="ln">1156 </span></a>        <span class="s2"># debug passed to method overrides all other sources</span>
<a name="l1157"><span class="ln">1157 </span></a>        <span class="s0">if </span><span class="s1">debug </span><span class="s0">is not None</span><span class="s1">:</span>
<a name="l1158"><span class="ln">1158 </span></a>            <span class="s1">self.debug = bool(debug)</span>
<a name="l1159"><span class="ln">1159 </span></a>
<a name="l1160"><span class="ln">1160 </span></a>        <span class="s1">server_name = self.config.get(</span><span class="s3">&quot;SERVER_NAME&quot;</span><span class="s1">)</span>
<a name="l1161"><span class="ln">1161 </span></a>        <span class="s1">sn_host = sn_port = </span><span class="s0">None</span>
<a name="l1162"><span class="ln">1162 </span></a>
<a name="l1163"><span class="ln">1163 </span></a>        <span class="s0">if </span><span class="s1">server_name:</span>
<a name="l1164"><span class="ln">1164 </span></a>            <span class="s1">sn_host</span><span class="s0">, </span><span class="s1">_</span><span class="s0">, </span><span class="s1">sn_port = server_name.partition(</span><span class="s3">&quot;:&quot;</span><span class="s1">)</span>
<a name="l1165"><span class="ln">1165 </span></a>
<a name="l1166"><span class="ln">1166 </span></a>        <span class="s0">if not </span><span class="s1">host:</span>
<a name="l1167"><span class="ln">1167 </span></a>            <span class="s0">if </span><span class="s1">sn_host:</span>
<a name="l1168"><span class="ln">1168 </span></a>                <span class="s1">host = sn_host</span>
<a name="l1169"><span class="ln">1169 </span></a>            <span class="s0">else</span><span class="s1">:</span>
<a name="l1170"><span class="ln">1170 </span></a>                <span class="s1">host = </span><span class="s3">&quot;127.0.0.1&quot;</span>
<a name="l1171"><span class="ln">1171 </span></a>
<a name="l1172"><span class="ln">1172 </span></a>        <span class="s0">if </span><span class="s1">port </span><span class="s0">or </span><span class="s1">port == </span><span class="s4">0</span><span class="s1">:</span>
<a name="l1173"><span class="ln">1173 </span></a>            <span class="s1">port = int(port)</span>
<a name="l1174"><span class="ln">1174 </span></a>        <span class="s0">elif </span><span class="s1">sn_port:</span>
<a name="l1175"><span class="ln">1175 </span></a>            <span class="s1">port = int(sn_port)</span>
<a name="l1176"><span class="ln">1176 </span></a>        <span class="s0">else</span><span class="s1">:</span>
<a name="l1177"><span class="ln">1177 </span></a>            <span class="s1">port = </span><span class="s4">5000</span>
<a name="l1178"><span class="ln">1178 </span></a>
<a name="l1179"><span class="ln">1179 </span></a>        <span class="s1">options.setdefault(</span><span class="s3">&quot;use_reloader&quot;</span><span class="s0">, </span><span class="s1">self.debug)</span>
<a name="l1180"><span class="ln">1180 </span></a>        <span class="s1">options.setdefault(</span><span class="s3">&quot;use_debugger&quot;</span><span class="s0">, </span><span class="s1">self.debug)</span>
<a name="l1181"><span class="ln">1181 </span></a>        <span class="s1">options.setdefault(</span><span class="s3">&quot;threaded&quot;</span><span class="s0">, True</span><span class="s1">)</span>
<a name="l1182"><span class="ln">1182 </span></a>
<a name="l1183"><span class="ln">1183 </span></a>        <span class="s1">cli.show_server_banner(self.debug</span><span class="s0">, </span><span class="s1">self.name)</span>
<a name="l1184"><span class="ln">1184 </span></a>
<a name="l1185"><span class="ln">1185 </span></a>        <span class="s0">from </span><span class="s1">werkzeug.serving </span><span class="s0">import </span><span class="s1">run_simple</span>
<a name="l1186"><span class="ln">1186 </span></a>
<a name="l1187"><span class="ln">1187 </span></a>        <span class="s0">try</span><span class="s1">:</span>
<a name="l1188"><span class="ln">1188 </span></a>            <span class="s1">run_simple(t.cast(str</span><span class="s0">, </span><span class="s1">host)</span><span class="s0">, </span><span class="s1">port</span><span class="s0">, </span><span class="s1">self</span><span class="s0">, </span><span class="s1">**options)</span>
<a name="l1189"><span class="ln">1189 </span></a>        <span class="s0">finally</span><span class="s1">:</span>
<a name="l1190"><span class="ln">1190 </span></a>            <span class="s2"># reset the first request information if the development server</span>
<a name="l1191"><span class="ln">1191 </span></a>            <span class="s2"># reset normally.  This makes it possible to restart the server</span>
<a name="l1192"><span class="ln">1192 </span></a>            <span class="s2"># without reloader and that stuff from an interactive shell.</span>
<a name="l1193"><span class="ln">1193 </span></a>            <span class="s1">self._got_first_request = </span><span class="s0">False</span>
<a name="l1194"><span class="ln">1194 </span></a>
<a name="l1195"><span class="ln">1195 </span></a>    <span class="s0">def </span><span class="s1">test_client(self</span><span class="s0">, </span><span class="s1">use_cookies: bool = </span><span class="s0">True, </span><span class="s1">**kwargs: t.Any) -&gt; </span><span class="s3">&quot;FlaskClient&quot;</span><span class="s1">:</span>
<a name="l1196"><span class="ln">1196 </span></a>        <span class="s5">&quot;&quot;&quot;Creates a test client for this application.  For information 
<a name="l1197"><span class="ln">1197 </span></a>        about unit testing head over to :doc:`/testing`. 
<a name="l1198"><span class="ln">1198 </span></a> 
<a name="l1199"><span class="ln">1199 </span></a>        Note that if you are testing for assertions or exceptions in your 
<a name="l1200"><span class="ln">1200 </span></a>        application code, you must set ``app.testing = True`` in order for the 
<a name="l1201"><span class="ln">1201 </span></a>        exceptions to propagate to the test client.  Otherwise, the exception 
<a name="l1202"><span class="ln">1202 </span></a>        will be handled by the application (not visible to the test client) and 
<a name="l1203"><span class="ln">1203 </span></a>        the only indication of an AssertionError or other exception will be a 
<a name="l1204"><span class="ln">1204 </span></a>        500 status code response to the test client.  See the :attr:`testing` 
<a name="l1205"><span class="ln">1205 </span></a>        attribute.  For example:: 
<a name="l1206"><span class="ln">1206 </span></a> 
<a name="l1207"><span class="ln">1207 </span></a>            app.testing = True 
<a name="l1208"><span class="ln">1208 </span></a>            client = app.test_client() 
<a name="l1209"><span class="ln">1209 </span></a> 
<a name="l1210"><span class="ln">1210 </span></a>        The test client can be used in a ``with`` block to defer the closing down 
<a name="l1211"><span class="ln">1211 </span></a>        of the context until the end of the ``with`` block.  This is useful if 
<a name="l1212"><span class="ln">1212 </span></a>        you want to access the context locals for testing:: 
<a name="l1213"><span class="ln">1213 </span></a> 
<a name="l1214"><span class="ln">1214 </span></a>            with app.test_client() as c: 
<a name="l1215"><span class="ln">1215 </span></a>                rv = c.get('/?vodka=42') 
<a name="l1216"><span class="ln">1216 </span></a>                assert request.args['vodka'] == '42' 
<a name="l1217"><span class="ln">1217 </span></a> 
<a name="l1218"><span class="ln">1218 </span></a>        Additionally, you may pass optional keyword arguments that will then 
<a name="l1219"><span class="ln">1219 </span></a>        be passed to the application's :attr:`test_client_class` constructor. 
<a name="l1220"><span class="ln">1220 </span></a>        For example:: 
<a name="l1221"><span class="ln">1221 </span></a> 
<a name="l1222"><span class="ln">1222 </span></a>            from flask.testing import FlaskClient 
<a name="l1223"><span class="ln">1223 </span></a> 
<a name="l1224"><span class="ln">1224 </span></a>            class CustomClient(FlaskClient): 
<a name="l1225"><span class="ln">1225 </span></a>                def __init__(self, *args, **kwargs): 
<a name="l1226"><span class="ln">1226 </span></a>                    self._authentication = kwargs.pop(&quot;authentication&quot;) 
<a name="l1227"><span class="ln">1227 </span></a>                    super(CustomClient,self).__init__( *args, **kwargs) 
<a name="l1228"><span class="ln">1228 </span></a> 
<a name="l1229"><span class="ln">1229 </span></a>            app.test_client_class = CustomClient 
<a name="l1230"><span class="ln">1230 </span></a>            client = app.test_client(authentication='Basic ....') 
<a name="l1231"><span class="ln">1231 </span></a> 
<a name="l1232"><span class="ln">1232 </span></a>        See :class:`~flask.testing.FlaskClient` for more information. 
<a name="l1233"><span class="ln">1233 </span></a> 
<a name="l1234"><span class="ln">1234 </span></a>        .. versionchanged:: 0.4 
<a name="l1235"><span class="ln">1235 </span></a>           added support for ``with`` block usage for the client. 
<a name="l1236"><span class="ln">1236 </span></a> 
<a name="l1237"><span class="ln">1237 </span></a>        .. versionadded:: 0.7 
<a name="l1238"><span class="ln">1238 </span></a>           The `use_cookies` parameter was added as well as the ability 
<a name="l1239"><span class="ln">1239 </span></a>           to override the client to be used by setting the 
<a name="l1240"><span class="ln">1240 </span></a>           :attr:`test_client_class` attribute. 
<a name="l1241"><span class="ln">1241 </span></a> 
<a name="l1242"><span class="ln">1242 </span></a>        .. versionchanged:: 0.11 
<a name="l1243"><span class="ln">1243 </span></a>           Added `**kwargs` to support passing additional keyword arguments to 
<a name="l1244"><span class="ln">1244 </span></a>           the constructor of :attr:`test_client_class`. 
<a name="l1245"><span class="ln">1245 </span></a>        &quot;&quot;&quot;</span>
<a name="l1246"><span class="ln">1246 </span></a>        <span class="s1">cls = self.test_client_class</span>
<a name="l1247"><span class="ln">1247 </span></a>        <span class="s0">if </span><span class="s1">cls </span><span class="s0">is None</span><span class="s1">:</span>
<a name="l1248"><span class="ln">1248 </span></a>            <span class="s0">from </span><span class="s1">.testing </span><span class="s0">import </span><span class="s1">FlaskClient </span><span class="s0">as </span><span class="s1">cls  </span><span class="s2"># type: ignore</span>
<a name="l1249"><span class="ln">1249 </span></a>        <span class="s0">return </span><span class="s1">cls(  </span><span class="s2"># type: ignore</span>
<a name="l1250"><span class="ln">1250 </span></a>            <span class="s1">self</span><span class="s0">, </span><span class="s1">self.response_class</span><span class="s0">, </span><span class="s1">use_cookies=use_cookies</span><span class="s0">, </span><span class="s1">**kwargs</span>
<a name="l1251"><span class="ln">1251 </span></a>        <span class="s1">)</span>
<a name="l1252"><span class="ln">1252 </span></a>
<a name="l1253"><span class="ln">1253 </span></a>    <span class="s0">def </span><span class="s1">test_cli_runner(self</span><span class="s0">, </span><span class="s1">**kwargs: t.Any) -&gt; </span><span class="s3">&quot;FlaskCliRunner&quot;</span><span class="s1">:</span>
<a name="l1254"><span class="ln">1254 </span></a>        <span class="s5">&quot;&quot;&quot;Create a CLI runner for testing CLI commands. 
<a name="l1255"><span class="ln">1255 </span></a>        See :ref:`testing-cli`. 
<a name="l1256"><span class="ln">1256 </span></a> 
<a name="l1257"><span class="ln">1257 </span></a>        Returns an instance of :attr:`test_cli_runner_class`, by default 
<a name="l1258"><span class="ln">1258 </span></a>        :class:`~flask.testing.FlaskCliRunner`. The Flask app object is 
<a name="l1259"><span class="ln">1259 </span></a>        passed as the first argument. 
<a name="l1260"><span class="ln">1260 </span></a> 
<a name="l1261"><span class="ln">1261 </span></a>        .. versionadded:: 1.0 
<a name="l1262"><span class="ln">1262 </span></a>        &quot;&quot;&quot;</span>
<a name="l1263"><span class="ln">1263 </span></a>        <span class="s1">cls = self.test_cli_runner_class</span>
<a name="l1264"><span class="ln">1264 </span></a>
<a name="l1265"><span class="ln">1265 </span></a>        <span class="s0">if </span><span class="s1">cls </span><span class="s0">is None</span><span class="s1">:</span>
<a name="l1266"><span class="ln">1266 </span></a>            <span class="s0">from </span><span class="s1">.testing </span><span class="s0">import </span><span class="s1">FlaskCliRunner </span><span class="s0">as </span><span class="s1">cls  </span><span class="s2"># type: ignore</span>
<a name="l1267"><span class="ln">1267 </span></a>
<a name="l1268"><span class="ln">1268 </span></a>        <span class="s0">return </span><span class="s1">cls(self</span><span class="s0">, </span><span class="s1">**kwargs)  </span><span class="s2"># type: ignore</span>
<a name="l1269"><span class="ln">1269 </span></a>
<a name="l1270"><span class="ln">1270 </span></a>    <span class="s1">@setupmethod</span>
<a name="l1271"><span class="ln">1271 </span></a>    <span class="s0">def </span><span class="s1">register_blueprint(self</span><span class="s0">, </span><span class="s1">blueprint: </span><span class="s3">&quot;Blueprint&quot;</span><span class="s0">, </span><span class="s1">**options: t.Any) -&gt; </span><span class="s0">None</span><span class="s1">:</span>
<a name="l1272"><span class="ln">1272 </span></a>        <span class="s5">&quot;&quot;&quot;Register a :class:`~flask.Blueprint` on the application. Keyword 
<a name="l1273"><span class="ln">1273 </span></a>        arguments passed to this method will override the defaults set on the 
<a name="l1274"><span class="ln">1274 </span></a>        blueprint. 
<a name="l1275"><span class="ln">1275 </span></a> 
<a name="l1276"><span class="ln">1276 </span></a>        Calls the blueprint's :meth:`~flask.Blueprint.register` method after 
<a name="l1277"><span class="ln">1277 </span></a>        recording the blueprint in the application's :attr:`blueprints`. 
<a name="l1278"><span class="ln">1278 </span></a> 
<a name="l1279"><span class="ln">1279 </span></a>        :param blueprint: The blueprint to register. 
<a name="l1280"><span class="ln">1280 </span></a>        :param url_prefix: Blueprint routes will be prefixed with this. 
<a name="l1281"><span class="ln">1281 </span></a>        :param subdomain: Blueprint routes will match on this subdomain. 
<a name="l1282"><span class="ln">1282 </span></a>        :param url_defaults: Blueprint routes will use these default values for 
<a name="l1283"><span class="ln">1283 </span></a>            view arguments. 
<a name="l1284"><span class="ln">1284 </span></a>        :param options: Additional keyword arguments are passed to 
<a name="l1285"><span class="ln">1285 </span></a>            :class:`~flask.blueprints.BlueprintSetupState`. They can be 
<a name="l1286"><span class="ln">1286 </span></a>            accessed in :meth:`~flask.Blueprint.record` callbacks. 
<a name="l1287"><span class="ln">1287 </span></a> 
<a name="l1288"><span class="ln">1288 </span></a>        .. versionchanged:: 2.0.1 
<a name="l1289"><span class="ln">1289 </span></a>            The ``name`` option can be used to change the (pre-dotted) 
<a name="l1290"><span class="ln">1290 </span></a>            name the blueprint is registered with. This allows the same 
<a name="l1291"><span class="ln">1291 </span></a>            blueprint to be registered multiple times with unique names 
<a name="l1292"><span class="ln">1292 </span></a>            for ``url_for``. 
<a name="l1293"><span class="ln">1293 </span></a> 
<a name="l1294"><span class="ln">1294 </span></a>        .. versionadded:: 0.7 
<a name="l1295"><span class="ln">1295 </span></a>        &quot;&quot;&quot;</span>
<a name="l1296"><span class="ln">1296 </span></a>        <span class="s1">blueprint.register(self</span><span class="s0">, </span><span class="s1">options)</span>
<a name="l1297"><span class="ln">1297 </span></a>
<a name="l1298"><span class="ln">1298 </span></a>    <span class="s0">def </span><span class="s1">iter_blueprints(self) -&gt; t.ValuesView[</span><span class="s3">&quot;Blueprint&quot;</span><span class="s1">]:</span>
<a name="l1299"><span class="ln">1299 </span></a>        <span class="s5">&quot;&quot;&quot;Iterates over all blueprints by the order they were registered. 
<a name="l1300"><span class="ln">1300 </span></a> 
<a name="l1301"><span class="ln">1301 </span></a>        .. versionadded:: 0.11 
<a name="l1302"><span class="ln">1302 </span></a>        &quot;&quot;&quot;</span>
<a name="l1303"><span class="ln">1303 </span></a>        <span class="s0">return </span><span class="s1">self.blueprints.values()</span>
<a name="l1304"><span class="ln">1304 </span></a>
<a name="l1305"><span class="ln">1305 </span></a>    <span class="s1">@setupmethod</span>
<a name="l1306"><span class="ln">1306 </span></a>    <span class="s0">def </span><span class="s1">add_url_rule(</span>
<a name="l1307"><span class="ln">1307 </span></a>        <span class="s1">self</span><span class="s0">,</span>
<a name="l1308"><span class="ln">1308 </span></a>        <span class="s1">rule: str</span><span class="s0">,</span>
<a name="l1309"><span class="ln">1309 </span></a>        <span class="s1">endpoint: t.Optional[str] = </span><span class="s0">None,</span>
<a name="l1310"><span class="ln">1310 </span></a>        <span class="s1">view_func: t.Optional[ft.RouteCallable] = </span><span class="s0">None,</span>
<a name="l1311"><span class="ln">1311 </span></a>        <span class="s1">provide_automatic_options: t.Optional[bool] = </span><span class="s0">None,</span>
<a name="l1312"><span class="ln">1312 </span></a>        <span class="s1">**options: t.Any</span><span class="s0">,</span>
<a name="l1313"><span class="ln">1313 </span></a>    <span class="s1">) -&gt; </span><span class="s0">None</span><span class="s1">:</span>
<a name="l1314"><span class="ln">1314 </span></a>        <span class="s0">if </span><span class="s1">endpoint </span><span class="s0">is None</span><span class="s1">:</span>
<a name="l1315"><span class="ln">1315 </span></a>            <span class="s1">endpoint = _endpoint_from_view_func(view_func)  </span><span class="s2"># type: ignore</span>
<a name="l1316"><span class="ln">1316 </span></a>        <span class="s1">options[</span><span class="s3">&quot;endpoint&quot;</span><span class="s1">] = endpoint</span>
<a name="l1317"><span class="ln">1317 </span></a>        <span class="s1">methods = options.pop(</span><span class="s3">&quot;methods&quot;</span><span class="s0">, None</span><span class="s1">)</span>
<a name="l1318"><span class="ln">1318 </span></a>
<a name="l1319"><span class="ln">1319 </span></a>        <span class="s2"># if the methods are not given and the view_func object knows its</span>
<a name="l1320"><span class="ln">1320 </span></a>        <span class="s2"># methods we can use that instead.  If neither exists, we go with</span>
<a name="l1321"><span class="ln">1321 </span></a>        <span class="s2"># a tuple of only ``GET`` as default.</span>
<a name="l1322"><span class="ln">1322 </span></a>        <span class="s0">if </span><span class="s1">methods </span><span class="s0">is None</span><span class="s1">:</span>
<a name="l1323"><span class="ln">1323 </span></a>            <span class="s1">methods = getattr(view_func</span><span class="s0">, </span><span class="s3">&quot;methods&quot;</span><span class="s0">, None</span><span class="s1">) </span><span class="s0">or </span><span class="s1">(</span><span class="s3">&quot;GET&quot;</span><span class="s0">,</span><span class="s1">)</span>
<a name="l1324"><span class="ln">1324 </span></a>        <span class="s0">if </span><span class="s1">isinstance(methods</span><span class="s0">, </span><span class="s1">str):</span>
<a name="l1325"><span class="ln">1325 </span></a>            <span class="s0">raise </span><span class="s1">TypeError(</span>
<a name="l1326"><span class="ln">1326 </span></a>                <span class="s3">&quot;Allowed methods must be a list of strings, for&quot;</span>
<a name="l1327"><span class="ln">1327 </span></a>                <span class="s3">' example: @app.route(..., methods=[&quot;POST&quot;])'</span>
<a name="l1328"><span class="ln">1328 </span></a>            <span class="s1">)</span>
<a name="l1329"><span class="ln">1329 </span></a>        <span class="s1">methods = {item.upper() </span><span class="s0">for </span><span class="s1">item </span><span class="s0">in </span><span class="s1">methods}</span>
<a name="l1330"><span class="ln">1330 </span></a>
<a name="l1331"><span class="ln">1331 </span></a>        <span class="s2"># Methods that should always be added</span>
<a name="l1332"><span class="ln">1332 </span></a>        <span class="s1">required_methods = set(getattr(view_func</span><span class="s0">, </span><span class="s3">&quot;required_methods&quot;</span><span class="s0">, </span><span class="s1">()))</span>
<a name="l1333"><span class="ln">1333 </span></a>
<a name="l1334"><span class="ln">1334 </span></a>        <span class="s2"># starting with Flask 0.8 the view_func object can disable and</span>
<a name="l1335"><span class="ln">1335 </span></a>        <span class="s2"># force-enable the automatic options handling.</span>
<a name="l1336"><span class="ln">1336 </span></a>        <span class="s0">if </span><span class="s1">provide_automatic_options </span><span class="s0">is None</span><span class="s1">:</span>
<a name="l1337"><span class="ln">1337 </span></a>            <span class="s1">provide_automatic_options = getattr(</span>
<a name="l1338"><span class="ln">1338 </span></a>                <span class="s1">view_func</span><span class="s0">, </span><span class="s3">&quot;provide_automatic_options&quot;</span><span class="s0">, None</span>
<a name="l1339"><span class="ln">1339 </span></a>            <span class="s1">)</span>
<a name="l1340"><span class="ln">1340 </span></a>
<a name="l1341"><span class="ln">1341 </span></a>        <span class="s0">if </span><span class="s1">provide_automatic_options </span><span class="s0">is None</span><span class="s1">:</span>
<a name="l1342"><span class="ln">1342 </span></a>            <span class="s0">if </span><span class="s3">&quot;OPTIONS&quot; </span><span class="s0">not in </span><span class="s1">methods:</span>
<a name="l1343"><span class="ln">1343 </span></a>                <span class="s1">provide_automatic_options = </span><span class="s0">True</span>
<a name="l1344"><span class="ln">1344 </span></a>                <span class="s1">required_methods.add(</span><span class="s3">&quot;OPTIONS&quot;</span><span class="s1">)</span>
<a name="l1345"><span class="ln">1345 </span></a>            <span class="s0">else</span><span class="s1">:</span>
<a name="l1346"><span class="ln">1346 </span></a>                <span class="s1">provide_automatic_options = </span><span class="s0">False</span>
<a name="l1347"><span class="ln">1347 </span></a>
<a name="l1348"><span class="ln">1348 </span></a>        <span class="s2"># Add the required methods now.</span>
<a name="l1349"><span class="ln">1349 </span></a>        <span class="s1">methods |= required_methods</span>
<a name="l1350"><span class="ln">1350 </span></a>
<a name="l1351"><span class="ln">1351 </span></a>        <span class="s1">rule = self.url_rule_class(rule</span><span class="s0">, </span><span class="s1">methods=methods</span><span class="s0">, </span><span class="s1">**options)</span>
<a name="l1352"><span class="ln">1352 </span></a>        <span class="s1">rule.provide_automatic_options = provide_automatic_options  </span><span class="s2"># type: ignore</span>
<a name="l1353"><span class="ln">1353 </span></a>
<a name="l1354"><span class="ln">1354 </span></a>        <span class="s1">self.url_map.add(rule)</span>
<a name="l1355"><span class="ln">1355 </span></a>        <span class="s0">if </span><span class="s1">view_func </span><span class="s0">is not None</span><span class="s1">:</span>
<a name="l1356"><span class="ln">1356 </span></a>            <span class="s1">old_func = self.view_functions.get(endpoint)</span>
<a name="l1357"><span class="ln">1357 </span></a>            <span class="s0">if </span><span class="s1">old_func </span><span class="s0">is not None and </span><span class="s1">old_func != view_func:</span>
<a name="l1358"><span class="ln">1358 </span></a>                <span class="s0">raise </span><span class="s1">AssertionError(</span>
<a name="l1359"><span class="ln">1359 </span></a>                    <span class="s3">&quot;View function mapping is overwriting an existing&quot;</span>
<a name="l1360"><span class="ln">1360 </span></a>                    <span class="s3">f&quot; endpoint function: </span><span class="s0">{</span><span class="s1">endpoint</span><span class="s0">}</span><span class="s3">&quot;</span>
<a name="l1361"><span class="ln">1361 </span></a>                <span class="s1">)</span>
<a name="l1362"><span class="ln">1362 </span></a>            <span class="s1">self.view_functions[endpoint] = view_func</span>
<a name="l1363"><span class="ln">1363 </span></a>
<a name="l1364"><span class="ln">1364 </span></a>    <span class="s1">@setupmethod</span>
<a name="l1365"><span class="ln">1365 </span></a>    <span class="s0">def </span><span class="s1">template_filter(</span>
<a name="l1366"><span class="ln">1366 </span></a>        <span class="s1">self</span><span class="s0">, </span><span class="s1">name: t.Optional[str] = </span><span class="s0">None</span>
<a name="l1367"><span class="ln">1367 </span></a>    <span class="s1">) -&gt; t.Callable[[T_template_filter]</span><span class="s0">, </span><span class="s1">T_template_filter]:</span>
<a name="l1368"><span class="ln">1368 </span></a>        <span class="s5">&quot;&quot;&quot;A decorator that is used to register custom template filter. 
<a name="l1369"><span class="ln">1369 </span></a>        You can specify a name for the filter, otherwise the function 
<a name="l1370"><span class="ln">1370 </span></a>        name will be used. Example:: 
<a name="l1371"><span class="ln">1371 </span></a> 
<a name="l1372"><span class="ln">1372 </span></a>          @app.template_filter() 
<a name="l1373"><span class="ln">1373 </span></a>          def reverse(s): 
<a name="l1374"><span class="ln">1374 </span></a>              return s[::-1] 
<a name="l1375"><span class="ln">1375 </span></a> 
<a name="l1376"><span class="ln">1376 </span></a>        :param name: the optional name of the filter, otherwise the 
<a name="l1377"><span class="ln">1377 </span></a>                     function name will be used. 
<a name="l1378"><span class="ln">1378 </span></a>        &quot;&quot;&quot;</span>
<a name="l1379"><span class="ln">1379 </span></a>
<a name="l1380"><span class="ln">1380 </span></a>        <span class="s0">def </span><span class="s1">decorator(f: T_template_filter) -&gt; T_template_filter:</span>
<a name="l1381"><span class="ln">1381 </span></a>            <span class="s1">self.add_template_filter(f</span><span class="s0">, </span><span class="s1">name=name)</span>
<a name="l1382"><span class="ln">1382 </span></a>            <span class="s0">return </span><span class="s1">f</span>
<a name="l1383"><span class="ln">1383 </span></a>
<a name="l1384"><span class="ln">1384 </span></a>        <span class="s0">return </span><span class="s1">decorator</span>
<a name="l1385"><span class="ln">1385 </span></a>
<a name="l1386"><span class="ln">1386 </span></a>    <span class="s1">@setupmethod</span>
<a name="l1387"><span class="ln">1387 </span></a>    <span class="s0">def </span><span class="s1">add_template_filter(</span>
<a name="l1388"><span class="ln">1388 </span></a>        <span class="s1">self</span><span class="s0">, </span><span class="s1">f: ft.TemplateFilterCallable</span><span class="s0">, </span><span class="s1">name: t.Optional[str] = </span><span class="s0">None</span>
<a name="l1389"><span class="ln">1389 </span></a>    <span class="s1">) -&gt; </span><span class="s0">None</span><span class="s1">:</span>
<a name="l1390"><span class="ln">1390 </span></a>        <span class="s5">&quot;&quot;&quot;Register a custom template filter.  Works exactly like the 
<a name="l1391"><span class="ln">1391 </span></a>        :meth:`template_filter` decorator. 
<a name="l1392"><span class="ln">1392 </span></a> 
<a name="l1393"><span class="ln">1393 </span></a>        :param name: the optional name of the filter, otherwise the 
<a name="l1394"><span class="ln">1394 </span></a>                     function name will be used. 
<a name="l1395"><span class="ln">1395 </span></a>        &quot;&quot;&quot;</span>
<a name="l1396"><span class="ln">1396 </span></a>        <span class="s1">self.jinja_env.filters[name </span><span class="s0">or </span><span class="s1">f.__name__] = f</span>
<a name="l1397"><span class="ln">1397 </span></a>
<a name="l1398"><span class="ln">1398 </span></a>    <span class="s1">@setupmethod</span>
<a name="l1399"><span class="ln">1399 </span></a>    <span class="s0">def </span><span class="s1">template_test(</span>
<a name="l1400"><span class="ln">1400 </span></a>        <span class="s1">self</span><span class="s0">, </span><span class="s1">name: t.Optional[str] = </span><span class="s0">None</span>
<a name="l1401"><span class="ln">1401 </span></a>    <span class="s1">) -&gt; t.Callable[[T_template_test]</span><span class="s0">, </span><span class="s1">T_template_test]:</span>
<a name="l1402"><span class="ln">1402 </span></a>        <span class="s5">&quot;&quot;&quot;A decorator that is used to register custom template test. 
<a name="l1403"><span class="ln">1403 </span></a>        You can specify a name for the test, otherwise the function 
<a name="l1404"><span class="ln">1404 </span></a>        name will be used. Example:: 
<a name="l1405"><span class="ln">1405 </span></a> 
<a name="l1406"><span class="ln">1406 </span></a>          @app.template_test() 
<a name="l1407"><span class="ln">1407 </span></a>          def is_prime(n): 
<a name="l1408"><span class="ln">1408 </span></a>              if n == 2: 
<a name="l1409"><span class="ln">1409 </span></a>                  return True 
<a name="l1410"><span class="ln">1410 </span></a>              for i in range(2, int(math.ceil(math.sqrt(n))) + 1): 
<a name="l1411"><span class="ln">1411 </span></a>                  if n % i == 0: 
<a name="l1412"><span class="ln">1412 </span></a>                      return False 
<a name="l1413"><span class="ln">1413 </span></a>              return True 
<a name="l1414"><span class="ln">1414 </span></a> 
<a name="l1415"><span class="ln">1415 </span></a>        .. versionadded:: 0.10 
<a name="l1416"><span class="ln">1416 </span></a> 
<a name="l1417"><span class="ln">1417 </span></a>        :param name: the optional name of the test, otherwise the 
<a name="l1418"><span class="ln">1418 </span></a>                     function name will be used. 
<a name="l1419"><span class="ln">1419 </span></a>        &quot;&quot;&quot;</span>
<a name="l1420"><span class="ln">1420 </span></a>
<a name="l1421"><span class="ln">1421 </span></a>        <span class="s0">def </span><span class="s1">decorator(f: T_template_test) -&gt; T_template_test:</span>
<a name="l1422"><span class="ln">1422 </span></a>            <span class="s1">self.add_template_test(f</span><span class="s0">, </span><span class="s1">name=name)</span>
<a name="l1423"><span class="ln">1423 </span></a>            <span class="s0">return </span><span class="s1">f</span>
<a name="l1424"><span class="ln">1424 </span></a>
<a name="l1425"><span class="ln">1425 </span></a>        <span class="s0">return </span><span class="s1">decorator</span>
<a name="l1426"><span class="ln">1426 </span></a>
<a name="l1427"><span class="ln">1427 </span></a>    <span class="s1">@setupmethod</span>
<a name="l1428"><span class="ln">1428 </span></a>    <span class="s0">def </span><span class="s1">add_template_test(</span>
<a name="l1429"><span class="ln">1429 </span></a>        <span class="s1">self</span><span class="s0">, </span><span class="s1">f: ft.TemplateTestCallable</span><span class="s0">, </span><span class="s1">name: t.Optional[str] = </span><span class="s0">None</span>
<a name="l1430"><span class="ln">1430 </span></a>    <span class="s1">) -&gt; </span><span class="s0">None</span><span class="s1">:</span>
<a name="l1431"><span class="ln">1431 </span></a>        <span class="s5">&quot;&quot;&quot;Register a custom template test.  Works exactly like the 
<a name="l1432"><span class="ln">1432 </span></a>        :meth:`template_test` decorator. 
<a name="l1433"><span class="ln">1433 </span></a> 
<a name="l1434"><span class="ln">1434 </span></a>        .. versionadded:: 0.10 
<a name="l1435"><span class="ln">1435 </span></a> 
<a name="l1436"><span class="ln">1436 </span></a>        :param name: the optional name of the test, otherwise the 
<a name="l1437"><span class="ln">1437 </span></a>                     function name will be used. 
<a name="l1438"><span class="ln">1438 </span></a>        &quot;&quot;&quot;</span>
<a name="l1439"><span class="ln">1439 </span></a>        <span class="s1">self.jinja_env.tests[name </span><span class="s0">or </span><span class="s1">f.__name__] = f</span>
<a name="l1440"><span class="ln">1440 </span></a>
<a name="l1441"><span class="ln">1441 </span></a>    <span class="s1">@setupmethod</span>
<a name="l1442"><span class="ln">1442 </span></a>    <span class="s0">def </span><span class="s1">template_global(</span>
<a name="l1443"><span class="ln">1443 </span></a>        <span class="s1">self</span><span class="s0">, </span><span class="s1">name: t.Optional[str] = </span><span class="s0">None</span>
<a name="l1444"><span class="ln">1444 </span></a>    <span class="s1">) -&gt; t.Callable[[T_template_global]</span><span class="s0">, </span><span class="s1">T_template_global]:</span>
<a name="l1445"><span class="ln">1445 </span></a>        <span class="s5">&quot;&quot;&quot;A decorator that is used to register a custom template global function. 
<a name="l1446"><span class="ln">1446 </span></a>        You can specify a name for the global function, otherwise the function 
<a name="l1447"><span class="ln">1447 </span></a>        name will be used. Example:: 
<a name="l1448"><span class="ln">1448 </span></a> 
<a name="l1449"><span class="ln">1449 </span></a>            @app.template_global() 
<a name="l1450"><span class="ln">1450 </span></a>            def double(n): 
<a name="l1451"><span class="ln">1451 </span></a>                return 2 * n 
<a name="l1452"><span class="ln">1452 </span></a> 
<a name="l1453"><span class="ln">1453 </span></a>        .. versionadded:: 0.10 
<a name="l1454"><span class="ln">1454 </span></a> 
<a name="l1455"><span class="ln">1455 </span></a>        :param name: the optional name of the global function, otherwise the 
<a name="l1456"><span class="ln">1456 </span></a>                     function name will be used. 
<a name="l1457"><span class="ln">1457 </span></a>        &quot;&quot;&quot;</span>
<a name="l1458"><span class="ln">1458 </span></a>
<a name="l1459"><span class="ln">1459 </span></a>        <span class="s0">def </span><span class="s1">decorator(f: T_template_global) -&gt; T_template_global:</span>
<a name="l1460"><span class="ln">1460 </span></a>            <span class="s1">self.add_template_global(f</span><span class="s0">, </span><span class="s1">name=name)</span>
<a name="l1461"><span class="ln">1461 </span></a>            <span class="s0">return </span><span class="s1">f</span>
<a name="l1462"><span class="ln">1462 </span></a>
<a name="l1463"><span class="ln">1463 </span></a>        <span class="s0">return </span><span class="s1">decorator</span>
<a name="l1464"><span class="ln">1464 </span></a>
<a name="l1465"><span class="ln">1465 </span></a>    <span class="s1">@setupmethod</span>
<a name="l1466"><span class="ln">1466 </span></a>    <span class="s0">def </span><span class="s1">add_template_global(</span>
<a name="l1467"><span class="ln">1467 </span></a>        <span class="s1">self</span><span class="s0">, </span><span class="s1">f: ft.TemplateGlobalCallable</span><span class="s0">, </span><span class="s1">name: t.Optional[str] = </span><span class="s0">None</span>
<a name="l1468"><span class="ln">1468 </span></a>    <span class="s1">) -&gt; </span><span class="s0">None</span><span class="s1">:</span>
<a name="l1469"><span class="ln">1469 </span></a>        <span class="s5">&quot;&quot;&quot;Register a custom template global function. Works exactly like the 
<a name="l1470"><span class="ln">1470 </span></a>        :meth:`template_global` decorator. 
<a name="l1471"><span class="ln">1471 </span></a> 
<a name="l1472"><span class="ln">1472 </span></a>        .. versionadded:: 0.10 
<a name="l1473"><span class="ln">1473 </span></a> 
<a name="l1474"><span class="ln">1474 </span></a>        :param name: the optional name of the global function, otherwise the 
<a name="l1475"><span class="ln">1475 </span></a>                     function name will be used. 
<a name="l1476"><span class="ln">1476 </span></a>        &quot;&quot;&quot;</span>
<a name="l1477"><span class="ln">1477 </span></a>        <span class="s1">self.jinja_env.globals[name </span><span class="s0">or </span><span class="s1">f.__name__] = f</span>
<a name="l1478"><span class="ln">1478 </span></a>
<a name="l1479"><span class="ln">1479 </span></a>    <span class="s1">@setupmethod</span>
<a name="l1480"><span class="ln">1480 </span></a>    <span class="s0">def </span><span class="s1">before_first_request(self</span><span class="s0">, </span><span class="s1">f: T_before_first_request) -&gt; T_before_first_request:</span>
<a name="l1481"><span class="ln">1481 </span></a>        <span class="s5">&quot;&quot;&quot;Registers a function to be run before the first request to this 
<a name="l1482"><span class="ln">1482 </span></a>        instance of the application. 
<a name="l1483"><span class="ln">1483 </span></a> 
<a name="l1484"><span class="ln">1484 </span></a>        The function will be called without any arguments and its return 
<a name="l1485"><span class="ln">1485 </span></a>        value is ignored. 
<a name="l1486"><span class="ln">1486 </span></a> 
<a name="l1487"><span class="ln">1487 </span></a>        .. deprecated:: 2.2 
<a name="l1488"><span class="ln">1488 </span></a>            Will be removed in Flask 2.3. Run setup code when creating 
<a name="l1489"><span class="ln">1489 </span></a>            the application instead. 
<a name="l1490"><span class="ln">1490 </span></a> 
<a name="l1491"><span class="ln">1491 </span></a>        .. versionadded:: 0.8 
<a name="l1492"><span class="ln">1492 </span></a>        &quot;&quot;&quot;</span>
<a name="l1493"><span class="ln">1493 </span></a>        <span class="s0">import </span><span class="s1">warnings</span>
<a name="l1494"><span class="ln">1494 </span></a>
<a name="l1495"><span class="ln">1495 </span></a>        <span class="s1">warnings.warn(</span>
<a name="l1496"><span class="ln">1496 </span></a>            <span class="s3">&quot;'before_first_request' is deprecated and will be removed&quot;</span>
<a name="l1497"><span class="ln">1497 </span></a>            <span class="s3">&quot; in Flask 2.3. Run setup code while creating the&quot;</span>
<a name="l1498"><span class="ln">1498 </span></a>            <span class="s3">&quot; application instead.&quot;</span><span class="s0">,</span>
<a name="l1499"><span class="ln">1499 </span></a>            <span class="s1">DeprecationWarning</span><span class="s0">,</span>
<a name="l1500"><span class="ln">1500 </span></a>            <span class="s1">stacklevel=</span><span class="s4">2</span><span class="s0">,</span>
<a name="l1501"><span class="ln">1501 </span></a>        <span class="s1">)</span>
<a name="l1502"><span class="ln">1502 </span></a>        <span class="s1">self.before_first_request_funcs.append(f)</span>
<a name="l1503"><span class="ln">1503 </span></a>        <span class="s0">return </span><span class="s1">f</span>
<a name="l1504"><span class="ln">1504 </span></a>
<a name="l1505"><span class="ln">1505 </span></a>    <span class="s1">@setupmethod</span>
<a name="l1506"><span class="ln">1506 </span></a>    <span class="s0">def </span><span class="s1">teardown_appcontext(self</span><span class="s0">, </span><span class="s1">f: T_teardown) -&gt; T_teardown:</span>
<a name="l1507"><span class="ln">1507 </span></a>        <span class="s5">&quot;&quot;&quot;Registers a function to be called when the application 
<a name="l1508"><span class="ln">1508 </span></a>        context is popped. The application context is typically popped 
<a name="l1509"><span class="ln">1509 </span></a>        after the request context for each request, at the end of CLI 
<a name="l1510"><span class="ln">1510 </span></a>        commands, or after a manually pushed context ends. 
<a name="l1511"><span class="ln">1511 </span></a> 
<a name="l1512"><span class="ln">1512 </span></a>        .. code-block:: python 
<a name="l1513"><span class="ln">1513 </span></a> 
<a name="l1514"><span class="ln">1514 </span></a>            with app.app_context(): 
<a name="l1515"><span class="ln">1515 </span></a>                ... 
<a name="l1516"><span class="ln">1516 </span></a> 
<a name="l1517"><span class="ln">1517 </span></a>        When the ``with`` block exits (or ``ctx.pop()`` is called), the 
<a name="l1518"><span class="ln">1518 </span></a>        teardown functions are called just before the app context is 
<a name="l1519"><span class="ln">1519 </span></a>        made inactive. Since a request context typically also manages an 
<a name="l1520"><span class="ln">1520 </span></a>        application context it would also be called when you pop a 
<a name="l1521"><span class="ln">1521 </span></a>        request context. 
<a name="l1522"><span class="ln">1522 </span></a> 
<a name="l1523"><span class="ln">1523 </span></a>        When a teardown function was called because of an unhandled 
<a name="l1524"><span class="ln">1524 </span></a>        exception it will be passed an error object. If an 
<a name="l1525"><span class="ln">1525 </span></a>        :meth:`errorhandler` is registered, it will handle the exception 
<a name="l1526"><span class="ln">1526 </span></a>        and the teardown will not receive it. 
<a name="l1527"><span class="ln">1527 </span></a> 
<a name="l1528"><span class="ln">1528 </span></a>        Teardown functions must avoid raising exceptions. If they 
<a name="l1529"><span class="ln">1529 </span></a>        execute code that might fail they must surround that code with a 
<a name="l1530"><span class="ln">1530 </span></a>        ``try``/``except`` block and log any errors. 
<a name="l1531"><span class="ln">1531 </span></a> 
<a name="l1532"><span class="ln">1532 </span></a>        The return values of teardown functions are ignored. 
<a name="l1533"><span class="ln">1533 </span></a> 
<a name="l1534"><span class="ln">1534 </span></a>        .. versionadded:: 0.9 
<a name="l1535"><span class="ln">1535 </span></a>        &quot;&quot;&quot;</span>
<a name="l1536"><span class="ln">1536 </span></a>        <span class="s1">self.teardown_appcontext_funcs.append(f)</span>
<a name="l1537"><span class="ln">1537 </span></a>        <span class="s0">return </span><span class="s1">f</span>
<a name="l1538"><span class="ln">1538 </span></a>
<a name="l1539"><span class="ln">1539 </span></a>    <span class="s1">@setupmethod</span>
<a name="l1540"><span class="ln">1540 </span></a>    <span class="s0">def </span><span class="s1">shell_context_processor(</span>
<a name="l1541"><span class="ln">1541 </span></a>        <span class="s1">self</span><span class="s0">, </span><span class="s1">f: T_shell_context_processor</span>
<a name="l1542"><span class="ln">1542 </span></a>    <span class="s1">) -&gt; T_shell_context_processor:</span>
<a name="l1543"><span class="ln">1543 </span></a>        <span class="s5">&quot;&quot;&quot;Registers a shell context processor function. 
<a name="l1544"><span class="ln">1544 </span></a> 
<a name="l1545"><span class="ln">1545 </span></a>        .. versionadded:: 0.11 
<a name="l1546"><span class="ln">1546 </span></a>        &quot;&quot;&quot;</span>
<a name="l1547"><span class="ln">1547 </span></a>        <span class="s1">self.shell_context_processors.append(f)</span>
<a name="l1548"><span class="ln">1548 </span></a>        <span class="s0">return </span><span class="s1">f</span>
<a name="l1549"><span class="ln">1549 </span></a>
<a name="l1550"><span class="ln">1550 </span></a>    <span class="s0">def </span><span class="s1">_find_error_handler(self</span><span class="s0">, </span><span class="s1">e: Exception) -&gt; t.Optional[ft.ErrorHandlerCallable]:</span>
<a name="l1551"><span class="ln">1551 </span></a>        <span class="s5">&quot;&quot;&quot;Return a registered error handler for an exception in this order: 
<a name="l1552"><span class="ln">1552 </span></a>        blueprint handler for a specific code, app handler for a specific code, 
<a name="l1553"><span class="ln">1553 </span></a>        blueprint handler for an exception class, app handler for an exception 
<a name="l1554"><span class="ln">1554 </span></a>        class, or ``None`` if a suitable handler is not found. 
<a name="l1555"><span class="ln">1555 </span></a>        &quot;&quot;&quot;</span>
<a name="l1556"><span class="ln">1556 </span></a>        <span class="s1">exc_class</span><span class="s0">, </span><span class="s1">code = self._get_exc_class_and_code(type(e))</span>
<a name="l1557"><span class="ln">1557 </span></a>        <span class="s1">names = (*request.blueprints</span><span class="s0">, None</span><span class="s1">)</span>
<a name="l1558"><span class="ln">1558 </span></a>
<a name="l1559"><span class="ln">1559 </span></a>        <span class="s0">for </span><span class="s1">c </span><span class="s0">in </span><span class="s1">(code</span><span class="s0">, None</span><span class="s1">) </span><span class="s0">if </span><span class="s1">code </span><span class="s0">is not None else </span><span class="s1">(</span><span class="s0">None,</span><span class="s1">):</span>
<a name="l1560"><span class="ln">1560 </span></a>            <span class="s0">for </span><span class="s1">name </span><span class="s0">in </span><span class="s1">names:</span>
<a name="l1561"><span class="ln">1561 </span></a>                <span class="s1">handler_map = self.error_handler_spec[name][c]</span>
<a name="l1562"><span class="ln">1562 </span></a>
<a name="l1563"><span class="ln">1563 </span></a>                <span class="s0">if not </span><span class="s1">handler_map:</span>
<a name="l1564"><span class="ln">1564 </span></a>                    <span class="s0">continue</span>
<a name="l1565"><span class="ln">1565 </span></a>
<a name="l1566"><span class="ln">1566 </span></a>                <span class="s0">for </span><span class="s1">cls </span><span class="s0">in </span><span class="s1">exc_class.__mro__:</span>
<a name="l1567"><span class="ln">1567 </span></a>                    <span class="s1">handler = handler_map.get(cls)</span>
<a name="l1568"><span class="ln">1568 </span></a>
<a name="l1569"><span class="ln">1569 </span></a>                    <span class="s0">if </span><span class="s1">handler </span><span class="s0">is not None</span><span class="s1">:</span>
<a name="l1570"><span class="ln">1570 </span></a>                        <span class="s0">return </span><span class="s1">handler</span>
<a name="l1571"><span class="ln">1571 </span></a>        <span class="s0">return None</span>
<a name="l1572"><span class="ln">1572 </span></a>
<a name="l1573"><span class="ln">1573 </span></a>    <span class="s0">def </span><span class="s1">handle_http_exception(</span>
<a name="l1574"><span class="ln">1574 </span></a>        <span class="s1">self</span><span class="s0">, </span><span class="s1">e: HTTPException</span>
<a name="l1575"><span class="ln">1575 </span></a>    <span class="s1">) -&gt; t.Union[HTTPException</span><span class="s0">, </span><span class="s1">ft.ResponseReturnValue]:</span>
<a name="l1576"><span class="ln">1576 </span></a>        <span class="s5">&quot;&quot;&quot;Handles an HTTP exception.  By default this will invoke the 
<a name="l1577"><span class="ln">1577 </span></a>        registered error handlers and fall back to returning the 
<a name="l1578"><span class="ln">1578 </span></a>        exception as response. 
<a name="l1579"><span class="ln">1579 </span></a> 
<a name="l1580"><span class="ln">1580 </span></a>        .. versionchanged:: 1.0.3 
<a name="l1581"><span class="ln">1581 </span></a>            ``RoutingException``, used internally for actions such as 
<a name="l1582"><span class="ln">1582 </span></a>             slash redirects during routing, is not passed to error 
<a name="l1583"><span class="ln">1583 </span></a>             handlers. 
<a name="l1584"><span class="ln">1584 </span></a> 
<a name="l1585"><span class="ln">1585 </span></a>        .. versionchanged:: 1.0 
<a name="l1586"><span class="ln">1586 </span></a>            Exceptions are looked up by code *and* by MRO, so 
<a name="l1587"><span class="ln">1587 </span></a>            ``HTTPException`` subclasses can be handled with a catch-all 
<a name="l1588"><span class="ln">1588 </span></a>            handler for the base ``HTTPException``. 
<a name="l1589"><span class="ln">1589 </span></a> 
<a name="l1590"><span class="ln">1590 </span></a>        .. versionadded:: 0.3 
<a name="l1591"><span class="ln">1591 </span></a>        &quot;&quot;&quot;</span>
<a name="l1592"><span class="ln">1592 </span></a>        <span class="s2"># Proxy exceptions don't have error codes.  We want to always return</span>
<a name="l1593"><span class="ln">1593 </span></a>        <span class="s2"># those unchanged as errors</span>
<a name="l1594"><span class="ln">1594 </span></a>        <span class="s0">if </span><span class="s1">e.code </span><span class="s0">is None</span><span class="s1">:</span>
<a name="l1595"><span class="ln">1595 </span></a>            <span class="s0">return </span><span class="s1">e</span>
<a name="l1596"><span class="ln">1596 </span></a>
<a name="l1597"><span class="ln">1597 </span></a>        <span class="s2"># RoutingExceptions are used internally to trigger routing</span>
<a name="l1598"><span class="ln">1598 </span></a>        <span class="s2"># actions, such as slash redirects raising RequestRedirect. They</span>
<a name="l1599"><span class="ln">1599 </span></a>        <span class="s2"># are not raised or handled in user code.</span>
<a name="l1600"><span class="ln">1600 </span></a>        <span class="s0">if </span><span class="s1">isinstance(e</span><span class="s0">, </span><span class="s1">RoutingException):</span>
<a name="l1601"><span class="ln">1601 </span></a>            <span class="s0">return </span><span class="s1">e</span>
<a name="l1602"><span class="ln">1602 </span></a>
<a name="l1603"><span class="ln">1603 </span></a>        <span class="s1">handler = self._find_error_handler(e)</span>
<a name="l1604"><span class="ln">1604 </span></a>        <span class="s0">if </span><span class="s1">handler </span><span class="s0">is None</span><span class="s1">:</span>
<a name="l1605"><span class="ln">1605 </span></a>            <span class="s0">return </span><span class="s1">e</span>
<a name="l1606"><span class="ln">1606 </span></a>        <span class="s0">return </span><span class="s1">self.ensure_sync(handler)(e)</span>
<a name="l1607"><span class="ln">1607 </span></a>
<a name="l1608"><span class="ln">1608 </span></a>    <span class="s0">def </span><span class="s1">trap_http_exception(self</span><span class="s0">, </span><span class="s1">e: Exception) -&gt; bool:</span>
<a name="l1609"><span class="ln">1609 </span></a>        <span class="s5">&quot;&quot;&quot;Checks if an HTTP exception should be trapped or not.  By default 
<a name="l1610"><span class="ln">1610 </span></a>        this will return ``False`` for all exceptions except for a bad request 
<a name="l1611"><span class="ln">1611 </span></a>        key error if ``TRAP_BAD_REQUEST_ERRORS`` is set to ``True``.  It 
<a name="l1612"><span class="ln">1612 </span></a>        also returns ``True`` if ``TRAP_HTTP_EXCEPTIONS`` is set to ``True``. 
<a name="l1613"><span class="ln">1613 </span></a> 
<a name="l1614"><span class="ln">1614 </span></a>        This is called for all HTTP exceptions raised by a view function. 
<a name="l1615"><span class="ln">1615 </span></a>        If it returns ``True`` for any exception the error handler for this 
<a name="l1616"><span class="ln">1616 </span></a>        exception is not called and it shows up as regular exception in the 
<a name="l1617"><span class="ln">1617 </span></a>        traceback.  This is helpful for debugging implicitly raised HTTP 
<a name="l1618"><span class="ln">1618 </span></a>        exceptions. 
<a name="l1619"><span class="ln">1619 </span></a> 
<a name="l1620"><span class="ln">1620 </span></a>        .. versionchanged:: 1.0 
<a name="l1621"><span class="ln">1621 </span></a>            Bad request errors are not trapped by default in debug mode. 
<a name="l1622"><span class="ln">1622 </span></a> 
<a name="l1623"><span class="ln">1623 </span></a>        .. versionadded:: 0.8 
<a name="l1624"><span class="ln">1624 </span></a>        &quot;&quot;&quot;</span>
<a name="l1625"><span class="ln">1625 </span></a>        <span class="s0">if </span><span class="s1">self.config[</span><span class="s3">&quot;TRAP_HTTP_EXCEPTIONS&quot;</span><span class="s1">]:</span>
<a name="l1626"><span class="ln">1626 </span></a>            <span class="s0">return True</span>
<a name="l1627"><span class="ln">1627 </span></a>
<a name="l1628"><span class="ln">1628 </span></a>        <span class="s1">trap_bad_request = self.config[</span><span class="s3">&quot;TRAP_BAD_REQUEST_ERRORS&quot;</span><span class="s1">]</span>
<a name="l1629"><span class="ln">1629 </span></a>
<a name="l1630"><span class="ln">1630 </span></a>        <span class="s2"># if unset, trap key errors in debug mode</span>
<a name="l1631"><span class="ln">1631 </span></a>        <span class="s0">if </span><span class="s1">(</span>
<a name="l1632"><span class="ln">1632 </span></a>            <span class="s1">trap_bad_request </span><span class="s0">is None</span>
<a name="l1633"><span class="ln">1633 </span></a>            <span class="s0">and </span><span class="s1">self.debug</span>
<a name="l1634"><span class="ln">1634 </span></a>            <span class="s0">and </span><span class="s1">isinstance(e</span><span class="s0">, </span><span class="s1">BadRequestKeyError)</span>
<a name="l1635"><span class="ln">1635 </span></a>        <span class="s1">):</span>
<a name="l1636"><span class="ln">1636 </span></a>            <span class="s0">return True</span>
<a name="l1637"><span class="ln">1637 </span></a>
<a name="l1638"><span class="ln">1638 </span></a>        <span class="s0">if </span><span class="s1">trap_bad_request:</span>
<a name="l1639"><span class="ln">1639 </span></a>            <span class="s0">return </span><span class="s1">isinstance(e</span><span class="s0">, </span><span class="s1">BadRequest)</span>
<a name="l1640"><span class="ln">1640 </span></a>
<a name="l1641"><span class="ln">1641 </span></a>        <span class="s0">return False</span>
<a name="l1642"><span class="ln">1642 </span></a>
<a name="l1643"><span class="ln">1643 </span></a>    <span class="s0">def </span><span class="s1">handle_user_exception(</span>
<a name="l1644"><span class="ln">1644 </span></a>        <span class="s1">self</span><span class="s0">, </span><span class="s1">e: Exception</span>
<a name="l1645"><span class="ln">1645 </span></a>    <span class="s1">) -&gt; t.Union[HTTPException</span><span class="s0">, </span><span class="s1">ft.ResponseReturnValue]:</span>
<a name="l1646"><span class="ln">1646 </span></a>        <span class="s5">&quot;&quot;&quot;This method is called whenever an exception occurs that 
<a name="l1647"><span class="ln">1647 </span></a>        should be handled. A special case is :class:`~werkzeug 
<a name="l1648"><span class="ln">1648 </span></a>        .exceptions.HTTPException` which is forwarded to the 
<a name="l1649"><span class="ln">1649 </span></a>        :meth:`handle_http_exception` method. This function will either 
<a name="l1650"><span class="ln">1650 </span></a>        return a response value or reraise the exception with the same 
<a name="l1651"><span class="ln">1651 </span></a>        traceback. 
<a name="l1652"><span class="ln">1652 </span></a> 
<a name="l1653"><span class="ln">1653 </span></a>        .. versionchanged:: 1.0 
<a name="l1654"><span class="ln">1654 </span></a>            Key errors raised from request data like ``form`` show the 
<a name="l1655"><span class="ln">1655 </span></a>            bad key in debug mode rather than a generic bad request 
<a name="l1656"><span class="ln">1656 </span></a>            message. 
<a name="l1657"><span class="ln">1657 </span></a> 
<a name="l1658"><span class="ln">1658 </span></a>        .. versionadded:: 0.7 
<a name="l1659"><span class="ln">1659 </span></a>        &quot;&quot;&quot;</span>
<a name="l1660"><span class="ln">1660 </span></a>        <span class="s0">if </span><span class="s1">isinstance(e</span><span class="s0">, </span><span class="s1">BadRequestKeyError) </span><span class="s0">and </span><span class="s1">(</span>
<a name="l1661"><span class="ln">1661 </span></a>            <span class="s1">self.debug </span><span class="s0">or </span><span class="s1">self.config[</span><span class="s3">&quot;TRAP_BAD_REQUEST_ERRORS&quot;</span><span class="s1">]</span>
<a name="l1662"><span class="ln">1662 </span></a>        <span class="s1">):</span>
<a name="l1663"><span class="ln">1663 </span></a>            <span class="s1">e.show_exception = </span><span class="s0">True</span>
<a name="l1664"><span class="ln">1664 </span></a>
<a name="l1665"><span class="ln">1665 </span></a>        <span class="s0">if </span><span class="s1">isinstance(e</span><span class="s0">, </span><span class="s1">HTTPException) </span><span class="s0">and not </span><span class="s1">self.trap_http_exception(e):</span>
<a name="l1666"><span class="ln">1666 </span></a>            <span class="s0">return </span><span class="s1">self.handle_http_exception(e)</span>
<a name="l1667"><span class="ln">1667 </span></a>
<a name="l1668"><span class="ln">1668 </span></a>        <span class="s1">handler = self._find_error_handler(e)</span>
<a name="l1669"><span class="ln">1669 </span></a>
<a name="l1670"><span class="ln">1670 </span></a>        <span class="s0">if </span><span class="s1">handler </span><span class="s0">is None</span><span class="s1">:</span>
<a name="l1671"><span class="ln">1671 </span></a>            <span class="s0">raise</span>
<a name="l1672"><span class="ln">1672 </span></a>
<a name="l1673"><span class="ln">1673 </span></a>        <span class="s0">return </span><span class="s1">self.ensure_sync(handler)(e)</span>
<a name="l1674"><span class="ln">1674 </span></a>
<a name="l1675"><span class="ln">1675 </span></a>    <span class="s0">def </span><span class="s1">handle_exception(self</span><span class="s0">, </span><span class="s1">e: Exception) -&gt; Response:</span>
<a name="l1676"><span class="ln">1676 </span></a>        <span class="s5">&quot;&quot;&quot;Handle an exception that did not have an error handler 
<a name="l1677"><span class="ln">1677 </span></a>        associated with it, or that was raised from an error handler. 
<a name="l1678"><span class="ln">1678 </span></a>        This always causes a 500 ``InternalServerError``. 
<a name="l1679"><span class="ln">1679 </span></a> 
<a name="l1680"><span class="ln">1680 </span></a>        Always sends the :data:`got_request_exception` signal. 
<a name="l1681"><span class="ln">1681 </span></a> 
<a name="l1682"><span class="ln">1682 </span></a>        If :attr:`propagate_exceptions` is ``True``, such as in debug 
<a name="l1683"><span class="ln">1683 </span></a>        mode, the error will be re-raised so that the debugger can 
<a name="l1684"><span class="ln">1684 </span></a>        display it. Otherwise, the original exception is logged, and 
<a name="l1685"><span class="ln">1685 </span></a>        an :exc:`~werkzeug.exceptions.InternalServerError` is returned. 
<a name="l1686"><span class="ln">1686 </span></a> 
<a name="l1687"><span class="ln">1687 </span></a>        If an error handler is registered for ``InternalServerError`` or 
<a name="l1688"><span class="ln">1688 </span></a>        ``500``, it will be used. For consistency, the handler will 
<a name="l1689"><span class="ln">1689 </span></a>        always receive the ``InternalServerError``. The original 
<a name="l1690"><span class="ln">1690 </span></a>        unhandled exception is available as ``e.original_exception``. 
<a name="l1691"><span class="ln">1691 </span></a> 
<a name="l1692"><span class="ln">1692 </span></a>        .. versionchanged:: 1.1.0 
<a name="l1693"><span class="ln">1693 </span></a>            Always passes the ``InternalServerError`` instance to the 
<a name="l1694"><span class="ln">1694 </span></a>            handler, setting ``original_exception`` to the unhandled 
<a name="l1695"><span class="ln">1695 </span></a>            error. 
<a name="l1696"><span class="ln">1696 </span></a> 
<a name="l1697"><span class="ln">1697 </span></a>        .. versionchanged:: 1.1.0 
<a name="l1698"><span class="ln">1698 </span></a>            ``after_request`` functions and other finalization is done 
<a name="l1699"><span class="ln">1699 </span></a>            even for the default 500 response when there is no handler. 
<a name="l1700"><span class="ln">1700 </span></a> 
<a name="l1701"><span class="ln">1701 </span></a>        .. versionadded:: 0.3 
<a name="l1702"><span class="ln">1702 </span></a>        &quot;&quot;&quot;</span>
<a name="l1703"><span class="ln">1703 </span></a>        <span class="s1">exc_info = sys.exc_info()</span>
<a name="l1704"><span class="ln">1704 </span></a>        <span class="s1">got_request_exception.send(self</span><span class="s0">, </span><span class="s1">exception=e)</span>
<a name="l1705"><span class="ln">1705 </span></a>        <span class="s1">propagate = self.config[</span><span class="s3">&quot;PROPAGATE_EXCEPTIONS&quot;</span><span class="s1">]</span>
<a name="l1706"><span class="ln">1706 </span></a>
<a name="l1707"><span class="ln">1707 </span></a>        <span class="s0">if </span><span class="s1">propagate </span><span class="s0">is None</span><span class="s1">:</span>
<a name="l1708"><span class="ln">1708 </span></a>            <span class="s1">propagate = self.testing </span><span class="s0">or </span><span class="s1">self.debug</span>
<a name="l1709"><span class="ln">1709 </span></a>
<a name="l1710"><span class="ln">1710 </span></a>        <span class="s0">if </span><span class="s1">propagate:</span>
<a name="l1711"><span class="ln">1711 </span></a>            <span class="s2"># Re-raise if called with an active exception, otherwise</span>
<a name="l1712"><span class="ln">1712 </span></a>            <span class="s2"># raise the passed in exception.</span>
<a name="l1713"><span class="ln">1713 </span></a>            <span class="s0">if </span><span class="s1">exc_info[</span><span class="s4">1</span><span class="s1">] </span><span class="s0">is </span><span class="s1">e:</span>
<a name="l1714"><span class="ln">1714 </span></a>                <span class="s0">raise</span>
<a name="l1715"><span class="ln">1715 </span></a>
<a name="l1716"><span class="ln">1716 </span></a>            <span class="s0">raise </span><span class="s1">e</span>
<a name="l1717"><span class="ln">1717 </span></a>
<a name="l1718"><span class="ln">1718 </span></a>        <span class="s1">self.log_exception(exc_info)</span>
<a name="l1719"><span class="ln">1719 </span></a>        <span class="s1">server_error: t.Union[InternalServerError</span><span class="s0">, </span><span class="s1">ft.ResponseReturnValue]</span>
<a name="l1720"><span class="ln">1720 </span></a>        <span class="s1">server_error = InternalServerError(original_exception=e)</span>
<a name="l1721"><span class="ln">1721 </span></a>        <span class="s1">handler = self._find_error_handler(server_error)</span>
<a name="l1722"><span class="ln">1722 </span></a>
<a name="l1723"><span class="ln">1723 </span></a>        <span class="s0">if </span><span class="s1">handler </span><span class="s0">is not None</span><span class="s1">:</span>
<a name="l1724"><span class="ln">1724 </span></a>            <span class="s1">server_error = self.ensure_sync(handler)(server_error)</span>
<a name="l1725"><span class="ln">1725 </span></a>
<a name="l1726"><span class="ln">1726 </span></a>        <span class="s0">return </span><span class="s1">self.finalize_request(server_error</span><span class="s0">, </span><span class="s1">from_error_handler=</span><span class="s0">True</span><span class="s1">)</span>
<a name="l1727"><span class="ln">1727 </span></a>
<a name="l1728"><span class="ln">1728 </span></a>    <span class="s0">def </span><span class="s1">log_exception(</span>
<a name="l1729"><span class="ln">1729 </span></a>        <span class="s1">self</span><span class="s0">,</span>
<a name="l1730"><span class="ln">1730 </span></a>        <span class="s1">exc_info: t.Union[</span>
<a name="l1731"><span class="ln">1731 </span></a>            <span class="s1">t.Tuple[type</span><span class="s0">, </span><span class="s1">BaseException</span><span class="s0">, </span><span class="s1">TracebackType]</span><span class="s0">, </span><span class="s1">t.Tuple[</span><span class="s0">None, None, None</span><span class="s1">]</span>
<a name="l1732"><span class="ln">1732 </span></a>        <span class="s1">]</span><span class="s0">,</span>
<a name="l1733"><span class="ln">1733 </span></a>    <span class="s1">) -&gt; </span><span class="s0">None</span><span class="s1">:</span>
<a name="l1734"><span class="ln">1734 </span></a>        <span class="s5">&quot;&quot;&quot;Logs an exception.  This is called by :meth:`handle_exception` 
<a name="l1735"><span class="ln">1735 </span></a>        if debugging is disabled and right before the handler is called. 
<a name="l1736"><span class="ln">1736 </span></a>        The default implementation logs the exception as error on the 
<a name="l1737"><span class="ln">1737 </span></a>        :attr:`logger`. 
<a name="l1738"><span class="ln">1738 </span></a> 
<a name="l1739"><span class="ln">1739 </span></a>        .. versionadded:: 0.8 
<a name="l1740"><span class="ln">1740 </span></a>        &quot;&quot;&quot;</span>
<a name="l1741"><span class="ln">1741 </span></a>        <span class="s1">self.logger.error(</span>
<a name="l1742"><span class="ln">1742 </span></a>            <span class="s3">f&quot;Exception on </span><span class="s0">{</span><span class="s1">request.path</span><span class="s0">} </span><span class="s3">[</span><span class="s0">{</span><span class="s1">request.method</span><span class="s0">}</span><span class="s3">]&quot;</span><span class="s0">, </span><span class="s1">exc_info=exc_info</span>
<a name="l1743"><span class="ln">1743 </span></a>        <span class="s1">)</span>
<a name="l1744"><span class="ln">1744 </span></a>
<a name="l1745"><span class="ln">1745 </span></a>    <span class="s0">def </span><span class="s1">raise_routing_exception(self</span><span class="s0">, </span><span class="s1">request: Request) -&gt; </span><span class="s3">&quot;te.NoReturn&quot;</span><span class="s1">:</span>
<a name="l1746"><span class="ln">1746 </span></a>        <span class="s5">&quot;&quot;&quot;Intercept routing exceptions and possibly do something else. 
<a name="l1747"><span class="ln">1747 </span></a> 
<a name="l1748"><span class="ln">1748 </span></a>        In debug mode, intercept a routing redirect and replace it with 
<a name="l1749"><span class="ln">1749 </span></a>        an error if the body will be discarded. 
<a name="l1750"><span class="ln">1750 </span></a> 
<a name="l1751"><span class="ln">1751 </span></a>        With modern Werkzeug this shouldn't occur, since it now uses a 
<a name="l1752"><span class="ln">1752 </span></a>        308 status which tells the browser to resend the method and 
<a name="l1753"><span class="ln">1753 </span></a>        body. 
<a name="l1754"><span class="ln">1754 </span></a> 
<a name="l1755"><span class="ln">1755 </span></a>        .. versionchanged:: 2.1 
<a name="l1756"><span class="ln">1756 </span></a>            Don't intercept 307 and 308 redirects. 
<a name="l1757"><span class="ln">1757 </span></a> 
<a name="l1758"><span class="ln">1758 </span></a>        :meta private: 
<a name="l1759"><span class="ln">1759 </span></a>        :internal: 
<a name="l1760"><span class="ln">1760 </span></a>        &quot;&quot;&quot;</span>
<a name="l1761"><span class="ln">1761 </span></a>        <span class="s0">if </span><span class="s1">(</span>
<a name="l1762"><span class="ln">1762 </span></a>            <span class="s0">not </span><span class="s1">self.debug</span>
<a name="l1763"><span class="ln">1763 </span></a>            <span class="s0">or not </span><span class="s1">isinstance(request.routing_exception</span><span class="s0">, </span><span class="s1">RequestRedirect)</span>
<a name="l1764"><span class="ln">1764 </span></a>            <span class="s0">or </span><span class="s1">request.routing_exception.code </span><span class="s0">in </span><span class="s1">{</span><span class="s4">307</span><span class="s0">, </span><span class="s4">308</span><span class="s1">}</span>
<a name="l1765"><span class="ln">1765 </span></a>            <span class="s0">or </span><span class="s1">request.method </span><span class="s0">in </span><span class="s1">{</span><span class="s3">&quot;GET&quot;</span><span class="s0">, </span><span class="s3">&quot;HEAD&quot;</span><span class="s0">, </span><span class="s3">&quot;OPTIONS&quot;</span><span class="s1">}</span>
<a name="l1766"><span class="ln">1766 </span></a>        <span class="s1">):</span>
<a name="l1767"><span class="ln">1767 </span></a>            <span class="s0">raise </span><span class="s1">request.routing_exception  </span><span class="s2"># type: ignore</span>
<a name="l1768"><span class="ln">1768 </span></a>
<a name="l1769"><span class="ln">1769 </span></a>        <span class="s0">from </span><span class="s1">.debughelpers </span><span class="s0">import </span><span class="s1">FormDataRoutingRedirect</span>
<a name="l1770"><span class="ln">1770 </span></a>
<a name="l1771"><span class="ln">1771 </span></a>        <span class="s0">raise </span><span class="s1">FormDataRoutingRedirect(request)</span>
<a name="l1772"><span class="ln">1772 </span></a>
<a name="l1773"><span class="ln">1773 </span></a>    <span class="s0">def </span><span class="s1">dispatch_request(self) -&gt; ft.ResponseReturnValue:</span>
<a name="l1774"><span class="ln">1774 </span></a>        <span class="s5">&quot;&quot;&quot;Does the request dispatching.  Matches the URL and returns the 
<a name="l1775"><span class="ln">1775 </span></a>        return value of the view or error handler.  This does not have to 
<a name="l1776"><span class="ln">1776 </span></a>        be a response object.  In order to convert the return value to a 
<a name="l1777"><span class="ln">1777 </span></a>        proper response object, call :func:`make_response`. 
<a name="l1778"><span class="ln">1778 </span></a> 
<a name="l1779"><span class="ln">1779 </span></a>        .. versionchanged:: 0.7 
<a name="l1780"><span class="ln">1780 </span></a>           This no longer does the exception handling, this code was 
<a name="l1781"><span class="ln">1781 </span></a>           moved to the new :meth:`full_dispatch_request`. 
<a name="l1782"><span class="ln">1782 </span></a>        &quot;&quot;&quot;</span>
<a name="l1783"><span class="ln">1783 </span></a>        <span class="s1">req = request_ctx.request</span>
<a name="l1784"><span class="ln">1784 </span></a>        <span class="s0">if </span><span class="s1">req.routing_exception </span><span class="s0">is not None</span><span class="s1">:</span>
<a name="l1785"><span class="ln">1785 </span></a>            <span class="s1">self.raise_routing_exception(req)</span>
<a name="l1786"><span class="ln">1786 </span></a>        <span class="s1">rule: Rule = req.url_rule  </span><span class="s2"># type: ignore[assignment]</span>
<a name="l1787"><span class="ln">1787 </span></a>        <span class="s2"># if we provide automatic options for this URL and the</span>
<a name="l1788"><span class="ln">1788 </span></a>        <span class="s2"># request came with the OPTIONS method, reply automatically</span>
<a name="l1789"><span class="ln">1789 </span></a>        <span class="s0">if </span><span class="s1">(</span>
<a name="l1790"><span class="ln">1790 </span></a>            <span class="s1">getattr(rule</span><span class="s0">, </span><span class="s3">&quot;provide_automatic_options&quot;</span><span class="s0">, False</span><span class="s1">)</span>
<a name="l1791"><span class="ln">1791 </span></a>            <span class="s0">and </span><span class="s1">req.method == </span><span class="s3">&quot;OPTIONS&quot;</span>
<a name="l1792"><span class="ln">1792 </span></a>        <span class="s1">):</span>
<a name="l1793"><span class="ln">1793 </span></a>            <span class="s0">return </span><span class="s1">self.make_default_options_response()</span>
<a name="l1794"><span class="ln">1794 </span></a>        <span class="s2"># otherwise dispatch to the handler for that endpoint</span>
<a name="l1795"><span class="ln">1795 </span></a>        <span class="s1">view_args: t.Dict[str</span><span class="s0">, </span><span class="s1">t.Any] = req.view_args  </span><span class="s2"># type: ignore[assignment]</span>
<a name="l1796"><span class="ln">1796 </span></a>        <span class="s0">return </span><span class="s1">self.ensure_sync(self.view_functions[rule.endpoint])(**view_args)</span>
<a name="l1797"><span class="ln">1797 </span></a>
<a name="l1798"><span class="ln">1798 </span></a>    <span class="s0">def </span><span class="s1">full_dispatch_request(self) -&gt; Response:</span>
<a name="l1799"><span class="ln">1799 </span></a>        <span class="s5">&quot;&quot;&quot;Dispatches the request and on top of that performs request 
<a name="l1800"><span class="ln">1800 </span></a>        pre and postprocessing as well as HTTP exception catching and 
<a name="l1801"><span class="ln">1801 </span></a>        error handling. 
<a name="l1802"><span class="ln">1802 </span></a> 
<a name="l1803"><span class="ln">1803 </span></a>        .. versionadded:: 0.7 
<a name="l1804"><span class="ln">1804 </span></a>        &quot;&quot;&quot;</span>
<a name="l1805"><span class="ln">1805 </span></a>        <span class="s2"># Run before_first_request functions if this is the thread's first request.</span>
<a name="l1806"><span class="ln">1806 </span></a>        <span class="s2"># Inlined to avoid a method call on subsequent requests.</span>
<a name="l1807"><span class="ln">1807 </span></a>        <span class="s2"># This is deprecated, will be removed in Flask 2.3.</span>
<a name="l1808"><span class="ln">1808 </span></a>        <span class="s0">if not </span><span class="s1">self._got_first_request:</span>
<a name="l1809"><span class="ln">1809 </span></a>            <span class="s0">with </span><span class="s1">self._before_request_lock:</span>
<a name="l1810"><span class="ln">1810 </span></a>                <span class="s0">if not </span><span class="s1">self._got_first_request:</span>
<a name="l1811"><span class="ln">1811 </span></a>                    <span class="s0">for </span><span class="s1">func </span><span class="s0">in </span><span class="s1">self.before_first_request_funcs:</span>
<a name="l1812"><span class="ln">1812 </span></a>                        <span class="s1">self.ensure_sync(func)()</span>
<a name="l1813"><span class="ln">1813 </span></a>
<a name="l1814"><span class="ln">1814 </span></a>                    <span class="s1">self._got_first_request = </span><span class="s0">True</span>
<a name="l1815"><span class="ln">1815 </span></a>
<a name="l1816"><span class="ln">1816 </span></a>        <span class="s0">try</span><span class="s1">:</span>
<a name="l1817"><span class="ln">1817 </span></a>            <span class="s1">request_started.send(self)</span>
<a name="l1818"><span class="ln">1818 </span></a>            <span class="s1">rv = self.preprocess_request()</span>
<a name="l1819"><span class="ln">1819 </span></a>            <span class="s0">if </span><span class="s1">rv </span><span class="s0">is None</span><span class="s1">:</span>
<a name="l1820"><span class="ln">1820 </span></a>                <span class="s1">rv = self.dispatch_request()</span>
<a name="l1821"><span class="ln">1821 </span></a>        <span class="s0">except </span><span class="s1">Exception </span><span class="s0">as </span><span class="s1">e:</span>
<a name="l1822"><span class="ln">1822 </span></a>            <span class="s1">rv = self.handle_user_exception(e)</span>
<a name="l1823"><span class="ln">1823 </span></a>        <span class="s0">return </span><span class="s1">self.finalize_request(rv)</span>
<a name="l1824"><span class="ln">1824 </span></a>
<a name="l1825"><span class="ln">1825 </span></a>    <span class="s0">def </span><span class="s1">finalize_request(</span>
<a name="l1826"><span class="ln">1826 </span></a>        <span class="s1">self</span><span class="s0">,</span>
<a name="l1827"><span class="ln">1827 </span></a>        <span class="s1">rv: t.Union[ft.ResponseReturnValue</span><span class="s0">, </span><span class="s1">HTTPException]</span><span class="s0">,</span>
<a name="l1828"><span class="ln">1828 </span></a>        <span class="s1">from_error_handler: bool = </span><span class="s0">False,</span>
<a name="l1829"><span class="ln">1829 </span></a>    <span class="s1">) -&gt; Response:</span>
<a name="l1830"><span class="ln">1830 </span></a>        <span class="s5">&quot;&quot;&quot;Given the return value from a view function this finalizes 
<a name="l1831"><span class="ln">1831 </span></a>        the request by converting it into a response and invoking the 
<a name="l1832"><span class="ln">1832 </span></a>        postprocessing functions.  This is invoked for both normal 
<a name="l1833"><span class="ln">1833 </span></a>        request dispatching as well as error handlers. 
<a name="l1834"><span class="ln">1834 </span></a> 
<a name="l1835"><span class="ln">1835 </span></a>        Because this means that it might be called as a result of a 
<a name="l1836"><span class="ln">1836 </span></a>        failure a special safe mode is available which can be enabled 
<a name="l1837"><span class="ln">1837 </span></a>        with the `from_error_handler` flag.  If enabled, failures in 
<a name="l1838"><span class="ln">1838 </span></a>        response processing will be logged and otherwise ignored. 
<a name="l1839"><span class="ln">1839 </span></a> 
<a name="l1840"><span class="ln">1840 </span></a>        :internal: 
<a name="l1841"><span class="ln">1841 </span></a>        &quot;&quot;&quot;</span>
<a name="l1842"><span class="ln">1842 </span></a>        <span class="s1">response = self.make_response(rv)</span>
<a name="l1843"><span class="ln">1843 </span></a>        <span class="s0">try</span><span class="s1">:</span>
<a name="l1844"><span class="ln">1844 </span></a>            <span class="s1">response = self.process_response(response)</span>
<a name="l1845"><span class="ln">1845 </span></a>            <span class="s1">request_finished.send(self</span><span class="s0">, </span><span class="s1">response=response)</span>
<a name="l1846"><span class="ln">1846 </span></a>        <span class="s0">except </span><span class="s1">Exception:</span>
<a name="l1847"><span class="ln">1847 </span></a>            <span class="s0">if not </span><span class="s1">from_error_handler:</span>
<a name="l1848"><span class="ln">1848 </span></a>                <span class="s0">raise</span>
<a name="l1849"><span class="ln">1849 </span></a>            <span class="s1">self.logger.exception(</span>
<a name="l1850"><span class="ln">1850 </span></a>                <span class="s3">&quot;Request finalizing failed with an error while handling an error&quot;</span>
<a name="l1851"><span class="ln">1851 </span></a>            <span class="s1">)</span>
<a name="l1852"><span class="ln">1852 </span></a>        <span class="s0">return </span><span class="s1">response</span>
<a name="l1853"><span class="ln">1853 </span></a>
<a name="l1854"><span class="ln">1854 </span></a>    <span class="s0">def </span><span class="s1">make_default_options_response(self) -&gt; Response:</span>
<a name="l1855"><span class="ln">1855 </span></a>        <span class="s5">&quot;&quot;&quot;This method is called to create the default ``OPTIONS`` response. 
<a name="l1856"><span class="ln">1856 </span></a>        This can be changed through subclassing to change the default 
<a name="l1857"><span class="ln">1857 </span></a>        behavior of ``OPTIONS`` responses. 
<a name="l1858"><span class="ln">1858 </span></a> 
<a name="l1859"><span class="ln">1859 </span></a>        .. versionadded:: 0.7 
<a name="l1860"><span class="ln">1860 </span></a>        &quot;&quot;&quot;</span>
<a name="l1861"><span class="ln">1861 </span></a>        <span class="s1">adapter = request_ctx.url_adapter</span>
<a name="l1862"><span class="ln">1862 </span></a>        <span class="s1">methods = adapter.allowed_methods()  </span><span class="s2"># type: ignore[union-attr]</span>
<a name="l1863"><span class="ln">1863 </span></a>        <span class="s1">rv = self.response_class()</span>
<a name="l1864"><span class="ln">1864 </span></a>        <span class="s1">rv.allow.update(methods)</span>
<a name="l1865"><span class="ln">1865 </span></a>        <span class="s0">return </span><span class="s1">rv</span>
<a name="l1866"><span class="ln">1866 </span></a>
<a name="l1867"><span class="ln">1867 </span></a>    <span class="s0">def </span><span class="s1">should_ignore_error(self</span><span class="s0">, </span><span class="s1">error: t.Optional[BaseException]) -&gt; bool:</span>
<a name="l1868"><span class="ln">1868 </span></a>        <span class="s5">&quot;&quot;&quot;This is called to figure out if an error should be ignored 
<a name="l1869"><span class="ln">1869 </span></a>        or not as far as the teardown system is concerned.  If this 
<a name="l1870"><span class="ln">1870 </span></a>        function returns ``True`` then the teardown handlers will not be 
<a name="l1871"><span class="ln">1871 </span></a>        passed the error. 
<a name="l1872"><span class="ln">1872 </span></a> 
<a name="l1873"><span class="ln">1873 </span></a>        .. versionadded:: 0.10 
<a name="l1874"><span class="ln">1874 </span></a>        &quot;&quot;&quot;</span>
<a name="l1875"><span class="ln">1875 </span></a>        <span class="s0">return False</span>
<a name="l1876"><span class="ln">1876 </span></a>
<a name="l1877"><span class="ln">1877 </span></a>    <span class="s0">def </span><span class="s1">ensure_sync(self</span><span class="s0">, </span><span class="s1">func: t.Callable) -&gt; t.Callable:</span>
<a name="l1878"><span class="ln">1878 </span></a>        <span class="s5">&quot;&quot;&quot;Ensure that the function is synchronous for WSGI workers. 
<a name="l1879"><span class="ln">1879 </span></a>        Plain ``def`` functions are returned as-is. ``async def`` 
<a name="l1880"><span class="ln">1880 </span></a>        functions are wrapped to run and wait for the response. 
<a name="l1881"><span class="ln">1881 </span></a> 
<a name="l1882"><span class="ln">1882 </span></a>        Override this method to change how the app runs async views. 
<a name="l1883"><span class="ln">1883 </span></a> 
<a name="l1884"><span class="ln">1884 </span></a>        .. versionadded:: 2.0 
<a name="l1885"><span class="ln">1885 </span></a>        &quot;&quot;&quot;</span>
<a name="l1886"><span class="ln">1886 </span></a>        <span class="s0">if </span><span class="s1">iscoroutinefunction(func):</span>
<a name="l1887"><span class="ln">1887 </span></a>            <span class="s0">return </span><span class="s1">self.async_to_sync(func)</span>
<a name="l1888"><span class="ln">1888 </span></a>
<a name="l1889"><span class="ln">1889 </span></a>        <span class="s0">return </span><span class="s1">func</span>
<a name="l1890"><span class="ln">1890 </span></a>
<a name="l1891"><span class="ln">1891 </span></a>    <span class="s0">def </span><span class="s1">async_to_sync(</span>
<a name="l1892"><span class="ln">1892 </span></a>        <span class="s1">self</span><span class="s0">, </span><span class="s1">func: t.Callable[...</span><span class="s0">, </span><span class="s1">t.Coroutine]</span>
<a name="l1893"><span class="ln">1893 </span></a>    <span class="s1">) -&gt; t.Callable[...</span><span class="s0">, </span><span class="s1">t.Any]:</span>
<a name="l1894"><span class="ln">1894 </span></a>        <span class="s5">&quot;&quot;&quot;Return a sync function that will run the coroutine function. 
<a name="l1895"><span class="ln">1895 </span></a> 
<a name="l1896"><span class="ln">1896 </span></a>        .. code-block:: python 
<a name="l1897"><span class="ln">1897 </span></a> 
<a name="l1898"><span class="ln">1898 </span></a>            result = app.async_to_sync(func)(*args, **kwargs) 
<a name="l1899"><span class="ln">1899 </span></a> 
<a name="l1900"><span class="ln">1900 </span></a>        Override this method to change how the app converts async code 
<a name="l1901"><span class="ln">1901 </span></a>        to be synchronously callable. 
<a name="l1902"><span class="ln">1902 </span></a> 
<a name="l1903"><span class="ln">1903 </span></a>        .. versionadded:: 2.0 
<a name="l1904"><span class="ln">1904 </span></a>        &quot;&quot;&quot;</span>
<a name="l1905"><span class="ln">1905 </span></a>        <span class="s0">try</span><span class="s1">:</span>
<a name="l1906"><span class="ln">1906 </span></a>            <span class="s0">from </span><span class="s1">asgiref.sync </span><span class="s0">import </span><span class="s1">async_to_sync </span><span class="s0">as </span><span class="s1">asgiref_async_to_sync</span>
<a name="l1907"><span class="ln">1907 </span></a>        <span class="s0">except </span><span class="s1">ImportError:</span>
<a name="l1908"><span class="ln">1908 </span></a>            <span class="s0">raise </span><span class="s1">RuntimeError(</span>
<a name="l1909"><span class="ln">1909 </span></a>                <span class="s3">&quot;Install Flask with the 'async' extra in order to use async views.&quot;</span>
<a name="l1910"><span class="ln">1910 </span></a>            <span class="s1">) </span><span class="s0">from None</span>
<a name="l1911"><span class="ln">1911 </span></a>
<a name="l1912"><span class="ln">1912 </span></a>        <span class="s0">return </span><span class="s1">asgiref_async_to_sync(func)</span>
<a name="l1913"><span class="ln">1913 </span></a>
<a name="l1914"><span class="ln">1914 </span></a>    <span class="s0">def </span><span class="s1">url_for(</span>
<a name="l1915"><span class="ln">1915 </span></a>        <span class="s1">self</span><span class="s0">,</span>
<a name="l1916"><span class="ln">1916 </span></a>        <span class="s1">endpoint: str</span><span class="s0">,</span>
<a name="l1917"><span class="ln">1917 </span></a>        <span class="s1">*</span><span class="s0">,</span>
<a name="l1918"><span class="ln">1918 </span></a>        <span class="s1">_anchor: t.Optional[str] = </span><span class="s0">None,</span>
<a name="l1919"><span class="ln">1919 </span></a>        <span class="s1">_method: t.Optional[str] = </span><span class="s0">None,</span>
<a name="l1920"><span class="ln">1920 </span></a>        <span class="s1">_scheme: t.Optional[str] = </span><span class="s0">None,</span>
<a name="l1921"><span class="ln">1921 </span></a>        <span class="s1">_external: t.Optional[bool] = </span><span class="s0">None,</span>
<a name="l1922"><span class="ln">1922 </span></a>        <span class="s1">**values: t.Any</span><span class="s0">,</span>
<a name="l1923"><span class="ln">1923 </span></a>    <span class="s1">) -&gt; str:</span>
<a name="l1924"><span class="ln">1924 </span></a>        <span class="s5">&quot;&quot;&quot;Generate a URL to the given endpoint with the given values. 
<a name="l1925"><span class="ln">1925 </span></a> 
<a name="l1926"><span class="ln">1926 </span></a>        This is called by :func:`flask.url_for`, and can be called 
<a name="l1927"><span class="ln">1927 </span></a>        directly as well. 
<a name="l1928"><span class="ln">1928 </span></a> 
<a name="l1929"><span class="ln">1929 </span></a>        An *endpoint* is the name of a URL rule, usually added with 
<a name="l1930"><span class="ln">1930 </span></a>        :meth:`@app.route() &lt;route&gt;`, and usually the same name as the 
<a name="l1931"><span class="ln">1931 </span></a>        view function. A route defined in a :class:`~flask.Blueprint` 
<a name="l1932"><span class="ln">1932 </span></a>        will prepend the blueprint's name separated by a ``.`` to the 
<a name="l1933"><span class="ln">1933 </span></a>        endpoint. 
<a name="l1934"><span class="ln">1934 </span></a> 
<a name="l1935"><span class="ln">1935 </span></a>        In some cases, such as email messages, you want URLs to include 
<a name="l1936"><span class="ln">1936 </span></a>        the scheme and domain, like ``https://example.com/hello``. When 
<a name="l1937"><span class="ln">1937 </span></a>        not in an active request, URLs will be external by default, but 
<a name="l1938"><span class="ln">1938 </span></a>        this requires setting :data:`SERVER_NAME` so Flask knows what 
<a name="l1939"><span class="ln">1939 </span></a>        domain to use. :data:`APPLICATION_ROOT` and 
<a name="l1940"><span class="ln">1940 </span></a>        :data:`PREFERRED_URL_SCHEME` should also be configured as 
<a name="l1941"><span class="ln">1941 </span></a>        needed. This config is only used when not in an active request. 
<a name="l1942"><span class="ln">1942 </span></a> 
<a name="l1943"><span class="ln">1943 </span></a>        Functions can be decorated with :meth:`url_defaults` to modify 
<a name="l1944"><span class="ln">1944 </span></a>        keyword arguments before the URL is built. 
<a name="l1945"><span class="ln">1945 </span></a> 
<a name="l1946"><span class="ln">1946 </span></a>        If building fails for some reason, such as an unknown endpoint 
<a name="l1947"><span class="ln">1947 </span></a>        or incorrect values, the app's :meth:`handle_url_build_error` 
<a name="l1948"><span class="ln">1948 </span></a>        method is called. If that returns a string, that is returned, 
<a name="l1949"><span class="ln">1949 </span></a>        otherwise a :exc:`~werkzeug.routing.BuildError` is raised. 
<a name="l1950"><span class="ln">1950 </span></a> 
<a name="l1951"><span class="ln">1951 </span></a>        :param endpoint: The endpoint name associated with the URL to 
<a name="l1952"><span class="ln">1952 </span></a>            generate. If this starts with a ``.``, the current blueprint 
<a name="l1953"><span class="ln">1953 </span></a>            name (if any) will be used. 
<a name="l1954"><span class="ln">1954 </span></a>        :param _anchor: If given, append this as ``#anchor`` to the URL. 
<a name="l1955"><span class="ln">1955 </span></a>        :param _method: If given, generate the URL associated with this 
<a name="l1956"><span class="ln">1956 </span></a>            method for the endpoint. 
<a name="l1957"><span class="ln">1957 </span></a>        :param _scheme: If given, the URL will have this scheme if it 
<a name="l1958"><span class="ln">1958 </span></a>            is external. 
<a name="l1959"><span class="ln">1959 </span></a>        :param _external: If given, prefer the URL to be internal 
<a name="l1960"><span class="ln">1960 </span></a>            (False) or require it to be external (True). External URLs 
<a name="l1961"><span class="ln">1961 </span></a>            include the scheme and domain. When not in an active 
<a name="l1962"><span class="ln">1962 </span></a>            request, URLs are external by default. 
<a name="l1963"><span class="ln">1963 </span></a>        :param values: Values to use for the variable parts of the URL 
<a name="l1964"><span class="ln">1964 </span></a>            rule. Unknown keys are appended as query string arguments, 
<a name="l1965"><span class="ln">1965 </span></a>            like ``?a=b&amp;c=d``. 
<a name="l1966"><span class="ln">1966 </span></a> 
<a name="l1967"><span class="ln">1967 </span></a>        .. versionadded:: 2.2 
<a name="l1968"><span class="ln">1968 </span></a>            Moved from ``flask.url_for``, which calls this method. 
<a name="l1969"><span class="ln">1969 </span></a>        &quot;&quot;&quot;</span>
<a name="l1970"><span class="ln">1970 </span></a>        <span class="s1">req_ctx = _cv_request.get(</span><span class="s0">None</span><span class="s1">)</span>
<a name="l1971"><span class="ln">1971 </span></a>
<a name="l1972"><span class="ln">1972 </span></a>        <span class="s0">if </span><span class="s1">req_ctx </span><span class="s0">is not None</span><span class="s1">:</span>
<a name="l1973"><span class="ln">1973 </span></a>            <span class="s1">url_adapter = req_ctx.url_adapter</span>
<a name="l1974"><span class="ln">1974 </span></a>            <span class="s1">blueprint_name = req_ctx.request.blueprint</span>
<a name="l1975"><span class="ln">1975 </span></a>
<a name="l1976"><span class="ln">1976 </span></a>            <span class="s2"># If the endpoint starts with &quot;.&quot; and the request matches a</span>
<a name="l1977"><span class="ln">1977 </span></a>            <span class="s2"># blueprint, the endpoint is relative to the blueprint.</span>
<a name="l1978"><span class="ln">1978 </span></a>            <span class="s0">if </span><span class="s1">endpoint[:</span><span class="s4">1</span><span class="s1">] == </span><span class="s3">&quot;.&quot;</span><span class="s1">:</span>
<a name="l1979"><span class="ln">1979 </span></a>                <span class="s0">if </span><span class="s1">blueprint_name </span><span class="s0">is not None</span><span class="s1">:</span>
<a name="l1980"><span class="ln">1980 </span></a>                    <span class="s1">endpoint = </span><span class="s3">f&quot;</span><span class="s0">{</span><span class="s1">blueprint_name</span><span class="s0">}{</span><span class="s1">endpoint</span><span class="s0">}</span><span class="s3">&quot;</span>
<a name="l1981"><span class="ln">1981 </span></a>                <span class="s0">else</span><span class="s1">:</span>
<a name="l1982"><span class="ln">1982 </span></a>                    <span class="s1">endpoint = endpoint[</span><span class="s4">1</span><span class="s1">:]</span>
<a name="l1983"><span class="ln">1983 </span></a>
<a name="l1984"><span class="ln">1984 </span></a>            <span class="s2"># When in a request, generate a URL without scheme and</span>
<a name="l1985"><span class="ln">1985 </span></a>            <span class="s2"># domain by default, unless a scheme is given.</span>
<a name="l1986"><span class="ln">1986 </span></a>            <span class="s0">if </span><span class="s1">_external </span><span class="s0">is None</span><span class="s1">:</span>
<a name="l1987"><span class="ln">1987 </span></a>                <span class="s1">_external = _scheme </span><span class="s0">is not None</span>
<a name="l1988"><span class="ln">1988 </span></a>        <span class="s0">else</span><span class="s1">:</span>
<a name="l1989"><span class="ln">1989 </span></a>            <span class="s1">app_ctx = _cv_app.get(</span><span class="s0">None</span><span class="s1">)</span>
<a name="l1990"><span class="ln">1990 </span></a>
<a name="l1991"><span class="ln">1991 </span></a>            <span class="s2"># If called by helpers.url_for, an app context is active,</span>
<a name="l1992"><span class="ln">1992 </span></a>            <span class="s2"># use its url_adapter. Otherwise, app.url_for was called</span>
<a name="l1993"><span class="ln">1993 </span></a>            <span class="s2"># directly, build an adapter.</span>
<a name="l1994"><span class="ln">1994 </span></a>            <span class="s0">if </span><span class="s1">app_ctx </span><span class="s0">is not None</span><span class="s1">:</span>
<a name="l1995"><span class="ln">1995 </span></a>                <span class="s1">url_adapter = app_ctx.url_adapter</span>
<a name="l1996"><span class="ln">1996 </span></a>            <span class="s0">else</span><span class="s1">:</span>
<a name="l1997"><span class="ln">1997 </span></a>                <span class="s1">url_adapter = self.create_url_adapter(</span><span class="s0">None</span><span class="s1">)</span>
<a name="l1998"><span class="ln">1998 </span></a>
<a name="l1999"><span class="ln">1999 </span></a>            <span class="s0">if </span><span class="s1">url_adapter </span><span class="s0">is None</span><span class="s1">:</span>
<a name="l2000"><span class="ln">2000 </span></a>                <span class="s0">raise </span><span class="s1">RuntimeError(</span>
<a name="l2001"><span class="ln">2001 </span></a>                    <span class="s3">&quot;Unable to build URLs outside an active request&quot;</span>
<a name="l2002"><span class="ln">2002 </span></a>                    <span class="s3">&quot; without 'SERVER_NAME' configured. Also configure&quot;</span>
<a name="l2003"><span class="ln">2003 </span></a>                    <span class="s3">&quot; 'APPLICATION_ROOT' and 'PREFERRED_URL_SCHEME' as&quot;</span>
<a name="l2004"><span class="ln">2004 </span></a>                    <span class="s3">&quot; needed.&quot;</span>
<a name="l2005"><span class="ln">2005 </span></a>                <span class="s1">)</span>
<a name="l2006"><span class="ln">2006 </span></a>
<a name="l2007"><span class="ln">2007 </span></a>            <span class="s2"># When outside a request, generate a URL with scheme and</span>
<a name="l2008"><span class="ln">2008 </span></a>            <span class="s2"># domain by default.</span>
<a name="l2009"><span class="ln">2009 </span></a>            <span class="s0">if </span><span class="s1">_external </span><span class="s0">is None</span><span class="s1">:</span>
<a name="l2010"><span class="ln">2010 </span></a>                <span class="s1">_external = </span><span class="s0">True</span>
<a name="l2011"><span class="ln">2011 </span></a>
<a name="l2012"><span class="ln">2012 </span></a>        <span class="s2"># It is an error to set _scheme when _external=False, in order</span>
<a name="l2013"><span class="ln">2013 </span></a>        <span class="s2"># to avoid accidental insecure URLs.</span>
<a name="l2014"><span class="ln">2014 </span></a>        <span class="s0">if </span><span class="s1">_scheme </span><span class="s0">is not None and not </span><span class="s1">_external:</span>
<a name="l2015"><span class="ln">2015 </span></a>            <span class="s0">raise </span><span class="s1">ValueError(</span><span class="s3">&quot;When specifying '_scheme', '_external' must be True.&quot;</span><span class="s1">)</span>
<a name="l2016"><span class="ln">2016 </span></a>
<a name="l2017"><span class="ln">2017 </span></a>        <span class="s1">self.inject_url_defaults(endpoint</span><span class="s0">, </span><span class="s1">values)</span>
<a name="l2018"><span class="ln">2018 </span></a>
<a name="l2019"><span class="ln">2019 </span></a>        <span class="s0">try</span><span class="s1">:</span>
<a name="l2020"><span class="ln">2020 </span></a>            <span class="s1">rv = url_adapter.build(  </span><span class="s2"># type: ignore[union-attr]</span>
<a name="l2021"><span class="ln">2021 </span></a>                <span class="s1">endpoint</span><span class="s0">,</span>
<a name="l2022"><span class="ln">2022 </span></a>                <span class="s1">values</span><span class="s0">,</span>
<a name="l2023"><span class="ln">2023 </span></a>                <span class="s1">method=_method</span><span class="s0">,</span>
<a name="l2024"><span class="ln">2024 </span></a>                <span class="s1">url_scheme=_scheme</span><span class="s0">,</span>
<a name="l2025"><span class="ln">2025 </span></a>                <span class="s1">force_external=_external</span><span class="s0">,</span>
<a name="l2026"><span class="ln">2026 </span></a>            <span class="s1">)</span>
<a name="l2027"><span class="ln">2027 </span></a>        <span class="s0">except </span><span class="s1">BuildError </span><span class="s0">as </span><span class="s1">error:</span>
<a name="l2028"><span class="ln">2028 </span></a>            <span class="s1">values.update(</span>
<a name="l2029"><span class="ln">2029 </span></a>                <span class="s1">_anchor=_anchor</span><span class="s0">, </span><span class="s1">_method=_method</span><span class="s0">, </span><span class="s1">_scheme=_scheme</span><span class="s0">, </span><span class="s1">_external=_external</span>
<a name="l2030"><span class="ln">2030 </span></a>            <span class="s1">)</span>
<a name="l2031"><span class="ln">2031 </span></a>            <span class="s0">return </span><span class="s1">self.handle_url_build_error(error</span><span class="s0">, </span><span class="s1">endpoint</span><span class="s0">, </span><span class="s1">values)</span>
<a name="l2032"><span class="ln">2032 </span></a>
<a name="l2033"><span class="ln">2033 </span></a>        <span class="s0">if </span><span class="s1">_anchor </span><span class="s0">is not None</span><span class="s1">:</span>
<a name="l2034"><span class="ln">2034 </span></a>            <span class="s1">rv = </span><span class="s3">f&quot;</span><span class="s0">{</span><span class="s1">rv</span><span class="s0">}</span><span class="s3">#</span><span class="s0">{</span><span class="s1">url_quote(_anchor)</span><span class="s0">}</span><span class="s3">&quot;</span>
<a name="l2035"><span class="ln">2035 </span></a>
<a name="l2036"><span class="ln">2036 </span></a>        <span class="s0">return </span><span class="s1">rv</span>
<a name="l2037"><span class="ln">2037 </span></a>
<a name="l2038"><span class="ln">2038 </span></a>    <span class="s0">def </span><span class="s1">redirect(self</span><span class="s0">, </span><span class="s1">location: str</span><span class="s0">, </span><span class="s1">code: int = </span><span class="s4">302</span><span class="s1">) -&gt; BaseResponse:</span>
<a name="l2039"><span class="ln">2039 </span></a>        <span class="s5">&quot;&quot;&quot;Create a redirect response object. 
<a name="l2040"><span class="ln">2040 </span></a> 
<a name="l2041"><span class="ln">2041 </span></a>        This is called by :func:`flask.redirect`, and can be called 
<a name="l2042"><span class="ln">2042 </span></a>        directly as well. 
<a name="l2043"><span class="ln">2043 </span></a> 
<a name="l2044"><span class="ln">2044 </span></a>        :param location: The URL to redirect to. 
<a name="l2045"><span class="ln">2045 </span></a>        :param code: The status code for the redirect. 
<a name="l2046"><span class="ln">2046 </span></a> 
<a name="l2047"><span class="ln">2047 </span></a>        .. versionadded:: 2.2 
<a name="l2048"><span class="ln">2048 </span></a>            Moved from ``flask.redirect``, which calls this method. 
<a name="l2049"><span class="ln">2049 </span></a>        &quot;&quot;&quot;</span>
<a name="l2050"><span class="ln">2050 </span></a>        <span class="s0">return </span><span class="s1">_wz_redirect(location</span><span class="s0">, </span><span class="s1">code=code</span><span class="s0">, </span><span class="s1">Response=self.response_class)</span>
<a name="l2051"><span class="ln">2051 </span></a>
<a name="l2052"><span class="ln">2052 </span></a>    <span class="s0">def </span><span class="s1">make_response(self</span><span class="s0">, </span><span class="s1">rv: ft.ResponseReturnValue) -&gt; Response:</span>
<a name="l2053"><span class="ln">2053 </span></a>        <span class="s5">&quot;&quot;&quot;Convert the return value from a view function to an instance of 
<a name="l2054"><span class="ln">2054 </span></a>        :attr:`response_class`. 
<a name="l2055"><span class="ln">2055 </span></a> 
<a name="l2056"><span class="ln">2056 </span></a>        :param rv: the return value from the view function. The view function 
<a name="l2057"><span class="ln">2057 </span></a>            must return a response. Returning ``None``, or the view ending 
<a name="l2058"><span class="ln">2058 </span></a>            without returning, is not allowed. The following types are allowed 
<a name="l2059"><span class="ln">2059 </span></a>            for ``view_rv``: 
<a name="l2060"><span class="ln">2060 </span></a> 
<a name="l2061"><span class="ln">2061 </span></a>            ``str`` 
<a name="l2062"><span class="ln">2062 </span></a>                A response object is created with the string encoded to UTF-8 
<a name="l2063"><span class="ln">2063 </span></a>                as the body. 
<a name="l2064"><span class="ln">2064 </span></a> 
<a name="l2065"><span class="ln">2065 </span></a>            ``bytes`` 
<a name="l2066"><span class="ln">2066 </span></a>                A response object is created with the bytes as the body. 
<a name="l2067"><span class="ln">2067 </span></a> 
<a name="l2068"><span class="ln">2068 </span></a>            ``dict`` 
<a name="l2069"><span class="ln">2069 </span></a>                A dictionary that will be jsonify'd before being returned. 
<a name="l2070"><span class="ln">2070 </span></a> 
<a name="l2071"><span class="ln">2071 </span></a>            ``list`` 
<a name="l2072"><span class="ln">2072 </span></a>                A list that will be jsonify'd before being returned. 
<a name="l2073"><span class="ln">2073 </span></a> 
<a name="l2074"><span class="ln">2074 </span></a>            ``generator`` or ``iterator`` 
<a name="l2075"><span class="ln">2075 </span></a>                A generator that returns ``str`` or ``bytes`` to be 
<a name="l2076"><span class="ln">2076 </span></a>                streamed as the response. 
<a name="l2077"><span class="ln">2077 </span></a> 
<a name="l2078"><span class="ln">2078 </span></a>            ``tuple`` 
<a name="l2079"><span class="ln">2079 </span></a>                Either ``(body, status, headers)``, ``(body, status)``, or 
<a name="l2080"><span class="ln">2080 </span></a>                ``(body, headers)``, where ``body`` is any of the other types 
<a name="l2081"><span class="ln">2081 </span></a>                allowed here, ``status`` is a string or an integer, and 
<a name="l2082"><span class="ln">2082 </span></a>                ``headers`` is a dictionary or a list of ``(key, value)`` 
<a name="l2083"><span class="ln">2083 </span></a>                tuples. If ``body`` is a :attr:`response_class` instance, 
<a name="l2084"><span class="ln">2084 </span></a>                ``status`` overwrites the exiting value and ``headers`` are 
<a name="l2085"><span class="ln">2085 </span></a>                extended. 
<a name="l2086"><span class="ln">2086 </span></a> 
<a name="l2087"><span class="ln">2087 </span></a>            :attr:`response_class` 
<a name="l2088"><span class="ln">2088 </span></a>                The object is returned unchanged. 
<a name="l2089"><span class="ln">2089 </span></a> 
<a name="l2090"><span class="ln">2090 </span></a>            other :class:`~werkzeug.wrappers.Response` class 
<a name="l2091"><span class="ln">2091 </span></a>                The object is coerced to :attr:`response_class`. 
<a name="l2092"><span class="ln">2092 </span></a> 
<a name="l2093"><span class="ln">2093 </span></a>            :func:`callable` 
<a name="l2094"><span class="ln">2094 </span></a>                The function is called as a WSGI application. The result is 
<a name="l2095"><span class="ln">2095 </span></a>                used to create a response object. 
<a name="l2096"><span class="ln">2096 </span></a> 
<a name="l2097"><span class="ln">2097 </span></a>        .. versionchanged:: 2.2 
<a name="l2098"><span class="ln">2098 </span></a>            A generator will be converted to a streaming response. 
<a name="l2099"><span class="ln">2099 </span></a>            A list will be converted to a JSON response. 
<a name="l2100"><span class="ln">2100 </span></a> 
<a name="l2101"><span class="ln">2101 </span></a>        .. versionchanged:: 1.1 
<a name="l2102"><span class="ln">2102 </span></a>            A dict will be converted to a JSON response. 
<a name="l2103"><span class="ln">2103 </span></a> 
<a name="l2104"><span class="ln">2104 </span></a>        .. versionchanged:: 0.9 
<a name="l2105"><span class="ln">2105 </span></a>           Previously a tuple was interpreted as the arguments for the 
<a name="l2106"><span class="ln">2106 </span></a>           response object. 
<a name="l2107"><span class="ln">2107 </span></a>        &quot;&quot;&quot;</span>
<a name="l2108"><span class="ln">2108 </span></a>
<a name="l2109"><span class="ln">2109 </span></a>        <span class="s1">status = headers = </span><span class="s0">None</span>
<a name="l2110"><span class="ln">2110 </span></a>
<a name="l2111"><span class="ln">2111 </span></a>        <span class="s2"># unpack tuple returns</span>
<a name="l2112"><span class="ln">2112 </span></a>        <span class="s0">if </span><span class="s1">isinstance(rv</span><span class="s0">, </span><span class="s1">tuple):</span>
<a name="l2113"><span class="ln">2113 </span></a>            <span class="s1">len_rv = len(rv)</span>
<a name="l2114"><span class="ln">2114 </span></a>
<a name="l2115"><span class="ln">2115 </span></a>            <span class="s2"># a 3-tuple is unpacked directly</span>
<a name="l2116"><span class="ln">2116 </span></a>            <span class="s0">if </span><span class="s1">len_rv == </span><span class="s4">3</span><span class="s1">:</span>
<a name="l2117"><span class="ln">2117 </span></a>                <span class="s1">rv</span><span class="s0">, </span><span class="s1">status</span><span class="s0">, </span><span class="s1">headers = rv  </span><span class="s2"># type: ignore[misc]</span>
<a name="l2118"><span class="ln">2118 </span></a>            <span class="s2"># decide if a 2-tuple has status or headers</span>
<a name="l2119"><span class="ln">2119 </span></a>            <span class="s0">elif </span><span class="s1">len_rv == </span><span class="s4">2</span><span class="s1">:</span>
<a name="l2120"><span class="ln">2120 </span></a>                <span class="s0">if </span><span class="s1">isinstance(rv[</span><span class="s4">1</span><span class="s1">]</span><span class="s0">, </span><span class="s1">(Headers</span><span class="s0">, </span><span class="s1">dict</span><span class="s0">, </span><span class="s1">tuple</span><span class="s0">, </span><span class="s1">list)):</span>
<a name="l2121"><span class="ln">2121 </span></a>                    <span class="s1">rv</span><span class="s0">, </span><span class="s1">headers = rv</span>
<a name="l2122"><span class="ln">2122 </span></a>                <span class="s0">else</span><span class="s1">:</span>
<a name="l2123"><span class="ln">2123 </span></a>                    <span class="s1">rv</span><span class="s0">, </span><span class="s1">status = rv  </span><span class="s2"># type: ignore[assignment,misc]</span>
<a name="l2124"><span class="ln">2124 </span></a>            <span class="s2"># other sized tuples are not allowed</span>
<a name="l2125"><span class="ln">2125 </span></a>            <span class="s0">else</span><span class="s1">:</span>
<a name="l2126"><span class="ln">2126 </span></a>                <span class="s0">raise </span><span class="s1">TypeError(</span>
<a name="l2127"><span class="ln">2127 </span></a>                    <span class="s3">&quot;The view function did not return a valid response tuple.&quot;</span>
<a name="l2128"><span class="ln">2128 </span></a>                    <span class="s3">&quot; The tuple must have the form (body, status, headers),&quot;</span>
<a name="l2129"><span class="ln">2129 </span></a>                    <span class="s3">&quot; (body, status), or (body, headers).&quot;</span>
<a name="l2130"><span class="ln">2130 </span></a>                <span class="s1">)</span>
<a name="l2131"><span class="ln">2131 </span></a>
<a name="l2132"><span class="ln">2132 </span></a>        <span class="s2"># the body must not be None</span>
<a name="l2133"><span class="ln">2133 </span></a>        <span class="s0">if </span><span class="s1">rv </span><span class="s0">is None</span><span class="s1">:</span>
<a name="l2134"><span class="ln">2134 </span></a>            <span class="s0">raise </span><span class="s1">TypeError(</span>
<a name="l2135"><span class="ln">2135 </span></a>                <span class="s3">f&quot;The view function for </span><span class="s0">{</span><span class="s1">request.endpoint</span><span class="s0">!r} </span><span class="s3">did not&quot;</span>
<a name="l2136"><span class="ln">2136 </span></a>                <span class="s3">&quot; return a valid response. The function either returned&quot;</span>
<a name="l2137"><span class="ln">2137 </span></a>                <span class="s3">&quot; None or ended without a return statement.&quot;</span>
<a name="l2138"><span class="ln">2138 </span></a>            <span class="s1">)</span>
<a name="l2139"><span class="ln">2139 </span></a>
<a name="l2140"><span class="ln">2140 </span></a>        <span class="s2"># make sure the body is an instance of the response class</span>
<a name="l2141"><span class="ln">2141 </span></a>        <span class="s0">if not </span><span class="s1">isinstance(rv</span><span class="s0">, </span><span class="s1">self.response_class):</span>
<a name="l2142"><span class="ln">2142 </span></a>            <span class="s0">if </span><span class="s1">isinstance(rv</span><span class="s0">, </span><span class="s1">(str</span><span class="s0">, </span><span class="s1">bytes</span><span class="s0">, </span><span class="s1">bytearray)) </span><span class="s0">or </span><span class="s1">isinstance(rv</span><span class="s0">, </span><span class="s1">_abc_Iterator):</span>
<a name="l2143"><span class="ln">2143 </span></a>                <span class="s2"># let the response class set the status and headers instead of</span>
<a name="l2144"><span class="ln">2144 </span></a>                <span class="s2"># waiting to do it manually, so that the class can handle any</span>
<a name="l2145"><span class="ln">2145 </span></a>                <span class="s2"># special logic</span>
<a name="l2146"><span class="ln">2146 </span></a>                <span class="s1">rv = self.response_class(</span>
<a name="l2147"><span class="ln">2147 </span></a>                    <span class="s1">rv</span><span class="s0">,</span>
<a name="l2148"><span class="ln">2148 </span></a>                    <span class="s1">status=status</span><span class="s0">,</span>
<a name="l2149"><span class="ln">2149 </span></a>                    <span class="s1">headers=headers</span><span class="s0">,  </span><span class="s2"># type: ignore[arg-type]</span>
<a name="l2150"><span class="ln">2150 </span></a>                <span class="s1">)</span>
<a name="l2151"><span class="ln">2151 </span></a>                <span class="s1">status = headers = </span><span class="s0">None</span>
<a name="l2152"><span class="ln">2152 </span></a>            <span class="s0">elif </span><span class="s1">isinstance(rv</span><span class="s0">, </span><span class="s1">(dict</span><span class="s0">, </span><span class="s1">list)):</span>
<a name="l2153"><span class="ln">2153 </span></a>                <span class="s1">rv = self.json.response(rv)</span>
<a name="l2154"><span class="ln">2154 </span></a>            <span class="s0">elif </span><span class="s1">isinstance(rv</span><span class="s0">, </span><span class="s1">BaseResponse) </span><span class="s0">or </span><span class="s1">callable(rv):</span>
<a name="l2155"><span class="ln">2155 </span></a>                <span class="s2"># evaluate a WSGI callable, or coerce a different response</span>
<a name="l2156"><span class="ln">2156 </span></a>                <span class="s2"># class to the correct type</span>
<a name="l2157"><span class="ln">2157 </span></a>                <span class="s0">try</span><span class="s1">:</span>
<a name="l2158"><span class="ln">2158 </span></a>                    <span class="s1">rv = self.response_class.force_type(</span>
<a name="l2159"><span class="ln">2159 </span></a>                        <span class="s1">rv</span><span class="s0">, </span><span class="s1">request.environ  </span><span class="s2"># type: ignore[arg-type]</span>
<a name="l2160"><span class="ln">2160 </span></a>                    <span class="s1">)</span>
<a name="l2161"><span class="ln">2161 </span></a>                <span class="s0">except </span><span class="s1">TypeError </span><span class="s0">as </span><span class="s1">e:</span>
<a name="l2162"><span class="ln">2162 </span></a>                    <span class="s0">raise </span><span class="s1">TypeError(</span>
<a name="l2163"><span class="ln">2163 </span></a>                        <span class="s3">f&quot;</span><span class="s0">{</span><span class="s1">e</span><span class="s0">}\n</span><span class="s3">The view function did not return a valid&quot;</span>
<a name="l2164"><span class="ln">2164 </span></a>                        <span class="s3">&quot; response. The return type must be a string,&quot;</span>
<a name="l2165"><span class="ln">2165 </span></a>                        <span class="s3">&quot; dict, list, tuple with headers or status,&quot;</span>
<a name="l2166"><span class="ln">2166 </span></a>                        <span class="s3">&quot; Response instance, or WSGI callable, but it&quot;</span>
<a name="l2167"><span class="ln">2167 </span></a>                        <span class="s3">f&quot; was a </span><span class="s0">{</span><span class="s1">type(rv).__name__</span><span class="s0">}</span><span class="s3">.&quot;</span>
<a name="l2168"><span class="ln">2168 </span></a>                    <span class="s1">).with_traceback(sys.exc_info()[</span><span class="s4">2</span><span class="s1">]) </span><span class="s0">from None</span>
<a name="l2169"><span class="ln">2169 </span></a>            <span class="s0">else</span><span class="s1">:</span>
<a name="l2170"><span class="ln">2170 </span></a>                <span class="s0">raise </span><span class="s1">TypeError(</span>
<a name="l2171"><span class="ln">2171 </span></a>                    <span class="s3">&quot;The view function did not return a valid&quot;</span>
<a name="l2172"><span class="ln">2172 </span></a>                    <span class="s3">&quot; response. The return type must be a string,&quot;</span>
<a name="l2173"><span class="ln">2173 </span></a>                    <span class="s3">&quot; dict, list, tuple with headers or status,&quot;</span>
<a name="l2174"><span class="ln">2174 </span></a>                    <span class="s3">&quot; Response instance, or WSGI callable, but it was a&quot;</span>
<a name="l2175"><span class="ln">2175 </span></a>                    <span class="s3">f&quot; </span><span class="s0">{</span><span class="s1">type(rv).__name__</span><span class="s0">}</span><span class="s3">.&quot;</span>
<a name="l2176"><span class="ln">2176 </span></a>                <span class="s1">)</span>
<a name="l2177"><span class="ln">2177 </span></a>
<a name="l2178"><span class="ln">2178 </span></a>        <span class="s1">rv = t.cast(Response</span><span class="s0">, </span><span class="s1">rv)</span>
<a name="l2179"><span class="ln">2179 </span></a>        <span class="s2"># prefer the status if it was provided</span>
<a name="l2180"><span class="ln">2180 </span></a>        <span class="s0">if </span><span class="s1">status </span><span class="s0">is not None</span><span class="s1">:</span>
<a name="l2181"><span class="ln">2181 </span></a>            <span class="s0">if </span><span class="s1">isinstance(status</span><span class="s0">, </span><span class="s1">(str</span><span class="s0">, </span><span class="s1">bytes</span><span class="s0">, </span><span class="s1">bytearray)):</span>
<a name="l2182"><span class="ln">2182 </span></a>                <span class="s1">rv.status = status</span>
<a name="l2183"><span class="ln">2183 </span></a>            <span class="s0">else</span><span class="s1">:</span>
<a name="l2184"><span class="ln">2184 </span></a>                <span class="s1">rv.status_code = status</span>
<a name="l2185"><span class="ln">2185 </span></a>
<a name="l2186"><span class="ln">2186 </span></a>        <span class="s2"># extend existing headers with provided headers</span>
<a name="l2187"><span class="ln">2187 </span></a>        <span class="s0">if </span><span class="s1">headers:</span>
<a name="l2188"><span class="ln">2188 </span></a>            <span class="s1">rv.headers.update(headers)  </span><span class="s2"># type: ignore[arg-type]</span>
<a name="l2189"><span class="ln">2189 </span></a>
<a name="l2190"><span class="ln">2190 </span></a>        <span class="s0">return </span><span class="s1">rv</span>
<a name="l2191"><span class="ln">2191 </span></a>
<a name="l2192"><span class="ln">2192 </span></a>    <span class="s0">def </span><span class="s1">create_url_adapter(</span>
<a name="l2193"><span class="ln">2193 </span></a>        <span class="s1">self</span><span class="s0">, </span><span class="s1">request: t.Optional[Request]</span>
<a name="l2194"><span class="ln">2194 </span></a>    <span class="s1">) -&gt; t.Optional[MapAdapter]:</span>
<a name="l2195"><span class="ln">2195 </span></a>        <span class="s5">&quot;&quot;&quot;Creates a URL adapter for the given request. The URL adapter 
<a name="l2196"><span class="ln">2196 </span></a>        is created at a point where the request context is not yet set 
<a name="l2197"><span class="ln">2197 </span></a>        up so the request is passed explicitly. 
<a name="l2198"><span class="ln">2198 </span></a> 
<a name="l2199"><span class="ln">2199 </span></a>        .. versionadded:: 0.6 
<a name="l2200"><span class="ln">2200 </span></a> 
<a name="l2201"><span class="ln">2201 </span></a>        .. versionchanged:: 0.9 
<a name="l2202"><span class="ln">2202 </span></a>           This can now also be called without a request object when the 
<a name="l2203"><span class="ln">2203 </span></a>           URL adapter is created for the application context. 
<a name="l2204"><span class="ln">2204 </span></a> 
<a name="l2205"><span class="ln">2205 </span></a>        .. versionchanged:: 1.0 
<a name="l2206"><span class="ln">2206 </span></a>            :data:`SERVER_NAME` no longer implicitly enables subdomain 
<a name="l2207"><span class="ln">2207 </span></a>            matching. Use :attr:`subdomain_matching` instead. 
<a name="l2208"><span class="ln">2208 </span></a>        &quot;&quot;&quot;</span>
<a name="l2209"><span class="ln">2209 </span></a>        <span class="s0">if </span><span class="s1">request </span><span class="s0">is not None</span><span class="s1">:</span>
<a name="l2210"><span class="ln">2210 </span></a>            <span class="s2"># If subdomain matching is disabled (the default), use the</span>
<a name="l2211"><span class="ln">2211 </span></a>            <span class="s2"># default subdomain in all cases. This should be the default</span>
<a name="l2212"><span class="ln">2212 </span></a>            <span class="s2"># in Werkzeug but it currently does not have that feature.</span>
<a name="l2213"><span class="ln">2213 </span></a>            <span class="s0">if not </span><span class="s1">self.subdomain_matching:</span>
<a name="l2214"><span class="ln">2214 </span></a>                <span class="s1">subdomain = self.url_map.default_subdomain </span><span class="s0">or None</span>
<a name="l2215"><span class="ln">2215 </span></a>            <span class="s0">else</span><span class="s1">:</span>
<a name="l2216"><span class="ln">2216 </span></a>                <span class="s1">subdomain = </span><span class="s0">None</span>
<a name="l2217"><span class="ln">2217 </span></a>
<a name="l2218"><span class="ln">2218 </span></a>            <span class="s0">return </span><span class="s1">self.url_map.bind_to_environ(</span>
<a name="l2219"><span class="ln">2219 </span></a>                <span class="s1">request.environ</span><span class="s0">,</span>
<a name="l2220"><span class="ln">2220 </span></a>                <span class="s1">server_name=self.config[</span><span class="s3">&quot;SERVER_NAME&quot;</span><span class="s1">]</span><span class="s0">,</span>
<a name="l2221"><span class="ln">2221 </span></a>                <span class="s1">subdomain=subdomain</span><span class="s0">,</span>
<a name="l2222"><span class="ln">2222 </span></a>            <span class="s1">)</span>
<a name="l2223"><span class="ln">2223 </span></a>        <span class="s2"># We need at the very least the server name to be set for this</span>
<a name="l2224"><span class="ln">2224 </span></a>        <span class="s2"># to work.</span>
<a name="l2225"><span class="ln">2225 </span></a>        <span class="s0">if </span><span class="s1">self.config[</span><span class="s3">&quot;SERVER_NAME&quot;</span><span class="s1">] </span><span class="s0">is not None</span><span class="s1">:</span>
<a name="l2226"><span class="ln">2226 </span></a>            <span class="s0">return </span><span class="s1">self.url_map.bind(</span>
<a name="l2227"><span class="ln">2227 </span></a>                <span class="s1">self.config[</span><span class="s3">&quot;SERVER_NAME&quot;</span><span class="s1">]</span><span class="s0">,</span>
<a name="l2228"><span class="ln">2228 </span></a>                <span class="s1">script_name=self.config[</span><span class="s3">&quot;APPLICATION_ROOT&quot;</span><span class="s1">]</span><span class="s0">,</span>
<a name="l2229"><span class="ln">2229 </span></a>                <span class="s1">url_scheme=self.config[</span><span class="s3">&quot;PREFERRED_URL_SCHEME&quot;</span><span class="s1">]</span><span class="s0">,</span>
<a name="l2230"><span class="ln">2230 </span></a>            <span class="s1">)</span>
<a name="l2231"><span class="ln">2231 </span></a>
<a name="l2232"><span class="ln">2232 </span></a>        <span class="s0">return None</span>
<a name="l2233"><span class="ln">2233 </span></a>
<a name="l2234"><span class="ln">2234 </span></a>    <span class="s0">def </span><span class="s1">inject_url_defaults(self</span><span class="s0">, </span><span class="s1">endpoint: str</span><span class="s0">, </span><span class="s1">values: dict) -&gt; </span><span class="s0">None</span><span class="s1">:</span>
<a name="l2235"><span class="ln">2235 </span></a>        <span class="s5">&quot;&quot;&quot;Injects the URL defaults for the given endpoint directly into 
<a name="l2236"><span class="ln">2236 </span></a>        the values dictionary passed.  This is used internally and 
<a name="l2237"><span class="ln">2237 </span></a>        automatically called on URL building. 
<a name="l2238"><span class="ln">2238 </span></a> 
<a name="l2239"><span class="ln">2239 </span></a>        .. versionadded:: 0.7 
<a name="l2240"><span class="ln">2240 </span></a>        &quot;&quot;&quot;</span>
<a name="l2241"><span class="ln">2241 </span></a>        <span class="s1">names: t.Iterable[t.Optional[str]] = (</span><span class="s0">None,</span><span class="s1">)</span>
<a name="l2242"><span class="ln">2242 </span></a>
<a name="l2243"><span class="ln">2243 </span></a>        <span class="s2"># url_for may be called outside a request context, parse the</span>
<a name="l2244"><span class="ln">2244 </span></a>        <span class="s2"># passed endpoint instead of using request.blueprints.</span>
<a name="l2245"><span class="ln">2245 </span></a>        <span class="s0">if </span><span class="s3">&quot;.&quot; </span><span class="s0">in </span><span class="s1">endpoint:</span>
<a name="l2246"><span class="ln">2246 </span></a>            <span class="s1">names = chain(</span>
<a name="l2247"><span class="ln">2247 </span></a>                <span class="s1">names</span><span class="s0">, </span><span class="s1">reversed(_split_blueprint_path(endpoint.rpartition(</span><span class="s3">&quot;.&quot;</span><span class="s1">)[</span><span class="s4">0</span><span class="s1">]))</span>
<a name="l2248"><span class="ln">2248 </span></a>            <span class="s1">)</span>
<a name="l2249"><span class="ln">2249 </span></a>
<a name="l2250"><span class="ln">2250 </span></a>        <span class="s0">for </span><span class="s1">name </span><span class="s0">in </span><span class="s1">names:</span>
<a name="l2251"><span class="ln">2251 </span></a>            <span class="s0">if </span><span class="s1">name </span><span class="s0">in </span><span class="s1">self.url_default_functions:</span>
<a name="l2252"><span class="ln">2252 </span></a>                <span class="s0">for </span><span class="s1">func </span><span class="s0">in </span><span class="s1">self.url_default_functions[name]:</span>
<a name="l2253"><span class="ln">2253 </span></a>                    <span class="s1">func(endpoint</span><span class="s0">, </span><span class="s1">values)</span>
<a name="l2254"><span class="ln">2254 </span></a>
<a name="l2255"><span class="ln">2255 </span></a>    <span class="s0">def </span><span class="s1">handle_url_build_error(</span>
<a name="l2256"><span class="ln">2256 </span></a>        <span class="s1">self</span><span class="s0">, </span><span class="s1">error: BuildError</span><span class="s0">, </span><span class="s1">endpoint: str</span><span class="s0">, </span><span class="s1">values: t.Dict[str</span><span class="s0">, </span><span class="s1">t.Any]</span>
<a name="l2257"><span class="ln">2257 </span></a>    <span class="s1">) -&gt; str:</span>
<a name="l2258"><span class="ln">2258 </span></a>        <span class="s5">&quot;&quot;&quot;Called by :meth:`.url_for` if a 
<a name="l2259"><span class="ln">2259 </span></a>        :exc:`~werkzeug.routing.BuildError` was raised. If this returns 
<a name="l2260"><span class="ln">2260 </span></a>        a value, it will be returned by ``url_for``, otherwise the error 
<a name="l2261"><span class="ln">2261 </span></a>        will be re-raised. 
<a name="l2262"><span class="ln">2262 </span></a> 
<a name="l2263"><span class="ln">2263 </span></a>        Each function in :attr:`url_build_error_handlers` is called with 
<a name="l2264"><span class="ln">2264 </span></a>        ``error``, ``endpoint`` and ``values``. If a function returns 
<a name="l2265"><span class="ln">2265 </span></a>        ``None`` or raises a ``BuildError``, it is skipped. Otherwise, 
<a name="l2266"><span class="ln">2266 </span></a>        its return value is returned by ``url_for``. 
<a name="l2267"><span class="ln">2267 </span></a> 
<a name="l2268"><span class="ln">2268 </span></a>        :param error: The active ``BuildError`` being handled. 
<a name="l2269"><span class="ln">2269 </span></a>        :param endpoint: The endpoint being built. 
<a name="l2270"><span class="ln">2270 </span></a>        :param values: The keyword arguments passed to ``url_for``. 
<a name="l2271"><span class="ln">2271 </span></a>        &quot;&quot;&quot;</span>
<a name="l2272"><span class="ln">2272 </span></a>        <span class="s0">for </span><span class="s1">handler </span><span class="s0">in </span><span class="s1">self.url_build_error_handlers:</span>
<a name="l2273"><span class="ln">2273 </span></a>            <span class="s0">try</span><span class="s1">:</span>
<a name="l2274"><span class="ln">2274 </span></a>                <span class="s1">rv = handler(error</span><span class="s0">, </span><span class="s1">endpoint</span><span class="s0">, </span><span class="s1">values)</span>
<a name="l2275"><span class="ln">2275 </span></a>            <span class="s0">except </span><span class="s1">BuildError </span><span class="s0">as </span><span class="s1">e:</span>
<a name="l2276"><span class="ln">2276 </span></a>                <span class="s2"># make error available outside except block</span>
<a name="l2277"><span class="ln">2277 </span></a>                <span class="s1">error = e</span>
<a name="l2278"><span class="ln">2278 </span></a>            <span class="s0">else</span><span class="s1">:</span>
<a name="l2279"><span class="ln">2279 </span></a>                <span class="s0">if </span><span class="s1">rv </span><span class="s0">is not None</span><span class="s1">:</span>
<a name="l2280"><span class="ln">2280 </span></a>                    <span class="s0">return </span><span class="s1">rv</span>
<a name="l2281"><span class="ln">2281 </span></a>
<a name="l2282"><span class="ln">2282 </span></a>        <span class="s2"># Re-raise if called with an active exception, otherwise raise</span>
<a name="l2283"><span class="ln">2283 </span></a>        <span class="s2"># the passed in exception.</span>
<a name="l2284"><span class="ln">2284 </span></a>        <span class="s0">if </span><span class="s1">error </span><span class="s0">is </span><span class="s1">sys.exc_info()[</span><span class="s4">1</span><span class="s1">]:</span>
<a name="l2285"><span class="ln">2285 </span></a>            <span class="s0">raise</span>
<a name="l2286"><span class="ln">2286 </span></a>
<a name="l2287"><span class="ln">2287 </span></a>        <span class="s0">raise </span><span class="s1">error</span>
<a name="l2288"><span class="ln">2288 </span></a>
<a name="l2289"><span class="ln">2289 </span></a>    <span class="s0">def </span><span class="s1">preprocess_request(self) -&gt; t.Optional[ft.ResponseReturnValue]:</span>
<a name="l2290"><span class="ln">2290 </span></a>        <span class="s5">&quot;&quot;&quot;Called before the request is dispatched. Calls 
<a name="l2291"><span class="ln">2291 </span></a>        :attr:`url_value_preprocessors` registered with the app and the 
<a name="l2292"><span class="ln">2292 </span></a>        current blueprint (if any). Then calls :attr:`before_request_funcs` 
<a name="l2293"><span class="ln">2293 </span></a>        registered with the app and the blueprint. 
<a name="l2294"><span class="ln">2294 </span></a> 
<a name="l2295"><span class="ln">2295 </span></a>        If any :meth:`before_request` handler returns a non-None value, the 
<a name="l2296"><span class="ln">2296 </span></a>        value is handled as if it was the return value from the view, and 
<a name="l2297"><span class="ln">2297 </span></a>        further request handling is stopped. 
<a name="l2298"><span class="ln">2298 </span></a>        &quot;&quot;&quot;</span>
<a name="l2299"><span class="ln">2299 </span></a>        <span class="s1">names = (</span><span class="s0">None, </span><span class="s1">*reversed(request.blueprints))</span>
<a name="l2300"><span class="ln">2300 </span></a>
<a name="l2301"><span class="ln">2301 </span></a>        <span class="s0">for </span><span class="s1">name </span><span class="s0">in </span><span class="s1">names:</span>
<a name="l2302"><span class="ln">2302 </span></a>            <span class="s0">if </span><span class="s1">name </span><span class="s0">in </span><span class="s1">self.url_value_preprocessors:</span>
<a name="l2303"><span class="ln">2303 </span></a>                <span class="s0">for </span><span class="s1">url_func </span><span class="s0">in </span><span class="s1">self.url_value_preprocessors[name]:</span>
<a name="l2304"><span class="ln">2304 </span></a>                    <span class="s1">url_func(request.endpoint</span><span class="s0">, </span><span class="s1">request.view_args)</span>
<a name="l2305"><span class="ln">2305 </span></a>
<a name="l2306"><span class="ln">2306 </span></a>        <span class="s0">for </span><span class="s1">name </span><span class="s0">in </span><span class="s1">names:</span>
<a name="l2307"><span class="ln">2307 </span></a>            <span class="s0">if </span><span class="s1">name </span><span class="s0">in </span><span class="s1">self.before_request_funcs:</span>
<a name="l2308"><span class="ln">2308 </span></a>                <span class="s0">for </span><span class="s1">before_func </span><span class="s0">in </span><span class="s1">self.before_request_funcs[name]:</span>
<a name="l2309"><span class="ln">2309 </span></a>                    <span class="s1">rv = self.ensure_sync(before_func)()</span>
<a name="l2310"><span class="ln">2310 </span></a>
<a name="l2311"><span class="ln">2311 </span></a>                    <span class="s0">if </span><span class="s1">rv </span><span class="s0">is not None</span><span class="s1">:</span>
<a name="l2312"><span class="ln">2312 </span></a>                        <span class="s0">return </span><span class="s1">rv</span>
<a name="l2313"><span class="ln">2313 </span></a>
<a name="l2314"><span class="ln">2314 </span></a>        <span class="s0">return None</span>
<a name="l2315"><span class="ln">2315 </span></a>
<a name="l2316"><span class="ln">2316 </span></a>    <span class="s0">def </span><span class="s1">process_response(self</span><span class="s0">, </span><span class="s1">response: Response) -&gt; Response:</span>
<a name="l2317"><span class="ln">2317 </span></a>        <span class="s5">&quot;&quot;&quot;Can be overridden in order to modify the response object 
<a name="l2318"><span class="ln">2318 </span></a>        before it's sent to the WSGI server.  By default this will 
<a name="l2319"><span class="ln">2319 </span></a>        call all the :meth:`after_request` decorated functions. 
<a name="l2320"><span class="ln">2320 </span></a> 
<a name="l2321"><span class="ln">2321 </span></a>        .. versionchanged:: 0.5 
<a name="l2322"><span class="ln">2322 </span></a>           As of Flask 0.5 the functions registered for after request 
<a name="l2323"><span class="ln">2323 </span></a>           execution are called in reverse order of registration. 
<a name="l2324"><span class="ln">2324 </span></a> 
<a name="l2325"><span class="ln">2325 </span></a>        :param response: a :attr:`response_class` object. 
<a name="l2326"><span class="ln">2326 </span></a>        :return: a new response object or the same, has to be an 
<a name="l2327"><span class="ln">2327 </span></a>                 instance of :attr:`response_class`. 
<a name="l2328"><span class="ln">2328 </span></a>        &quot;&quot;&quot;</span>
<a name="l2329"><span class="ln">2329 </span></a>        <span class="s1">ctx = request_ctx._get_current_object()  </span><span class="s2"># type: ignore[attr-defined]</span>
<a name="l2330"><span class="ln">2330 </span></a>
<a name="l2331"><span class="ln">2331 </span></a>        <span class="s0">for </span><span class="s1">func </span><span class="s0">in </span><span class="s1">ctx._after_request_functions:</span>
<a name="l2332"><span class="ln">2332 </span></a>            <span class="s1">response = self.ensure_sync(func)(response)</span>
<a name="l2333"><span class="ln">2333 </span></a>
<a name="l2334"><span class="ln">2334 </span></a>        <span class="s0">for </span><span class="s1">name </span><span class="s0">in </span><span class="s1">chain(request.blueprints</span><span class="s0">, </span><span class="s1">(</span><span class="s0">None,</span><span class="s1">)):</span>
<a name="l2335"><span class="ln">2335 </span></a>            <span class="s0">if </span><span class="s1">name </span><span class="s0">in </span><span class="s1">self.after_request_funcs:</span>
<a name="l2336"><span class="ln">2336 </span></a>                <span class="s0">for </span><span class="s1">func </span><span class="s0">in </span><span class="s1">reversed(self.after_request_funcs[name]):</span>
<a name="l2337"><span class="ln">2337 </span></a>                    <span class="s1">response = self.ensure_sync(func)(response)</span>
<a name="l2338"><span class="ln">2338 </span></a>
<a name="l2339"><span class="ln">2339 </span></a>        <span class="s0">if not </span><span class="s1">self.session_interface.is_null_session(ctx.session):</span>
<a name="l2340"><span class="ln">2340 </span></a>            <span class="s1">self.session_interface.save_session(self</span><span class="s0">, </span><span class="s1">ctx.session</span><span class="s0">, </span><span class="s1">response)</span>
<a name="l2341"><span class="ln">2341 </span></a>
<a name="l2342"><span class="ln">2342 </span></a>        <span class="s0">return </span><span class="s1">response</span>
<a name="l2343"><span class="ln">2343 </span></a>
<a name="l2344"><span class="ln">2344 </span></a>    <span class="s0">def </span><span class="s1">do_teardown_request(</span>
<a name="l2345"><span class="ln">2345 </span></a>        <span class="s1">self</span><span class="s0">, </span><span class="s1">exc: t.Optional[BaseException] = _sentinel  </span><span class="s2"># type: ignore</span>
<a name="l2346"><span class="ln">2346 </span></a>    <span class="s1">) -&gt; </span><span class="s0">None</span><span class="s1">:</span>
<a name="l2347"><span class="ln">2347 </span></a>        <span class="s5">&quot;&quot;&quot;Called after the request is dispatched and the response is 
<a name="l2348"><span class="ln">2348 </span></a>        returned, right before the request context is popped. 
<a name="l2349"><span class="ln">2349 </span></a> 
<a name="l2350"><span class="ln">2350 </span></a>        This calls all functions decorated with 
<a name="l2351"><span class="ln">2351 </span></a>        :meth:`teardown_request`, and :meth:`Blueprint.teardown_request` 
<a name="l2352"><span class="ln">2352 </span></a>        if a blueprint handled the request. Finally, the 
<a name="l2353"><span class="ln">2353 </span></a>        :data:`request_tearing_down` signal is sent. 
<a name="l2354"><span class="ln">2354 </span></a> 
<a name="l2355"><span class="ln">2355 </span></a>        This is called by 
<a name="l2356"><span class="ln">2356 </span></a>        :meth:`RequestContext.pop() &lt;flask.ctx.RequestContext.pop&gt;`, 
<a name="l2357"><span class="ln">2357 </span></a>        which may be delayed during testing to maintain access to 
<a name="l2358"><span class="ln">2358 </span></a>        resources. 
<a name="l2359"><span class="ln">2359 </span></a> 
<a name="l2360"><span class="ln">2360 </span></a>        :param exc: An unhandled exception raised while dispatching the 
<a name="l2361"><span class="ln">2361 </span></a>            request. Detected from the current exception information if 
<a name="l2362"><span class="ln">2362 </span></a>            not passed. Passed to each teardown function. 
<a name="l2363"><span class="ln">2363 </span></a> 
<a name="l2364"><span class="ln">2364 </span></a>        .. versionchanged:: 0.9 
<a name="l2365"><span class="ln">2365 </span></a>            Added the ``exc`` argument. 
<a name="l2366"><span class="ln">2366 </span></a>        &quot;&quot;&quot;</span>
<a name="l2367"><span class="ln">2367 </span></a>        <span class="s0">if </span><span class="s1">exc </span><span class="s0">is </span><span class="s1">_sentinel:</span>
<a name="l2368"><span class="ln">2368 </span></a>            <span class="s1">exc = sys.exc_info()[</span><span class="s4">1</span><span class="s1">]</span>
<a name="l2369"><span class="ln">2369 </span></a>
<a name="l2370"><span class="ln">2370 </span></a>        <span class="s0">for </span><span class="s1">name </span><span class="s0">in </span><span class="s1">chain(request.blueprints</span><span class="s0">, </span><span class="s1">(</span><span class="s0">None,</span><span class="s1">)):</span>
<a name="l2371"><span class="ln">2371 </span></a>            <span class="s0">if </span><span class="s1">name </span><span class="s0">in </span><span class="s1">self.teardown_request_funcs:</span>
<a name="l2372"><span class="ln">2372 </span></a>                <span class="s0">for </span><span class="s1">func </span><span class="s0">in </span><span class="s1">reversed(self.teardown_request_funcs[name]):</span>
<a name="l2373"><span class="ln">2373 </span></a>                    <span class="s1">self.ensure_sync(func)(exc)</span>
<a name="l2374"><span class="ln">2374 </span></a>
<a name="l2375"><span class="ln">2375 </span></a>        <span class="s1">request_tearing_down.send(self</span><span class="s0">, </span><span class="s1">exc=exc)</span>
<a name="l2376"><span class="ln">2376 </span></a>
<a name="l2377"><span class="ln">2377 </span></a>    <span class="s0">def </span><span class="s1">do_teardown_appcontext(</span>
<a name="l2378"><span class="ln">2378 </span></a>        <span class="s1">self</span><span class="s0">, </span><span class="s1">exc: t.Optional[BaseException] = _sentinel  </span><span class="s2"># type: ignore</span>
<a name="l2379"><span class="ln">2379 </span></a>    <span class="s1">) -&gt; </span><span class="s0">None</span><span class="s1">:</span>
<a name="l2380"><span class="ln">2380 </span></a>        <span class="s5">&quot;&quot;&quot;Called right before the application context is popped. 
<a name="l2381"><span class="ln">2381 </span></a> 
<a name="l2382"><span class="ln">2382 </span></a>        When handling a request, the application context is popped 
<a name="l2383"><span class="ln">2383 </span></a>        after the request context. See :meth:`do_teardown_request`. 
<a name="l2384"><span class="ln">2384 </span></a> 
<a name="l2385"><span class="ln">2385 </span></a>        This calls all functions decorated with 
<a name="l2386"><span class="ln">2386 </span></a>        :meth:`teardown_appcontext`. Then the 
<a name="l2387"><span class="ln">2387 </span></a>        :data:`appcontext_tearing_down` signal is sent. 
<a name="l2388"><span class="ln">2388 </span></a> 
<a name="l2389"><span class="ln">2389 </span></a>        This is called by 
<a name="l2390"><span class="ln">2390 </span></a>        :meth:`AppContext.pop() &lt;flask.ctx.AppContext.pop&gt;`. 
<a name="l2391"><span class="ln">2391 </span></a> 
<a name="l2392"><span class="ln">2392 </span></a>        .. versionadded:: 0.9 
<a name="l2393"><span class="ln">2393 </span></a>        &quot;&quot;&quot;</span>
<a name="l2394"><span class="ln">2394 </span></a>        <span class="s0">if </span><span class="s1">exc </span><span class="s0">is </span><span class="s1">_sentinel:</span>
<a name="l2395"><span class="ln">2395 </span></a>            <span class="s1">exc = sys.exc_info()[</span><span class="s4">1</span><span class="s1">]</span>
<a name="l2396"><span class="ln">2396 </span></a>
<a name="l2397"><span class="ln">2397 </span></a>        <span class="s0">for </span><span class="s1">func </span><span class="s0">in </span><span class="s1">reversed(self.teardown_appcontext_funcs):</span>
<a name="l2398"><span class="ln">2398 </span></a>            <span class="s1">self.ensure_sync(func)(exc)</span>
<a name="l2399"><span class="ln">2399 </span></a>
<a name="l2400"><span class="ln">2400 </span></a>        <span class="s1">appcontext_tearing_down.send(self</span><span class="s0">, </span><span class="s1">exc=exc)</span>
<a name="l2401"><span class="ln">2401 </span></a>
<a name="l2402"><span class="ln">2402 </span></a>    <span class="s0">def </span><span class="s1">app_context(self) -&gt; AppContext:</span>
<a name="l2403"><span class="ln">2403 </span></a>        <span class="s5">&quot;&quot;&quot;Create an :class:`~flask.ctx.AppContext`. Use as a ``with`` 
<a name="l2404"><span class="ln">2404 </span></a>        block to push the context, which will make :data:`current_app` 
<a name="l2405"><span class="ln">2405 </span></a>        point at this application. 
<a name="l2406"><span class="ln">2406 </span></a> 
<a name="l2407"><span class="ln">2407 </span></a>        An application context is automatically pushed by 
<a name="l2408"><span class="ln">2408 </span></a>        :meth:`RequestContext.push() &lt;flask.ctx.RequestContext.push&gt;` 
<a name="l2409"><span class="ln">2409 </span></a>        when handling a request, and when running a CLI command. Use 
<a name="l2410"><span class="ln">2410 </span></a>        this to manually create a context outside of these situations. 
<a name="l2411"><span class="ln">2411 </span></a> 
<a name="l2412"><span class="ln">2412 </span></a>        :: 
<a name="l2413"><span class="ln">2413 </span></a> 
<a name="l2414"><span class="ln">2414 </span></a>            with app.app_context(): 
<a name="l2415"><span class="ln">2415 </span></a>                init_db() 
<a name="l2416"><span class="ln">2416 </span></a> 
<a name="l2417"><span class="ln">2417 </span></a>        See :doc:`/appcontext`. 
<a name="l2418"><span class="ln">2418 </span></a> 
<a name="l2419"><span class="ln">2419 </span></a>        .. versionadded:: 0.9 
<a name="l2420"><span class="ln">2420 </span></a>        &quot;&quot;&quot;</span>
<a name="l2421"><span class="ln">2421 </span></a>        <span class="s0">return </span><span class="s1">AppContext(self)</span>
<a name="l2422"><span class="ln">2422 </span></a>
<a name="l2423"><span class="ln">2423 </span></a>    <span class="s0">def </span><span class="s1">request_context(self</span><span class="s0">, </span><span class="s1">environ: dict) -&gt; RequestContext:</span>
<a name="l2424"><span class="ln">2424 </span></a>        <span class="s5">&quot;&quot;&quot;Create a :class:`~flask.ctx.RequestContext` representing a 
<a name="l2425"><span class="ln">2425 </span></a>        WSGI environment. Use a ``with`` block to push the context, 
<a name="l2426"><span class="ln">2426 </span></a>        which will make :data:`request` point at this request. 
<a name="l2427"><span class="ln">2427 </span></a> 
<a name="l2428"><span class="ln">2428 </span></a>        See :doc:`/reqcontext`. 
<a name="l2429"><span class="ln">2429 </span></a> 
<a name="l2430"><span class="ln">2430 </span></a>        Typically you should not call this from your own code. A request 
<a name="l2431"><span class="ln">2431 </span></a>        context is automatically pushed by the :meth:`wsgi_app` when 
<a name="l2432"><span class="ln">2432 </span></a>        handling a request. Use :meth:`test_request_context` to create 
<a name="l2433"><span class="ln">2433 </span></a>        an environment and context instead of this method. 
<a name="l2434"><span class="ln">2434 </span></a> 
<a name="l2435"><span class="ln">2435 </span></a>        :param environ: a WSGI environment 
<a name="l2436"><span class="ln">2436 </span></a>        &quot;&quot;&quot;</span>
<a name="l2437"><span class="ln">2437 </span></a>        <span class="s0">return </span><span class="s1">RequestContext(self</span><span class="s0">, </span><span class="s1">environ)</span>
<a name="l2438"><span class="ln">2438 </span></a>
<a name="l2439"><span class="ln">2439 </span></a>    <span class="s0">def </span><span class="s1">test_request_context(self</span><span class="s0">, </span><span class="s1">*args: t.Any</span><span class="s0">, </span><span class="s1">**kwargs: t.Any) -&gt; RequestContext:</span>
<a name="l2440"><span class="ln">2440 </span></a>        <span class="s5">&quot;&quot;&quot;Create a :class:`~flask.ctx.RequestContext` for a WSGI 
<a name="l2441"><span class="ln">2441 </span></a>        environment created from the given values. This is mostly useful 
<a name="l2442"><span class="ln">2442 </span></a>        during testing, where you may want to run a function that uses 
<a name="l2443"><span class="ln">2443 </span></a>        request data without dispatching a full request. 
<a name="l2444"><span class="ln">2444 </span></a> 
<a name="l2445"><span class="ln">2445 </span></a>        See :doc:`/reqcontext`. 
<a name="l2446"><span class="ln">2446 </span></a> 
<a name="l2447"><span class="ln">2447 </span></a>        Use a ``with`` block to push the context, which will make 
<a name="l2448"><span class="ln">2448 </span></a>        :data:`request` point at the request for the created 
<a name="l2449"><span class="ln">2449 </span></a>        environment. :: 
<a name="l2450"><span class="ln">2450 </span></a> 
<a name="l2451"><span class="ln">2451 </span></a>            with test_request_context(...): 
<a name="l2452"><span class="ln">2452 </span></a>                generate_report() 
<a name="l2453"><span class="ln">2453 </span></a> 
<a name="l2454"><span class="ln">2454 </span></a>        When using the shell, it may be easier to push and pop the 
<a name="l2455"><span class="ln">2455 </span></a>        context manually to avoid indentation. :: 
<a name="l2456"><span class="ln">2456 </span></a> 
<a name="l2457"><span class="ln">2457 </span></a>            ctx = app.test_request_context(...) 
<a name="l2458"><span class="ln">2458 </span></a>            ctx.push() 
<a name="l2459"><span class="ln">2459 </span></a>            ... 
<a name="l2460"><span class="ln">2460 </span></a>            ctx.pop() 
<a name="l2461"><span class="ln">2461 </span></a> 
<a name="l2462"><span class="ln">2462 </span></a>        Takes the same arguments as Werkzeug's 
<a name="l2463"><span class="ln">2463 </span></a>        :class:`~werkzeug.test.EnvironBuilder`, with some defaults from 
<a name="l2464"><span class="ln">2464 </span></a>        the application. See the linked Werkzeug docs for most of the 
<a name="l2465"><span class="ln">2465 </span></a>        available arguments. Flask-specific behavior is listed here. 
<a name="l2466"><span class="ln">2466 </span></a> 
<a name="l2467"><span class="ln">2467 </span></a>        :param path: URL path being requested. 
<a name="l2468"><span class="ln">2468 </span></a>        :param base_url: Base URL where the app is being served, which 
<a name="l2469"><span class="ln">2469 </span></a>            ``path`` is relative to. If not given, built from 
<a name="l2470"><span class="ln">2470 </span></a>            :data:`PREFERRED_URL_SCHEME`, ``subdomain``, 
<a name="l2471"><span class="ln">2471 </span></a>            :data:`SERVER_NAME`, and :data:`APPLICATION_ROOT`. 
<a name="l2472"><span class="ln">2472 </span></a>        :param subdomain: Subdomain name to append to 
<a name="l2473"><span class="ln">2473 </span></a>            :data:`SERVER_NAME`. 
<a name="l2474"><span class="ln">2474 </span></a>        :param url_scheme: Scheme to use instead of 
<a name="l2475"><span class="ln">2475 </span></a>            :data:`PREFERRED_URL_SCHEME`. 
<a name="l2476"><span class="ln">2476 </span></a>        :param data: The request body, either as a string or a dict of 
<a name="l2477"><span class="ln">2477 </span></a>            form keys and values. 
<a name="l2478"><span class="ln">2478 </span></a>        :param json: If given, this is serialized as JSON and passed as 
<a name="l2479"><span class="ln">2479 </span></a>            ``data``. Also defaults ``content_type`` to 
<a name="l2480"><span class="ln">2480 </span></a>            ``application/json``. 
<a name="l2481"><span class="ln">2481 </span></a>        :param args: other positional arguments passed to 
<a name="l2482"><span class="ln">2482 </span></a>            :class:`~werkzeug.test.EnvironBuilder`. 
<a name="l2483"><span class="ln">2483 </span></a>        :param kwargs: other keyword arguments passed to 
<a name="l2484"><span class="ln">2484 </span></a>            :class:`~werkzeug.test.EnvironBuilder`. 
<a name="l2485"><span class="ln">2485 </span></a>        &quot;&quot;&quot;</span>
<a name="l2486"><span class="ln">2486 </span></a>        <span class="s0">from </span><span class="s1">.testing </span><span class="s0">import </span><span class="s1">EnvironBuilder</span>
<a name="l2487"><span class="ln">2487 </span></a>
<a name="l2488"><span class="ln">2488 </span></a>        <span class="s1">builder = EnvironBuilder(self</span><span class="s0">, </span><span class="s1">*args</span><span class="s0">, </span><span class="s1">**kwargs)</span>
<a name="l2489"><span class="ln">2489 </span></a>
<a name="l2490"><span class="ln">2490 </span></a>        <span class="s0">try</span><span class="s1">:</span>
<a name="l2491"><span class="ln">2491 </span></a>            <span class="s0">return </span><span class="s1">self.request_context(builder.get_environ())</span>
<a name="l2492"><span class="ln">2492 </span></a>        <span class="s0">finally</span><span class="s1">:</span>
<a name="l2493"><span class="ln">2493 </span></a>            <span class="s1">builder.close()</span>
<a name="l2494"><span class="ln">2494 </span></a>
<a name="l2495"><span class="ln">2495 </span></a>    <span class="s0">def </span><span class="s1">wsgi_app(self</span><span class="s0">, </span><span class="s1">environ: dict</span><span class="s0">, </span><span class="s1">start_response: t.Callable) -&gt; t.Any:</span>
<a name="l2496"><span class="ln">2496 </span></a>        <span class="s5">&quot;&quot;&quot;The actual WSGI application. This is not implemented in 
<a name="l2497"><span class="ln">2497 </span></a>        :meth:`__call__` so that middlewares can be applied without 
<a name="l2498"><span class="ln">2498 </span></a>        losing a reference to the app object. Instead of doing this:: 
<a name="l2499"><span class="ln">2499 </span></a> 
<a name="l2500"><span class="ln">2500 </span></a>            app = MyMiddleware(app) 
<a name="l2501"><span class="ln">2501 </span></a> 
<a name="l2502"><span class="ln">2502 </span></a>        It's a better idea to do this instead:: 
<a name="l2503"><span class="ln">2503 </span></a> 
<a name="l2504"><span class="ln">2504 </span></a>            app.wsgi_app = MyMiddleware(app.wsgi_app) 
<a name="l2505"><span class="ln">2505 </span></a> 
<a name="l2506"><span class="ln">2506 </span></a>        Then you still have the original application object around and 
<a name="l2507"><span class="ln">2507 </span></a>        can continue to call methods on it. 
<a name="l2508"><span class="ln">2508 </span></a> 
<a name="l2509"><span class="ln">2509 </span></a>        .. versionchanged:: 0.7 
<a name="l2510"><span class="ln">2510 </span></a>            Teardown events for the request and app contexts are called 
<a name="l2511"><span class="ln">2511 </span></a>            even if an unhandled error occurs. Other events may not be 
<a name="l2512"><span class="ln">2512 </span></a>            called depending on when an error occurs during dispatch. 
<a name="l2513"><span class="ln">2513 </span></a>            See :ref:`callbacks-and-errors`. 
<a name="l2514"><span class="ln">2514 </span></a> 
<a name="l2515"><span class="ln">2515 </span></a>        :param environ: A WSGI environment. 
<a name="l2516"><span class="ln">2516 </span></a>        :param start_response: A callable accepting a status code, 
<a name="l2517"><span class="ln">2517 </span></a>            a list of headers, and an optional exception context to 
<a name="l2518"><span class="ln">2518 </span></a>            start the response. 
<a name="l2519"><span class="ln">2519 </span></a>        &quot;&quot;&quot;</span>
<a name="l2520"><span class="ln">2520 </span></a>        <span class="s1">ctx = self.request_context(environ)</span>
<a name="l2521"><span class="ln">2521 </span></a>        <span class="s1">error: t.Optional[BaseException] = </span><span class="s0">None</span>
<a name="l2522"><span class="ln">2522 </span></a>        <span class="s0">try</span><span class="s1">:</span>
<a name="l2523"><span class="ln">2523 </span></a>            <span class="s0">try</span><span class="s1">:</span>
<a name="l2524"><span class="ln">2524 </span></a>                <span class="s1">ctx.push()</span>
<a name="l2525"><span class="ln">2525 </span></a>                <span class="s1">response = self.full_dispatch_request()</span>
<a name="l2526"><span class="ln">2526 </span></a>            <span class="s0">except </span><span class="s1">Exception </span><span class="s0">as </span><span class="s1">e:</span>
<a name="l2527"><span class="ln">2527 </span></a>                <span class="s1">error = e</span>
<a name="l2528"><span class="ln">2528 </span></a>                <span class="s1">response = self.handle_exception(e)</span>
<a name="l2529"><span class="ln">2529 </span></a>            <span class="s0">except</span><span class="s1">:  </span><span class="s2"># noqa: B001</span>
<a name="l2530"><span class="ln">2530 </span></a>                <span class="s1">error = sys.exc_info()[</span><span class="s4">1</span><span class="s1">]</span>
<a name="l2531"><span class="ln">2531 </span></a>                <span class="s0">raise</span>
<a name="l2532"><span class="ln">2532 </span></a>            <span class="s0">return </span><span class="s1">response(environ</span><span class="s0">, </span><span class="s1">start_response)</span>
<a name="l2533"><span class="ln">2533 </span></a>        <span class="s0">finally</span><span class="s1">:</span>
<a name="l2534"><span class="ln">2534 </span></a>            <span class="s0">if </span><span class="s3">&quot;werkzeug.debug.preserve_context&quot; </span><span class="s0">in </span><span class="s1">environ:</span>
<a name="l2535"><span class="ln">2535 </span></a>                <span class="s1">environ[</span><span class="s3">&quot;werkzeug.debug.preserve_context&quot;</span><span class="s1">](_cv_app.get())</span>
<a name="l2536"><span class="ln">2536 </span></a>                <span class="s1">environ[</span><span class="s3">&quot;werkzeug.debug.preserve_context&quot;</span><span class="s1">](_cv_request.get())</span>
<a name="l2537"><span class="ln">2537 </span></a>
<a name="l2538"><span class="ln">2538 </span></a>            <span class="s0">if </span><span class="s1">error </span><span class="s0">is not None and </span><span class="s1">self.should_ignore_error(error):</span>
<a name="l2539"><span class="ln">2539 </span></a>                <span class="s1">error = </span><span class="s0">None</span>
<a name="l2540"><span class="ln">2540 </span></a>
<a name="l2541"><span class="ln">2541 </span></a>            <span class="s1">ctx.pop(error)</span>
<a name="l2542"><span class="ln">2542 </span></a>
<a name="l2543"><span class="ln">2543 </span></a>    <span class="s0">def </span><span class="s1">__call__(self</span><span class="s0">, </span><span class="s1">environ: dict</span><span class="s0">, </span><span class="s1">start_response: t.Callable) -&gt; t.Any:</span>
<a name="l2544"><span class="ln">2544 </span></a>        <span class="s5">&quot;&quot;&quot;The WSGI server calls the Flask application object as the 
<a name="l2545"><span class="ln">2545 </span></a>        WSGI application. This calls :meth:`wsgi_app`, which can be 
<a name="l2546"><span class="ln">2546 </span></a>        wrapped to apply middleware. 
<a name="l2547"><span class="ln">2547 </span></a>        &quot;&quot;&quot;</span>
<a name="l2548"><span class="ln">2548 </span></a>        <span class="s0">return </span><span class="s1">self.wsgi_app(environ</span><span class="s0">, </span><span class="s1">start_response)</span>
<a name="l2549"><span class="ln">2549 </span></a></pre>
</body>
</html>